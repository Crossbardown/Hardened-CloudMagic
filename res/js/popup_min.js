/*
 * jQuery UI 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(c,j){function k(a){return!c(a).parents().andSelf().filter(function(){return c.curCSS(this,"visibility")==="hidden"||c.expr.filters.hidden(this)}).length}c.ui=c.ui||{};if(!c.ui.version){c.extend(c.ui,{version:"1.8.11",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});c.fn.extend({_focus:c.fn.focus,focus:function(a,b){return typeof a==="number"?this.each(function(){var d=this;setTimeout(function(){c(d).focus();b&&b.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;a=c.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(c.curCSS(this,"position",1))&&/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?c(document):a},zIndex:function(a){if(a!==j)return this.css("zIndex",a);if(this.length){a=c(this[0]);for(var b;a.length&&a[0]!==document;){b=a.css("position");if(b==="absolute"||b==="relative"||b==="fixed"){b=parseInt(a.css("zIndex"),10);if(!isNaN(b)&&b!==0)return b}a=a.parent()}}return 0},disableSelection:function(){return this.bind((c.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});c.each(["Width","Height"],function(a,b){function d(f,g,l,m){c.each(e,function(){g-=parseFloat(c.curCSS(f,"padding"+this,true))||0;if(l)g-=parseFloat(c.curCSS(f,"border"+this+"Width",true))||0;if(m)g-=parseFloat(c.curCSS(f,"margin"+this,true))||0});return g}var e=b==="Width"?["Left","Right"]:["Top","Bottom"],h=b.toLowerCase(),i={innerWidth:c.fn.innerWidth,innerHeight:c.fn.innerHeight,outerWidth:c.fn.outerWidth,outerHeight:c.fn.outerHeight};c.fn["inner"+b]=function(f){if(f===j)return i["inner"+b].call(this);return this.each(function(){c(this).css(h,d(this,f)+"px")})};c.fn["outer"+b]=function(f,g){if(typeof f!=="number")return i["outer"+b].call(this,f);return this.each(function(){c(this).css(h,d(this,f,true,g)+"px")})}});c.extend(c.expr[":"],{data:function(a,b,d){return!!c.data(a,d[3])},focusable:function(a){var b=a.nodeName.toLowerCase(),d=c.attr(a,"tabindex");if("area"===b){b=a.parentNode;d=b.name;if(!a.href||!d||b.nodeName.toLowerCase()!=="map")return false;a=c("img[usemap=#"+d+"]")[0];return!!a&&k(a)}return(/input|select|textarea|button|object/.test(b)?!a.disabled:"a"==b?a.href||!isNaN(d):!isNaN(d))&&k(a)},tabbable:function(a){var b=c.attr(a,"tabindex");return(isNaN(b)||b>=0)&&c(a).is(":focusable")}});c(function(){var a=document.body,b=a.appendChild(b=document.createElement("div"));c.extend(b.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});c.support.minHeight=b.offsetHeight===100;c.support.selectstart="onselectstart"in b;a.removeChild(b).style.display="none"});c.extend(c.ui,{plugin:{add:function(a,b,d){a=c.ui[a].prototype;for(var e in d){a.plugins[e]=a.plugins[e]||[];a.plugins[e].push([b,d[e]])}},call:function(a,b,d){if((b=a.plugins[b])&&a.element[0].parentNode)for(var e=0;e<b.length;e++)a.options[b[e][0]]&&b[e][1].apply(a.element,d)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,b){if(c(a).css("overflow")==="hidden")return false;b=b&&b==="left"?"scrollLeft":"scrollTop";var d=false;if(a[b]>0)return true;a[b]=1;d=a[b]>0;a[b]=0;return d},isOverAxis:function(a,b,d){return a>b&&a<b+d},isOver:function(a,b,d,e,h,i){return c.ui.isOverAxis(a,d,h)&&c.ui.isOverAxis(b,e,i)}})}})(jQuery);;
/*
 * jQuery UI Widget 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(b,j){if(b.cleanData){var k=b.cleanData;b.cleanData=function(a){for(var c=0,d;(d=a[c])!=null;c++)b(d).triggerHandler("remove");k(a)}}else{var l=b.fn.remove;b.fn.remove=function(a,c){return this.each(function(){if(!c)if(!a||b.filter(a,[this]).length)b("*",this).add([this]).each(function(){b(this).triggerHandler("remove")});return l.call(b(this),a,c)})}}b.widget=function(a,c,d){var e=a.split(".")[0],f;a=a.split(".")[1];f=e+"-"+a;if(!d){d=c;c=b.Widget}b.expr[":"][f]=function(h){return!!b.data(h,a)};b[e]=b[e]||{};b[e][a]=function(h,g){arguments.length&&this._createWidget(h,g)};c=new c;c.options=b.extend(true,{},c.options);b[e][a].prototype=b.extend(true,c,{namespace:e,widgetName:a,widgetEventPrefix:b[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:f},d);b.widget.bridge(a,b[e][a])};b.widget.bridge=function(a,c){b.fn[a]=function(d){var e=typeof d==="string",f=Array.prototype.slice.call(arguments,1),h=this;d=!e&&f.length?b.extend.apply(null,[true,d].concat(f)):d;if(e&&d.charAt(0)==="_")return h;e?this.each(function(){var g=b.data(this,a),i=g&&b.isFunction(g[d])?g[d].apply(g,f):g;if(i!==g&&i!==j){h=i;return false}}):this.each(function(){var g=b.data(this,a);g?g.option(d||{})._init():b.data(this,a,new c(d,this))});return h}};b.Widget=function(a,c){arguments.length&&this._createWidget(a,c)};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(a,c){b.data(c,this.widgetName,this);this.element=b(c);this.options=b.extend(true,{},this.options,this._getCreateOptions(),a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(a,c){var d=a;if(arguments.length===0)return b.extend({},this.options);if(typeof a==="string"){if(c===j)return this.options[a];d={};d[a]=c}this._setOptions(d);return this},_setOptions:function(a){var c=this;b.each(a,function(d,e){c._setOption(d,e)});return this},_setOption:function(a,c){this.options[a]=c;if(a==="disabled")this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",c);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(a,c,d){var e=this.options[a];c=b.Event(c);c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();d=d||{};if(c.originalEvent){a=b.event.props.length;for(var f;a;){f=b.event.props[--a];c[f]=c.originalEvent[f]}}this.element.trigger(c,d);return!(b.isFunction(e)&&e.call(this.element[0],c,d)===false||c.isDefaultPrevented())}}})(jQuery);;
/*
 * jQuery UI Mouse 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 * jquery.ui.widget.js
 */
(function(b){b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(c){return a._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(true===b.data(c.target,a.widgetName+".preventClickEvent")){b.removeData(c.target,a.widgetName+".preventClickEvent");c.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(a){a.originalEvent=a.originalEvent||{};if(!a.originalEvent.mouseHandled){this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var c=this,e=a.which==1,f=typeof this.options.cancel=="string"?b(a.target).parents().add(a.target).filter(this.options.cancel).length:false;if(!e||f||!this._mouseCapture(a))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)){this._mouseStarted=this._mouseStart(a)!==false;if(!this._mouseStarted){a.preventDefault();return true}}true===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(d){return c._mouseMove(d)};this._mouseUpDelegate=function(d){return c._mouseUp(d)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.preventDefault();return a.originalEvent.mouseHandled=true}},_mouseMove:function(a){if(b.browser.msie&&!(document.documentMode>=9)&&!a.button)return this._mouseUp(a);if(this._mouseStarted){this._mouseDrag(a);return a.preventDefault()}if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==false)?this._mouseDrag(a):this._mouseUp(a);return!this._mouseStarted},_mouseUp:function(a){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;a.target==this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",true);this._mouseStop(a)}return false},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);;(function(c){c.ui=c.ui||{};var n=/left|center|right/,o=/top|center|bottom/,t=c.fn.position,u=c.fn.offset;c.fn.position=function(b){if(!b||!b.of)return t.apply(this,arguments);b=c.extend({},b);var a=c(b.of),d=a[0],g=(b.collision||"flip").split(" "),e=b.offset?b.offset.split(" "):[0,0],h,k,j;if(d.nodeType===9){h=a.width();k=a.height();j={top:0,left:0}}else if(d.setTimeout){h=a.width();k=a.height();j={top:a.scrollTop(),left:a.scrollLeft()}}else if(d.preventDefault){b.at="left top";h=k=0;j={top:b.of.pageY,left:b.of.pageX}}else{h=a.outerWidth();k=a.outerHeight();j=a.offset()}c.each(["my","at"],function(){var f=(b[this]||"").split(" ");if(f.length===1)f=n.test(f[0])?f.concat(["center"]):o.test(f[0])?["center"].concat(f):["center","center"];f[0]=n.test(f[0])?f[0]:"center";f[1]=o.test(f[1])?f[1]:"center";b[this]=f});if(g.length===1)g[1]=g[0];e[0]=parseInt(e[0],10)||0;if(e.length===1)e[1]=e[0];e[1]=parseInt(e[1],10)||0;if(b.at[0]==="right")j.left+=h;else if(b.at[0]==="center")j.left+=h/2;if(b.at[1]==="bottom")j.top+=k;else if(b.at[1]==="center")j.top+=k/2;j.left+=e[0];j.top+=e[1];return this.each(function(){var f=c(this),l=f.outerWidth(),m=f.outerHeight(),p=parseInt(c.curCSS(this,"marginLeft",true))||0,q=parseInt(c.curCSS(this,"marginTop",true))||0,v=l+p+(parseInt(c.curCSS(this,"marginRight",true))||0),w=m+q+(parseInt(c.curCSS(this,"marginBottom",true))||0),i=c.extend({},j),r;if(b.my[0]==="right")i.left-=l;else if(b.my[0]==="center")i.left-=l/2;if(b.my[1]==="bottom")i.top-=m;else if(b.my[1]==="center")i.top-=m/2;i.left=Math.round(i.left);i.top=Math.round(i.top);r={left:i.left-p,top:i.top-q};c.each(["left","top"],function(s,x){c.ui.position[g[s]]&&c.ui.position[g[s]][x](i,{targetWidth:h,targetHeight:k,elemWidth:l,elemHeight:m,collisionPosition:r,collisionWidth:v,collisionHeight:w,offset:e,my:b.my,at:b.at})});c.fn.bgiframe&&f.bgiframe();f.offset(c.extend(i,{using:b.using}))})};c.ui.position={fit:{left:function(b,a){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();b.left=d>0?b.left-d:Math.max(b.left-a.collisionPosition.left,b.left)},top:function(b,a){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();b.top=d>0?b.top-d:Math.max(b.top-a.collisionPosition.top,b.top)}},flip:{left:function(b,a){if(a.at[0]!=="center"){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();var g=a.my[0]==="left"?-a.elemWidth:a.my[0]==="right"?a.elemWidth:0,e=a.at[0]==="left"?a.targetWidth:-a.targetWidth,h=-2*a.offset[0];b.left+=a.collisionPosition.left<0?g+e+h:d>0?g+e+h:0}},top:function(b,a){if(a.at[1]!=="center"){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();var g=a.my[1]==="top"?-a.elemHeight:a.my[1]==="bottom"?a.elemHeight:0,e=a.at[1]==="top"?a.targetHeight:-a.targetHeight,h=-2*a.offset[1];b.top+=a.collisionPosition.top<0?g+e+h:d>0?g+e+h:0}}}};if(!c.offset.setOffset){c.offset.setOffset=function(b,a){if(/static/.test(c.curCSS(b,"position")))b.style.position="relative";var d=c(b),g=d.offset(),e=parseInt(c.curCSS(b,"top",true),10)||0,h=parseInt(c.curCSS(b,"left",true),10)||0;g={top:a.top-g.top+e,left:a.left-g.left+h};"using"in a?a.using.call(b,g):d.css(g)};c.fn.offset=function(b){var a=this[0];if(!a||!a.ownerDocument)return null;if(b)return this.each(function(){c.offset.setOffset(this,b)});return u.call(this)}}})(jQuery);;(function(d){d.widget("ui.draggable",d.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(a){var b=this.options;if(this.helper||b.disabled||d(a.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(a);if(!this.handle)return false;return true},_mouseStart:function(a){var b=this.options;this.helper=this._createHelper(a);this._cacheHelperProportions();if(d.ui.ddmanager)d.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-
this.margins.top,left:this.offset.left-this.margins.left};d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt);b.containment&&this._setContainment();if(this._trigger("start",a)===false){this._clear();return false}this._cacheHelperProportions();d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(a,true);return true},_mouseDrag:function(a,b){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");if(!b){b=this._uiHash();if(this._trigger("drag",a,b)===false){this._mouseUp({});return false}this.position=b.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);return false},_mouseStop:function(a){var b=false;if(d.ui.ddmanager&&!this.options.dropBehaviour)b=d.ui.ddmanager.drop(this,a);if(this.dropped){b=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return false;if(this.options.revert=="invalid"&&!b||this.options.revert=="valid"&&b||this.options.revert===true||d.isFunction(this.options.revert)&&this.options.revert.call(this.element,b)){var c=this;d(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",a)!==false&&c._clear()})}else this._trigger("stop",a)!==false&&this._clear();return false},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(a){var b=!this.options.handle||!d(this.options.handle,this.element).length?true:false;d(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==a.target)b=true});return b},_createHelper:function(a){var b=this.options;a=d.isFunction(b.helper)?d(b.helper.apply(this.element[0],[a])):b.helper=="clone"?this.element.clone():this.element;a.parents("body").length||a.appendTo(b.appendTo=="parent"?this.element[0].parentNode:b.appendTo);a[0]!=this.element[0]&&!/(fixed|absolute)/.test(a.css("position"))&&a.css("position","absolute");return a},_adjustOffsetFromHelper:function(a){if(typeof a=="string")a=a.split(" ");if(d.isArray(a))a={left:+a[0],top:+a[1]||0};if("left"in a)this.offset.click.left=a.left+this.margins.left;if("right"in a)this.offset.click.left=this.helperProportions.width-a.right+this.margins.left;if("top"in a)this.offset.click.top=a.top+this.margins.top;if("bottom"in a)this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0])){a.left+=this.scrollParent.scrollLeft();a.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&d.browser.msie)a={top:0,left:0};return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-
(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;if(a.containment=="parent")a.containment=this.helper[0].parentNode;if(a.containment=="document"||a.containment=="window")this.containment=[(a.containment=="document"?0:d(window).scrollLeft())-this.offset.relative.left-this.offset.parent.left,(a.containment=="document"?0:d(window).scrollTop())-this.offset.relative.top-this.offset.parent.top,(a.containment=="document"?0:d(window).scrollLeft())+d(a.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a.containment=="document"?0:d(window).scrollTop())+(d(a.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(a.containment)&&a.containment.constructor!=Array){var b=d(a.containment)[0];if(b){a=d(a.containment).offset();var c=d(b).css("overflow")!="hidden";this.containment=[a.left+(parseInt(d(b).css("borderLeftWidth"),10)||0)+(parseInt(d(b).css("paddingLeft"),10)||0),a.top+(parseInt(d(b).css("borderTopWidth"),10)||0)+(parseInt(d(b).css("paddingTop"),10)||0),a.left+(c?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(d(b).css("borderLeftWidth"),10)||0)-(parseInt(d(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,a.top+(c?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(d(b).css("borderTopWidth"),10)||0)-(parseInt(d(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom]}}else if(a.containment.constructor==Array)this.containment=a.containment},_convertPositionTo:function(a,b){if(!b)b=this.position;a=a=="absolute"?1:-1;var c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(c[0].tagName);return{top:b.top+this.offset.relative.top*a+this.offset.parent.top*a-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:c.scrollTop())*a),left:b.left+this.offset.relative.left*a+this.offset.parent.left*a-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:c.scrollLeft())*a)}},_generatePosition:function(a){var b=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(c[0].tagName),e=a.pageX,g=a.pageY;if(this.originalPosition){if(this.containment){if(a.pageX-this.offset.click.left<this.containment[0])e=this.containment[0]+this.offset.click.left;if(a.pageY-this.offset.click.top<this.containment[1])g=this.containment[1]+this.offset.click.top;if(a.pageX-this.offset.click.left>this.containment[2])e=this.containment[2]+this.offset.click.left;if(a.pageY-this.offset.click.top>this.containment[3])g=this.containment[3]+this.offset.click.top}if(b.grid){g=this.originalPageY+Math.round((g-this.originalPageY)/b.grid[1])*b.grid[1];g=this.containment?!(g-this.offset.click.top<this.containment[1]||g-this.offset.click.top>this.containment[3])?g:!(g-this.offset.click.top<this.containment[1])?g-b.grid[1]:g+b.grid[1]:g;e=this.originalPageX+Math.round((e-this.originalPageX)/b.grid[0])*b.grid[0];e=this.containment?!(e-this.offset.click.left<this.containment[0]||e-this.offset.click.left>this.containment[2])?e:!(e-this.offset.click.left<this.containment[0])?e-b.grid[0]:e+b.grid[0]:e}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:c.scrollTop()),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:c.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(a,b,c){c=c||this._uiHash();d.ui.plugin.call(this,a,[b,c]);if(a=="drag")this.positionAbs=this._convertPositionTo("absolute");return d.Widget.prototype._trigger.call(this,a,b,c)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});d.extend(d.ui.draggable,{version:"1.8.11"});d.ui.plugin.add("draggable","connectToSortable",{start:function(a,b){var c=d(this).data("draggable"),f=c.options,e=d.extend({},b,{item:c.element});c.sortables=[];d(f.connectToSortable).each(function(){var g=d.data(this,"sortable");if(g&&!g.options.disabled){c.sortables.push({instance:g,shouldRevert:g.options.revert});g.refreshPositions();g._trigger("activate",a,e)}})},stop:function(a,b){var c=d(this).data("draggable"),f=d.extend({},b,{item:c.element});d.each(c.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;c.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(a);this.instance.options.helper=this.instance.options._helper;c.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",a,f)}})},drag:function(a,b){var c=d(this).data("draggable"),f=this;d.each(c.sortables,function(){this.instance.positionAbs=c.positionAbs;this.instance.helperProportions=c.helperProportions;this.instance.offset.click=c.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=d(f).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return b.helper[0]};a.target=this.instance.currentItem[0];this.instance._mouseCapture(a,true);this.instance._mouseStart(a,true,true);this.instance.offset.click.top=c.offset.click.top;this.instance.offset.click.left=c.offset.click.left;this.instance.offset.parent.left-=c.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=c.offset.parent.top-this.instance.offset.parent.top;c._trigger("toSortable",a);c.dropped=this.instance.element;c.currentItem=c.element;this.instance.fromOutside=c}this.instance.currentItem&&this.instance._mouseDrag(a)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",a,this.instance._uiHash(this.instance));this.instance._mouseStop(a,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();c._trigger("fromSortable",a);c.dropped=false}})}});d.ui.plugin.add("draggable","cursor",{start:function(){var a=d("body"),b=d(this).data("draggable").options;if(a.css("cursor"))b._cursor=a.css("cursor");a.css("cursor",b.cursor)},stop:function(){var a=d(this).data("draggable").options;a._cursor&&d("body").css("cursor",a._cursor)}});d.ui.plugin.add("draggable","iframeFix",{start:function(){var a=d(this).data("draggable").options;d(a.iframeFix===true?"iframe":a.iframeFix).each(function(){d('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(d(this).offset()).appendTo("body")})},stop:function(){d("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}});d.ui.plugin.add("draggable","opacity",{start:function(a,b){a=d(b.helper);b=d(this).data("draggable").options;if(a.css("opacity"))b._opacity=a.css("opacity");a.css("opacity",b.opacity)},stop:function(a,b){a=d(this).data("draggable").options;a._opacity&&d(b.helper).css("opacity",a._opacity)}});d.ui.plugin.add("draggable","scroll",{start:function(){var a=d(this).data("draggable");if(a.scrollParent[0]!=document&&a.scrollParent[0].tagName!="HTML")a.overflowOffset=a.scrollParent.offset()},drag:function(a){var b=d(this).data("draggable"),c=b.options,f=false;if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML"){if(!c.axis||c.axis!="x")if(b.overflowOffset.top+b.scrollParent[0].offsetHeight-a.pageY<c.scrollSensitivity)b.scrollParent[0].scrollTop=f=b.scrollParent[0].scrollTop+
c.scrollSpeed;else if(a.pageY-b.overflowOffset.top<c.scrollSensitivity)b.scrollParent[0].scrollTop=f=b.scrollParent[0].scrollTop-c.scrollSpeed;if(!c.axis||c.axis!="y")if(b.overflowOffset.left+b.scrollParent[0].offsetWidth-a.pageX<c.scrollSensitivity)b.scrollParent[0].scrollLeft=f=b.scrollParent[0].scrollLeft+c.scrollSpeed;else if(a.pageX-b.overflowOffset.left<c.scrollSensitivity)b.scrollParent[0].scrollLeft=f=b.scrollParent[0].scrollLeft-c.scrollSpeed}else{if(!c.axis||c.axis!="x")if(a.pageY-d(document).scrollTop()<c.scrollSensitivity)f=d(document).scrollTop(d(document).scrollTop()-c.scrollSpeed);else if(d(window).height()-(a.pageY-d(document).scrollTop())<c.scrollSensitivity)f=d(document).scrollTop(d(document).scrollTop()+c.scrollSpeed);if(!c.axis||c.axis!="y")if(a.pageX-d(document).scrollLeft()<c.scrollSensitivity)f=d(document).scrollLeft(d(document).scrollLeft()-c.scrollSpeed);else if(d(window).width()-(a.pageX-d(document).scrollLeft())<c.scrollSensitivity)f=d(document).scrollLeft(d(document).scrollLeft()+
c.scrollSpeed)}f!==false&&d.ui.ddmanager&&!c.dropBehaviour&&d.ui.ddmanager.prepareOffsets(b,a)}});d.ui.plugin.add("draggable","snap",{start:function(){var a=d(this).data("draggable"),b=a.options;a.snapElements=[];d(b.snap.constructor!=String?b.snap.items||":data(draggable)":b.snap).each(function(){var c=d(this),f=c.offset();this!=a.element[0]&&a.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:f.top,left:f.left})})},drag:function(a,b){for(var c=d(this).data("draggable"),f=c.options,e=f.snapTolerance,g=b.offset.left,n=g+c.helperProportions.width,m=b.offset.top,o=m+c.helperProportions.height,h=c.snapElements.length-1;h>=0;h--){var i=c.snapElements[h].left,k=i+c.snapElements[h].width,j=c.snapElements[h].top,l=j+c.snapElements[h].height;if(i-e<g&&g<k+e&&j-e<m&&m<l+e||i-e<g&&g<k+e&&j-e<o&&o<l+e||i-e<n&&n<k+e&&j-e<m&&m<l+e||i-e<n&&n<k+e&&j-e<o&&o<l+e){if(f.snapMode!="inner"){var p=Math.abs(j-o)<=e,q=Math.abs(l-m)<=e,r=Math.abs(i-n)<=e,s=Math.abs(k-g)<=e;if(p)b.position.top=c._convertPositionTo("relative",{top:j-c.helperProportions.height,left:0}).top-c.margins.top;if(q)b.position.top=c._convertPositionTo("relative",{top:l,left:0}).top-c.margins.top;if(r)b.position.left=c._convertPositionTo("relative",{top:0,left:i-c.helperProportions.width}).left-c.margins.left;if(s)b.position.left=c._convertPositionTo("relative",{top:0,left:k}).left-c.margins.left}var t=p||q||r||s;if(f.snapMode!="outer"){p=Math.abs(j-m)<=e;q=Math.abs(l-o)<=e;r=Math.abs(i-g)<=e;s=Math.abs(k-n)<=e;if(p)b.position.top=c._convertPositionTo("relative",{top:j,left:0}).top-c.margins.top;if(q)b.position.top=c._convertPositionTo("relative",{top:l-c.helperProportions.height,left:0}).top-c.margins.top;if(r)b.position.left=c._convertPositionTo("relative",{top:0,left:i}).left-c.margins.left;if(s)b.position.left=c._convertPositionTo("relative",{top:0,left:k-c.helperProportions.width}).left-c.margins.left}if(!c.snapElements[h].snapping&&(p||q||r||s||t))c.options.snap.snap&&c.options.snap.snap.call(c.element,a,d.extend(c._uiHash(),{snapItem:c.snapElements[h].item}));c.snapElements[h].snapping=p||q||r||s||t}else{c.snapElements[h].snapping&&c.options.snap.release&&c.options.snap.release.call(c.element,a,d.extend(c._uiHash(),{snapItem:c.snapElements[h].item}));c.snapElements[h].snapping=false}}}});d.ui.plugin.add("draggable","stack",{start:function(){var a=d(this).data("draggable").options;a=d.makeArray(d(a.stack)).sort(function(c,f){return(parseInt(d(c).css("zIndex"),10)||0)-(parseInt(d(f).css("zIndex"),10)||0)});if(a.length){var b=parseInt(a[0].style.zIndex)||0;d(a).each(function(c){this.style.zIndex=b+c});this[0].style.zIndex=b+a.length}}});d.ui.plugin.add("draggable","zIndex",{start:function(a,b){a=d(b.helper);b=d(this).data("draggable").options;if(a.css("zIndex"))b._zIndex=a.css("zIndex");a.css("zIndex",b.zIndex)},stop:function(a,b){a=d(this).data("draggable").options;a._zIndex&&d(b.helper).css("zIndex",a._zIndex)}})})(jQuery);;(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var self=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css('position'))&&$.browser.opera)
this.element.css({position:'relative',top:'auto',left:'auto'});this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');if(/sw|se|ne|nw/.test(handle))axis.css({zIndex:++o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!self.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);self.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").hover(function(){$(this).removeClass("ui-resizable-autohide");self._handles.show();},function(){if(!self.resizing){$(this).addClass("ui-resizable-autohide");self._handles.hide();}});}
this._mouseInit();},destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;wrapper.after(this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')})).remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
if($.browser.opera&&(/relative/).test(el.css('position')))
el.css({position:'relative',top:'auto',left:'auto'});this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},self=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]),ie6=$.browser.msie&&$.browser.version<7,csdif=this.sizeDiff;if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,self=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var s={width:(self.helper.width()-soffsetw),height:(self.helper.height()-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));self.helper.height(self.size.height);self.helper.width(self.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(data.height)data.width=(csize.height*this.aspectRatio);else if(data.width)data.height=(csize.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this.options,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
if($.browser.msie&&!(!($(element).is(':hidden')||$(element).parents(':hidden').length)))
continue;prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6=$.browser.msie&&$.browser.version<7,ie6offset=(ie6?1:0),pxyoffset=(ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.extend($.ui.resizable,{version:"1.8.11"});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10),position:el.css('position')});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,os=self.originalSize,op=self.originalPosition;var delta={height:(self.size.height-os.height)||0,width:(self.size.width-os.width)||0,top:(self.position.top-op.top)||0,left:(self.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});if($.browser.opera&&/relative/.test(el.css('position'))){self._revertToRelativePosition=true;el.css({position:'absolute',top:'auto',left:'auto'});}
el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _reset=function(exp){$(exp).each(function(){var el=$(this);el.css({position:el.data("resizable-alsoresize").position});});};if(self._revertToRelativePosition){self._revertToRelativePosition=false;if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp){_reset(exp);});}else{_reset(o.alsoResize);}}
$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var pr=self._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var style={width:(self.size.width-soffsetw),height:(self.size.height-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;self.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(self.element.css('width'),10),height:parseInt(self.element.css('height'),10),top:parseInt(self.element.css('top'),10),left:parseInt(self.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});self._updateCache(data);self._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,el=self.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;self.containerElement=$(ce);if(/document/.test(oc)||oc==document){self.containerOffset={left:0,top:0};self.containerPosition={left:0,top:0};self.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});self.containerOffset=element.offset();self.containerPosition=element.position();self.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=self.containerOffset,ch=self.containerSize.height,cw=self.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);self.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,ps=self.containerSize,co=self.containerOffset,cs=self.size,cp=self.position,pRatio=self._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=self.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(self._helper?co.left:0)){self.size.width=self.size.width+(self._helper?(self.position.left-co.left):(self.position.left-cop.left));if(pRatio)self.size.height=self.size.width/o.aspectRatio;self.position.left=o.helper?co.left:0;}
if(cp.top<(self._helper?co.top:0)){self.size.height=self.size.height+(self._helper?(self.position.top-co.top):self.position.top);if(pRatio)self.size.width=self.size.height*o.aspectRatio;self.position.top=self._helper?co.top:0;}
self.offset.left=self.parentData.left+self.position.left;self.offset.top=self.parentData.top+self.position.top;var woset=Math.abs((self._helper?self.offset.left-cop.left:(self.offset.left-cop.left))+self.sizeDiff.width),hoset=Math.abs((self._helper?self.offset.top-cop.top:(self.offset.top-co.top))+self.sizeDiff.height);var isParent=self.containerElement.get(0)==self.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(self.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=self.parentData.left;if(woset+self.size.width>=self.parentData.width){self.size.width=self.parentData.width-woset;if(pRatio)self.size.height=self.size.width/self.aspectRatio;}
if(hoset+self.size.height>=self.parentData.height){self.size.height=self.parentData.height-hoset;if(pRatio)self.size.width=self.size.height*self.aspectRatio;}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options,cp=self.position,co=self.containerOffset,cop=self.containerPosition,ce=self.containerElement;var helper=$(self.helper),ho=helper.offset(),w=helper.outerWidth()-self.sizeDiff.width,h=helper.outerHeight()-self.sizeDiff.height;if(self._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(self._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size;self.ghost=self.originalElement.clone();self.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');self.ghost.appendTo(self.helper);},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost)self.ghost.css({position:'relative',height:self.size.height,width:self.size.width});},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost&&self.helper)self.helper.get(0).removeChild(self.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size,os=self.originalSize,op=self.originalPosition,a=self.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.left=op.left-ox;}
else{self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;self.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData("sortable-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget()
[value?"addClass":"removeClass"]("ui-sortable-disabled");}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,self=this,nodes=$(event.target).parents().each(function(){if($.data(this,'sortable-item')==self){currentItem=$(this);return false;}});if($.data(event.target,'sortable-item')==self)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options,self=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,self._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.ui.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.ui.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var self=this;var cur=self.placeholder.offset();self.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-self.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-self.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){self._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){var self=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,self._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,self._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var self=this;var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data(sortable-item)");for(var i=0;i<this.items.length;i++){for(var j=0;j<list.length;j++){if(list[j]==this.items[i].item[0])
this.items.splice(i,1);};};},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var self=this;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data('sortable-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){var self=that||this,o=self.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(self.currentItem[0].nodeName)).addClass(className||self.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css('paddingTop')||0,10)-parseInt(self.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css('paddingLeft')||0,10)-parseInt(self.currentItem.css('paddingRight')||0,10));};}};}
self.placeholder=$(o.placeholder.element.call(self.element,self.currentItem));self.currentItem.after(self.placeholder);o.placeholder.update(self,self.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.ui.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else if(this.currentContainer!=this.containers[innermostIndex]){var dist=10000;var itemWithLeastDistance=null;var base=this.positionAbs[this.containers[innermostIndex].floating?'left':'top'];for(var j=this.items.length-1;j>=0;j--){if(!$.ui.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;var cur=this.items[j][this.containers[innermostIndex].floating?'left':'top'];if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){if(counter==self.counter)self.refreshPositions(!hardRefresh);},0);},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[],self=this;if(!this._noFinalSort&&this.currentItem[0].parentNode)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(!$.ui.contains(this.element[0],this.currentItem[0])){if(!noPropagation)delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.containers[i]));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.containers[i]));}};};for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(inst){var self=inst||this;return{helper:self.helper,placeholder:self.placeholder||$([]),position:self.position,originalPosition:self.originalPosition,offset:self.positionAbs,item:self.currentItem,sender:inst?inst.element:null};}});$.extend($.ui.sortable,{version:"1.8.11"});})(jQuery);/*
 * jQuery corner plugin: simple corner rounding
 * Examples and documentation at: http://jquery.malsup.com/corner/
 * version 2.09 (11-MAR-2010)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Authors: Dave Methvin and Mike Alsup
 */
;(function($){var style=document.createElement('div').style;var moz=style['MozBorderRadius']!==undefined;var webkit=style['WebkitBorderRadius']!==undefined;var radius=style['borderRadius']!==undefined||style['BorderRadius']!==undefined;var mode=document.documentMode||0;var noBottomFold=$.browser.msie&&(($.browser.version<8&&!mode)||mode<8);var expr=$.browser.msie&&(function(){var div=document.createElement('div');try{div.style.setExpression('width','0+0');div.style.removeExpression('width');}
catch(e){return false;}
return true;})();function sz(el,p){return parseInt($.css(el,p))||0;};function hex2(s){var s=parseInt(s).toString(16);return(s.length<2)?'0'+s:s;};function gpc(node){while(node){var v=$.css(node,'backgroundColor');if(v&&v!='transparent'&&v!='rgba(0, 0, 0, 0)'){if(v.indexOf('rgb')>=0){var rgb=v.match(/\d+/g);return'#'+hex2(rgb[0])+hex2(rgb[1])+hex2(rgb[2]);}
return v;}
node=node.parentNode;}
return'#ffffff';};function getWidth(fx,i,width){switch(fx){case'round':return Math.round(width*(1-Math.cos(Math.asin(i/width))));case'cool':return Math.round(width*(1+Math.cos(Math.asin(i/width))));case'sharp':return Math.round(width*(1-Math.cos(Math.acos(i/width))));case'bite':return Math.round(width*(Math.cos(Math.asin((width-i-1)/width))));case'slide':return Math.round(width*(Math.atan2(i,width/i)));case'jut':return Math.round(width*(Math.atan2(width,(width-i-1))));case'curl':return Math.round(width*(Math.atan(i)));case'tear':return Math.round(width*(Math.cos(i)));case'wicked':return Math.round(width*(Math.tan(i)));case'long':return Math.round(width*(Math.sqrt(i)));case'sculpt':return Math.round(width*(Math.log((width-i-1),width)));case'dogfold':case'dog':return(i&1)?(i+1):width;case'dog2':return(i&2)?(i+1):width;case'dog3':return(i&3)?(i+1):width;case'fray':return(i%2)*width;case'notch':return width;case'bevelfold':case'bevel':return i+1;}};$.fn.corner=function(options){if(this.length==0){if(!$.isReady&&this.selector){var s=this.selector,c=this.context;$(function(){$(s,c).corner(options);});}
return this;}
return this.each(function(index){var $this=$(this);var o=[$this.attr($.fn.corner.defaults.metaAttr)||'',options||''].join(' ').toLowerCase();var keep=/keep/.test(o);var cc=((o.match(/cc:(#[0-9a-f]+)/)||[])[1]);var sc=((o.match(/sc:(#[0-9a-f]+)/)||[])[1]);var width=parseInt((o.match(/(\d+)px/)||[])[1])||10;var re=/round|bevelfold|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dogfold|dog/;var fx=((o.match(re)||['round'])[0]);var fold=/dogfold|bevelfold/.test(o);var edges={T:0,B:1};var opts={TL:/top|tl|left/.test(o),TR:/top|tr|right/.test(o),BL:/bottom|bl|left/.test(o),BR:/bottom|br|right/.test(o)};if(!opts.TL&&!opts.TR&&!opts.BL&&!opts.BR)
opts={TL:1,TR:1,BL:1,BR:1};if($.fn.corner.defaults.useNative&&fx=='round'&&(radius||moz||webkit)&&!cc&&!sc){if(opts.TL)
$this.css(radius?'border-top-left-radius':moz?'-moz-border-radius-topleft':'-webkit-border-top-left-radius',width+'px');if(opts.TR)
$this.css(radius?'border-top-right-radius':moz?'-moz-border-radius-topright':'-webkit-border-top-right-radius',width+'px');if(opts.BL)
$this.css(radius?'border-bottom-left-radius':moz?'-moz-border-radius-bottomleft':'-webkit-border-bottom-left-radius',width+'px');if(opts.BR)
$this.css(radius?'border-bottom-right-radius':moz?'-moz-border-radius-bottomright':'-webkit-border-bottom-right-radius',width+'px');return;}
var strip=document.createElement('div');$(strip).css({overflow:'hidden',height:'1px',minHeight:'1px',fontSize:'1px',backgroundColor:sc||'transparent',borderStyle:'solid'});var pad={T:parseInt($.css(this,'paddingTop'))||0,R:parseInt($.css(this,'paddingRight'))||0,B:parseInt($.css(this,'paddingBottom'))||0,L:parseInt($.css(this,'paddingLeft'))||0};if(typeof this.style.zoom!=undefined)this.style.zoom=1;if(!keep)this.style.border='none';strip.style.borderColor=cc||gpc(this.parentNode);var cssHeight=$(this).outerHeight();for(var j in edges){var bot=edges[j];if((bot&&(opts.BL||opts.BR))||(!bot&&(opts.TL||opts.TR))){strip.style.borderStyle='none '+(opts[j+'R']?'solid':'none')+' none '+(opts[j+'L']?'solid':'none');var d=document.createElement('div');$(d).addClass('jquery-corner');var ds=d.style;bot?this.appendChild(d):this.insertBefore(d,this.firstChild);if(bot&&cssHeight!='auto'){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.bottom=ds.left=ds.padding=ds.margin='0';if(expr)
ds.setExpression('width','this.parentNode.offsetWidth');else
ds.width='100%';}
else if(!bot&&$.browser.msie){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.top=ds.left=ds.right=ds.padding=ds.margin='0';if(expr){var bw=sz(this,'borderLeftWidth')+sz(this,'borderRightWidth');ds.setExpression('width','this.parentNode.offsetWidth - '+bw+'+ "px"');}
else
ds.width='100%';}
else{ds.position='relative';ds.margin=!bot?'-'+pad.T+'px -'+pad.R+'px '+(pad.T-width)+'px -'+pad.L+'px':(pad.B-width)+'px -'+pad.R+'px -'+pad.B+'px -'+pad.L+'px';}
for(var i=0;i<width;i++){var w=Math.max(0,getWidth(fx,i,width));var e=strip.cloneNode(false);e.style.borderWidth='0 '+(opts[j+'R']?w:0)+'px 0 '+(opts[j+'L']?w:0)+'px';bot?d.appendChild(e):d.insertBefore(e,d.firstChild);}
if(fold&&$.support.boxModel){if(bot&&noBottomFold)continue;for(var c in opts){if(!opts[c])continue;if(bot&&(c=='TL'||c=='TR'))continue;if(!bot&&(c=='BL'||c=='BR'))continue;var common={position:'absolute',border:'none',margin:0,padding:0,overflow:'hidden',backgroundColor:strip.style.borderColor};var $horz=$('<div/>').css(common).css({width:width+'px',height:'1px'});switch(c){case'TL':$horz.css({bottom:0,left:0});break;case'TR':$horz.css({bottom:0,right:0});break;case'BL':$horz.css({top:0,left:0});break;case'BR':$horz.css({top:0,right:0});break;}
d.appendChild($horz[0]);var $vert=$('<div/>').css(common).css({top:0,bottom:0,width:'1px',height:width+'px'});switch(c){case'TL':$vert.css({left:width});break;case'TR':$vert.css({right:width});break;case'BL':$vert.css({left:width});break;case'BR':$vert.css({right:width});break;}
d.appendChild($vert[0]);}}}}});};$.fn.uncorner=function(){if(radius||moz||webkit)
this.css(radius?'border-radius':moz?'-moz-border-radius':'-webkit-border-radius',0);$('div.jquery-corner',this).remove();return this;};$.fn.corner.defaults={useNative:true,metaAttr:'data-corner'};})(jQuery);if("undefined"==typeof(CloudMagic)){var CloudMagic={};};CloudMagic.WidgetDropdownMenu=function(){var self=this;var proto=CloudMagic.WidgetDropdownMenu.prototype;self.timeout=500;self.closetimer=0;self.menuroot=null;self.menuanchor=null;proto.Open=function(){if(cmjQuery_("#mbdropdownmenu > li > ul").css('visibility')=='visible'){self.CancelTimer();self.Close();}else{self.CancelTimer();self.Close();cmjQuery_(self.menuanchor).addClass("mb-menu-open");var correction=cmjQuery_("#mbdropdownmenu > li > ul").width();var leftpos=cmjQuery_(".mb-search-widget").width()-correction;if(leftpos<0){var offsetleft=cmjQuery_(".mb-search-widget").offset().left;var diff=offsetleft+leftpos;if(diff<0){leftpos=0;}}
cmjQuery_("#mbdropdownmenu > li > ul").css("left",leftpos);cmjQuery_("#mbdropdownmenu > li > ul").show();cmjQuery_("#mbdropdownmenu > li > ul").css('visibility','visible');cmjQuery_("#mbdropdownmenu > li > ul").css('background','white');return false;}};proto.Close=function(){cmjQuery_("#mbdropdownmenu > li > ul").css('visibility','hidden');cmjQuery_("#mbdropdownmenu > li > ul").hide();cmjQuery_(self.menuanchor).removeClass("mb-menu-open");};proto.Timer=function(){self.closetimer=window.setTimeout(self.Close,self.timeout);};proto.CancelTimer=function(){if(self.closetimer){window.clearTimeout(self.closetimer);self.closetimer=null;}};proto.Initialize=function(){document.onclick=self.Close;cmjQuery_('#mbdropdownmenu > li > ul').corner("3px");};proto.AddMenuItem=function(caption,linkorfunc){var li=document.createElement("li");var div=document.createElement("div");cmjQuery_(div).attr("class","mbdropdownmenudiv");var a=document.createElement("a");if(typeof linkorfunc=="function"){cmjQuery_(a).click(linkorfunc);cmjQuery_(a).attr("href","#");}else{cmjQuery_(a).attr("href",linkorfunc);}
cmjQuery_(a).attr("target","_blank");cmjQuery_(a).text(caption);cmjQuery_(div).append(a);cmjQuery_(li).append(div);cmjQuery_(self.menuroot).append(li);};proto.CreateMenu=function(td){var wrapperul=document.createElement("ul");cmjQuery_(wrapperul).attr("id","mbdropdownmenu");var wrapperli=document.createElement("li");var div=document.createElement("div");cmjQuery_(div).attr("class","mb-options");cmjQuery_(div).attr("title","Options");cmjQuery_(div).html("&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(wrapperli).append(div);var ul=document.createElement("ul");cmjQuery_(wrapperli).append(ul);cmjQuery_(wrapperul).append(wrapperli);self.menuroot=ul;cmjQuery_(td).append(wrapperul);self.menuanchor=td;};};if("undefined"==typeof(CloudMagic)){var CloudMagic={};};$.fn.hasAttr=function(name){return this.attr(name)!==undefined;};jQuery.noConflict();cmjQuery_=window.jQuery;CloudMagic.Widget=function(){var self=this;var proto=CloudMagic.Widget.prototype;self.utils_=new CloudMagic.WidgetUtilities();self.highlight_=new CloudMagic.WidgetHighlightWrapper();self.dDMenu_=new CloudMagic.WidgetDropdownMenu();self.dateFormat_=new CloudMagic.DateUtilities();self.c_=new CloudMagic.Constants();self.common_=new CloudMagic.Common(self,true);self.searchString_="";self.activeSearchString_="";self.searchResult_=null;self.currentMailSelectionRowId_=-1;self.currentDocSelectionRowId_=-1;self.currentContactSelectionRowId_=-1;self.currentEventSelectionRowId_=-1;self.plugin_=null;self.activePreview_=null;self.autocompleteViewNode_=null;self.previewNode_=null;self.previewContentNode_=null;self.footer_=null;self.searchBox_=null;self.clearButton_=null;self.searchContainerNode_=null;self.mailsTbody_=null;self.contactsTbody_=null;self.docsTbody_=null;self.eventsTbody_=null;self.acTimeout_=null;self.mailRecIndex_=0;self.mailRecTsRowId_=0;self.docRecIndex_=0;self.docRecTsRowId_=0;self.eventRecIndex_=0;self.eventRecTsRowId_=0;self.searchMailResultCount_=0;self.searchContactResultCount_=0;self.searchDocResultCount_=0;self.searchEventResultCount_=0;self.searchMailResultCountPrev_=0;self.searchContactResultCountPrev_=0;self.searchDocResultCountPrev_=0;self.searchEventResultCountPrev_=0;self.widgetNode_=null;self.footerNode_=null;self.port_=0;self.uuid_=null;self.version_=null;self.usageCount_=0;self.lastTrackingTS_=0;self.statusMsg_=null;self.toolbarNode_=null;self.accountEmail_=null;self.pgBarTextNode_=null;self.pgBarNode_=null;self.mailSlideDirection_="left";self.getMailTimer_=null;self.attachmentDownloadStatus_=null;self.tabNavigatorInFocus_=null;self.prevSearchableItems=0;self.SearchableItems=self.c_.DEFAULT_SEARCHABLE_ITEMS;self.domain_=0;self.pref_={};self.maxContactSearchResultCount_=self.c_.MAX_WIDGET_SEARCH_RESULT_COUNT;self.maxSearchResultCount_=self.c_.MAX_WIDGET_SEARCH_RESULT_COUNT;self.isSidebar_=(self.utils_.GetURLParameters("sb")==1);CloudMagic.CMBROWSER=(cmjQuery_.browser.webkit==true)?"gc":"mf";proto.CreateGmailWidget=function(attempts){var ATTEMPTS=20;var DELAY=500;if(cmjQuery_('#gbar').length>0||cmjQuery_('#gbg').length>0){self.utils_.CMLOG("CloudMagic - found gbar");self.CreateWidget();cmjQuery_(document).keydown(function(e){self.HandleDocumentKeydown(e);});cmjQuery_(window).resize(function(){self.ResizeResultPane();});return;}else{attempts=attempts||0;self.utils_.CMLOG("CloudMagic - Load Error["+attempts+"]");if(attempts<ATTEMPTS){var _arg=arguments;setTimeout(function(){_arg.callee.call(self,++attempts);},DELAY);}else{self.utils_.CMLOG("CloudMagic - Load Terminated");return;}}};proto.HandlePreferences=function(response){self.pref_=JSON.parse(response);self.domain_=self.utils_.GetDomainInfo();if(self.domain_==self.c_.MAIL){if(typeof self.pref_.SelectedWidgetTab_Gmail=="undefined"||isNaN(self.pref_.SelectedWidgetTab_Gmail)){self.pref_.SelectedWidgetTab_Gmail=self.c_.MAIL;}
self.pref_.SelectedWidgetTab=self.pref_.SelectedWidgetTab_Gmail;}else if(self.domain_==self.c_.DOC){if(typeof self.pref_.SelectedWidgetTab_Gdoc=="undefined"||isNaN(self.pref_.SelectedWidgetTab_Gdoc)){self.pref_.SelectedWidgetTab_Gdoc=self.c_.DOC;}
self.pref_.SelectedWidgetTab=self.pref_.SelectedWidgetTab_Gdoc;}else if(self.domain_==self.c_.EVENT){if(typeof self.pref_.SelectedWidgetTab_Gcal=="undefined"||isNaN(self.pref_.SelectedWidgetTab_Gcal)){self.pref_.SelectedWidgetTab_Gcal=self.c_.EVENT;}
self.pref_.SelectedWidgetTab=self.pref_.SelectedWidgetTab_Gdoc;}else{if(typeof self.pref_.SelectedWidgetTab=="undefined"||isNaN(self.pref_.SelectedWidgetTab)){self.pref_.SelectedWidgetTab=self.c_.MAIL;}}
if(typeof self.pref_.SafariUpdateCheckTime=="undefined"||isNaN(self.pref_.SafariUpdateCheckTime)){self.pref_.SafariUpdateCheckTime=0;}
self.tabNavigatorInFocus_=self.pref_.SelectedWidgetTab;};proto.GetPreferencesHandler=function(){var func=function(response){self.HandlePreferences(response);if(self.isSidebar_==false){if(window.location.host.indexOf("mail.google.com")!=-1){if(typeof self.pref_.gmail_searchbox!="undefined"&&self.pref_.gmail_searchbox=="0"){self.utils_.CMLOG("Search bar is disabled in Gmail");window.setTimeout(function(){self.HandleSearchResultNewWindow();},500);return;}}else{var str=window.location.host;if(str.search(/docs[0-9]{0,}.google.com/i)!=-1||str.search(/spreadsheets[0-9]{0,}.google.com/i)!=-1){if(typeof self.pref_.gdoc_searchbox!="undefined"&&self.pref_.gdoc_searchbox=="0"){self.utils_.CMLOG("Search bar is disabled in Google documents");return;}}else{str=window.location.href;if(str.search(/www.google.com\/calendar/i)!=-1){if(typeof self.pref_.gcal_searchbox!="undefined"&&self.pref_.gcal_searchbox=="0"){self.utils_.CMLOG("Search bar is disabled in Google calendar");return;}}}}}
self.accountEmail_=(self.isSidebar_==true)?"all":self.utils_.GetLoggedEmailId();cmjQuery_('.mb-search-widget').remove();self.widgetNode_=document.createElement("div");cmjQuery_(self.widgetNode_).attr("class","mb-search-widget");if(self.isSidebar_==true){cmjQuery_(self.widgetNode_).css("cursor","default");}
self.InsertSearchBar(self.widgetNode_);self.InsertToolbar(self.widgetNode_);self.InsertSearchResultViewContainer(self.widgetNode_);self.InsertFooter(self.widgetNode_);cmjQuery_("#cmExtReloadMsg").remove();var parentnode=cmjQuery_("div.nH.GcwpPb-Z8OBDd");if(parentnode&&parentnode.length>0){parentnode.append(self.widgetNode_);}else{cmjQuery_(document.body).append(self.widgetNode_);}
proto.SetWidgetWidth(self.widgetNode_);self.PositionSearchWidget(self.widgetNode_);self.ResizeResultPane();self.SetRoundedEdges();self.SetHandlers(self.widgetNode_);self.plugin_.GetAppPort(self.GetAppPortHandler());if(self.isSidebar_==true){var searchstr=cmjQuery_.cookie("_mWS");if(searchstr&&searchstr.length>0){cmjQuery_(self.searchBox_).val(searchstr);window.setTimeout(function(){self.common_.HandleAutoComplete(0,false);},500);}}
self.HandleClearButton();if(self.isSidebar_==true){cmjQuery_(self.searchBox_).focus();}
window.setTimeout(function(){cmjQuery_("#mbdropdownmenu > li > ul").hide();},500);window.setTimeout(function(){self.HandleSearchResultNewWindow();},500);self.ShowNewFeaturesMessage();};return func;};proto.GetAppPortHandler=function(){var func=function(response){self.InitApplicationLinks(response);self.common_.UpdateStatus();cmjQuery_(self.searchBox_).attr('value',self.c_.EMPTY_SEARCH);cmjQuery_(self.searchBox_).addClass("mb-search-empty");window.setTimeout(function(){self.PositionSearchWidget(self.widgetNode_);self.ResizeResultPane();},100);};return func;};proto.InitApplicationLinks=function(response){self.port_=response;var direct_ui_url=self.utils_.GetDirectSearchUrl(self.version_);var remove_search_box_msg="";var remove_search_box_pref_key="";var baseurl="http://127.0.0.1:"+self.port_+"/";self.dDMenu_.AddMenuItem("Manage Accounts",baseurl+"index.html");self.dDMenu_.AddMenuItem("New Search Window",function(){self.plugin_.OpenInTab(direct_ui_url,null);return false;});var caption;var showreplacemenu=true;if(window.location.host.indexOf("mail.google.com")!=-1){caption="Replace Gmail Search";remove_search_box_msg="CloudMagic search box inside Gmail is now hidden. To show it again please visit 'Preferences'.";remove_search_box_pref_key="gmail_searchbox";}else if(window.location.href.indexOf("www.google.com/calendar")!=-1){caption="Replace Google Calendar Search";remove_search_box_msg="CloudMagic search box inside Google Calendar is now hidden. To show it again please visit 'Preferences'.";remove_search_box_pref_key="gcal_searchbox";}else{caption="Replace Google docs Search";remove_search_box_pref_key="gdoc_searchbox";remove_search_box_msg="CloudMagic search box inside Google Docs is now hidden. To show it again please visit 'Preferences'.";var gsearch=cmjQuery_('input#search');if(gsearch.length==0){showreplacemenu=false;}}
if(self.isSidebar_==false){self.dDMenu_.AddMenuItem("Hide Search box",function(){cmjQuery_('.mb-search-widget').remove();self.plugin_.SetPreferences(remove_search_box_pref_key,"0",null);alert(remove_search_box_msg);return false;});}
if(showreplacemenu==true){self.dDMenu_.AddMenuItem(caption,function(){self.dDMenu_.Close();var gsearch=cmjQuery_('table[role="search"]');if(gsearch.length==0){gsearch=cmjQuery_('input#search');if(gsearch.length==0){gsearch=cmjQuery_('input#maininput');if(gsearch.length==0){return false;}else{cmjQuery_(self.widgetNode_).width(parseInt(self.c_.WIDGET_DEFAULT_WIDTH_GCAL));}}else{cmjQuery_(self.widgetNode_).width(parseInt(self.c_.WIDGET_DEFAULT_WIDTH_GDOC));}}else{if(cmjQuery_.browser.webkit==true){gsearch=gsearch.parent();}
cmjQuery_(self.widgetNode_).width(parseInt(self.c_.WIDGET_DEFAULT_WIDTH_GMAIL));}
self.NewFeaturesMsg();var top=cmjQuery_(gsearch).offset().top-5;var left=cmjQuery_(gsearch).offset().left-2;cmjQuery_(self.widgetNode_).css("top",top);cmjQuery_(self.widgetNode_).css("left",left);self.SaveWidgetPosition();return false;});}
self.dDMenu_.AddMenuItem("Preferences",baseurl+"preferences.html?p=1");self.dDMenu_.AddMenuItem("Help",baseurl+"help.html");};proto.CreateWidget=function(){self.plugin_=self.utils_.InsertPlugin();self.common_.CalculateSearchResultCount();self.GetAppInfo();self.plugin_.GetPreferences(self.GetPreferencesHandler());return;};proto.GetAppUUIDHandler=function(){var func=function(response){self.uuid_=response;};return func;};proto.GetAppVersionHandler=function(){var func=function(response){self.version_=JSON.parse(response);};return func;};proto.GetAppInfo=function(){self.plugin_.GetAppUUID(self.GetAppUUIDHandler());self.plugin_.GetAppVersion(self.GetAppVersionHandler());};proto.SetHandlers=function(widgetNode){cmjQuery_(widgetNode).keydown(function(e){return self.HandleWidgetKeydown(e);});cmjQuery_(widgetNode).mouseleave(function(e){if(self.getMailTimer_){clearTimeout(self.getMailTimer_);self.getMailTimer_=null;}});cmjQuery_(self.autocompleteViewNode_).scroll(function(e){var tabtype=self.GetActiveTab();var id=self.GetActiveTabMoreResultId(tabtype);id="#"+id;if(cmjQuery_(id).length==0){return;}
var ret=self.utils_.IsScrolledIntoView(id);if(ret==true){id=id+">td";cmjQuery_(id).trigger("click");}});cmjQuery_(".mb-search-result").mouseleave(function(e){if(self.getMailTimer_){clearTimeout(self.getMailTimer_);self.getMailTimer_=null;}});var wdt=cmjQuery_(window).width();wdt=(parseInt(wdt)<800)?800:wdt;if(self.isSidebar_==false){cmjQuery_(widgetNode).resizable({maxHeight:30,minWidth:260,maxWidth:wdt,distance:0,handles:'e, w',start:function(event,ui){self.dDMenu_.Close();},resize:function(event,ui){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(".mb-refresh-msg").width(cmjQuery_(self.widgetNode_).width()-2);self.NewFeaturesMsg();},stop:function(event,ui){self.SaveWidgetPosition();}});cmjQuery_(widgetNode).draggable({containment:'document',handle:'.mb-search-container',stop:function(event,ui){self.ResizeResultPane();self.SaveWidgetPosition();cmjQuery_(self.searchBox_).focus();}});}
cmjQuery_(self.searchBox_).focus(function(){if(cmjQuery_(this).val()===self.c_.EMPTY_SEARCH){cmjQuery_(self.searchBox_).val("");}
cmjQuery_(this).removeClass("mb-search-empty");}).blur(function(){if(cmjQuery_(this).val()===''||cmjQuery_(this).val()===self.c_.EMPTY_SEARCH){cmjQuery_(this).addClass("mb-search-empty");cmjQuery_(this).val(self.c_.EMPTY_SEARCH);cmjQuery_(self.autocompleteViewNode_).fadeOut(100,function(){cmjQuery_(self.footerNode_).hide();});}});self.dDMenu_.Initialize();self.SetMouseWheelHandlers();};proto.SetRoundedEdges=function(){cmjQuery_('.mb-search-box-wrapper').corner("3px");cmjQuery_('.mb-category-menu').corner("top 4px");cmjQuery_('#mbSearchContainer').corner("3px");cmjQuery_(self.footerNode_).corner("bottom 3px");cmjQuery_(self.previewNode_).corner("left 6px")};proto.SaveWidgetPosition=function(){var top=cmjQuery_(self.widgetNode_).css("top");var left=cmjQuery_(self.widgetNode_).css("left");var wdt=cmjQuery_(self.widgetNode_).width();cmjQuery_.cookie("_mWW",wdt,{expires:365});cmjQuery_.cookie("_mWT",top,{expires:365});cmjQuery_.cookie("_mWL",left,{expires:365});};proto.SetWidgetWidth=function(widgetNode){var wdt=cmjQuery_.cookie("_mWW");if(wdt!=null){cmjQuery_(widgetNode).width(parseInt(wdt));}};proto.PositionSearchWidget=function(widgetNode){if(self.isSidebar_==true){cmjQuery_(widgetNode).css("position","absolute");cmjQuery_(widgetNode).css("top","5px");cmjQuery_(widgetNode).css("left","5px");return;}
var top=cmjQuery_.cookie("_mWT");var left=cmjQuery_.cookie("_mWL");var wdt=cmjQuery_.cookie("_mWW");if(wdt!=null){wdt=parseInt(wdt);cmjQuery_(widgetNode).width(wdt);}
if(top!=null){top=parseInt(top);}
if(left!=null){left=parseInt(left);}
if(top==null||top<0||top>cmjQuery_(window).height()){top=self.c_.WIDGET_DEFAULT_TOP;if(self.domain_==self.c_.DOC){var gsearch=cmjQuery_('input#search');if(gsearch.length==0){top=self.c_.WIDGET_DEFAULT_TOP_SINGLE_DOC;}}}
if(left==null||left<0||left>cmjQuery_(window).width()){left=cmjQuery_(window).width()-cmjQuery_(widgetNode).width()-10;}
cmjQuery_(widgetNode).css("position","absolute");cmjQuery_(widgetNode).css("top",top);cmjQuery_(widgetNode).css("left",left);};proto.InsertFooter=function(widgetNode){var footer=document.createElement("div");var sharelinks=document.createElement("div");cmjQuery_(sharelinks).attr("class","mb-sharelinks");self.utils_.AddShareLinks(sharelinks,self.accountEmail_,true);cmjQuery_(footer).append(sharelinks);var pgbar=document.createElement("div");var pgbartext=document.createElement("div");cmjQuery_(footer).attr("class","mb-footer");cmjQuery_(pgbartext).attr("class","mb-pgbar-text mb-font-small");cmjQuery_(pgbar).attr("class","mb-pgbar");cmjQuery_(footer).attr("id","mbFooter");cmjQuery_(footer).append(pgbar);cmjQuery_(footer).append(pgbartext);cmjQuery_(widgetNode).append(footer);self.footerNode_=footer;self.pgBarTextNode_=pgbartext;self.pgBarNode_=pgbar;};proto.InsertSearchResultViewContainer=function(widgetNode){var autocompleteview=document.createElement("div");cmjQuery_(autocompleteview).attr("class","mb-search-result");cmjQuery_(autocompleteview).attr("id","mbAutocompleteView");cmjQuery_(widgetNode).append(autocompleteview);self.autocompleteViewNode_=autocompleteview;var preview=document.createElement("div");cmjQuery_(preview).attr("class","mb-search-mail-result mb-hidden mb-mail-view ");cmjQuery_(preview).attr("id","mbPreview");cmjQuery_(widgetNode).append(preview);self.previewNode_=preview;};proto.InsertToolbar=function(widgetNode){self.toolbarNode_=document.createElement("div");cmjQuery_(self.toolbarNode_).attr("class","mb-toolbar");cmjQuery_(self.toolbarNode_).attr("id","mbToolbarNode");var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).css('width','100%');cmjQuery_(table).css('height','100%');var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");self.AddCategoryMenu(td);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr("class","mb-search-help");var a=document.createElement("a");cmjQuery_(a).attr("class","mb-search-help");cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("tabindex","-1");cmjQuery_(a).attr("title","Advanced Search Tips");var helphref="http://cloudmagic.com/advanced_search_operators.php";cmjQuery_(a).attr("href",helphref);cmjQuery_(a).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(td).append(a);cmjQuery_(td).width("18px");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr("class","mb-close-result");cmjQuery_(td).attr("title","Close (Esc)");cmjQuery_(td).html("&nbsp;&nbsp;");cmjQuery_(td).width("22px");cmjQuery_(td).click(function(){self.ShowView(self.c_.NO_VIEW);cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(self.toolbarNode_).append(table);cmjQuery_(widgetNode).append(self.toolbarNode_);};proto.InsertSearchBar=function(widgetNode){var searchcontainer=document.createElement("div");cmjQuery_(searchcontainer).attr("class","mb-search-container");cmjQuery_(searchcontainer).attr("id","mbSearchContainer");self.searchContainerNode_=searchcontainer;var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).css('width','100%');var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).html("&nbsp;");cmjQuery_(td).attr("class","mb-logo");cmjQuery_(td).width("27px");cmjQuery_(tr).append(td);var td=document.createElement("td");var searchboxwrapper=document.createElement("div");cmjQuery_(searchboxwrapper).attr("class","mb-search-box-wrapper");var stable=document.createElement("table");cmjQuery_(stable).attr({cellspacing:0,cellpadding:0});cmjQuery_(stable).css('table-layout','fixed');cmjQuery_(stable).attr("class","mb-font-normal");cmjQuery_(stable).css('width','100%');var stbody=document.createElement("tbody");var str=document.createElement("tr");std=document.createElement("td");cmjQuery_(std).css('width','100%');var searchbox=document.createElement("input");cmjQuery_(searchbox).attr("type","text");cmjQuery_(searchbox).attr("value","");cmjQuery_(searchbox).attr("class","mb-search-box mb-input");cmjQuery_(searchbox).height(26);cmjQuery_(searchbox).attr("id","mbSearchInput");if(cmjQuery_.browser.webkit==true){cmjQuery_(searchbox).keyup(function(e){self.common_.SearchBoxKeypressHandler(e,self,true);});}else{cmjQuery_(searchbox).keypress(function(e){self.common_.SearchBoxKeypressHandler(e,self,true);});}
cmjQuery_(searchbox).bind('paste',function(e){self.common_.HandleMouseEvents();});cmjQuery_(searchbox).bind('cut',function(e){self.common_.HandleMouseEvents();});cmjQuery_(searchbox).bind('undo',function(e){self.common_.HandleMouseEvents();});cmjQuery_(std).append(searchbox);cmjQuery_(str).append(std);std=document.createElement("td");cmjQuery_(std).css('width','16px');var clearbutton=document.createElement("div");cmjQuery_(clearbutton).attr("class","mb-clear-button");cmjQuery_(clearbutton).attr("title","Clear");cmjQuery_(clearbutton).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(std).append(clearbutton);cmjQuery_(str).append(std);cmjQuery_(clearbutton).click(function(e){cmjQuery_(searchbox).val("");self.HandleClearButton();self.ShowView(self.c_.NO_VIEW);cmjQuery_(searchbox).focus();});self.searchBox_=searchbox;self.clearButton_=clearbutton;cmjQuery_(stbody).append(str);cmjQuery_(stable).append(stbody);cmjQuery_(searchboxwrapper).append(stable);cmjQuery_(td).append(searchboxwrapper);cmjQuery_(tr).append(td);var direct_ui_url=self.utils_.GetDirectSearchUrl(self.version_);var td=document.createElement("td");cmjQuery_(td).attr("class","mb-popout-wrapper");var a=document.createElement("div");cmjQuery_(a).attr("class","mb-popout");cmjQuery_(a).attr("id","mbNewWindowWithThisSearch");cmjQuery_(a).attr("href",direct_ui_url);cmjQuery_(a).attr("title","New Search Window");cmjQuery_(a).attr("target","_blank");cmjQuery_(a).click(function(){var url=cmjQuery_(a).attr("href");self.plugin_.OpenInTab(url,null);})
cmjQuery_(td).append(a);var div=document.createElement("div");cmjQuery_(div).attr("class","mb-options-wrapper");self.dDMenu_.CreateMenu(div);cmjQuery_(div).click(function(){return self.dDMenu_.Open();});cmjQuery_(td).append(div);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(searchcontainer).append(table);cmjQuery_(widgetNode).append(searchcontainer);};proto.HandleClearButton=function(){var searchval=cmjQuery_(self.searchBox_).val();if(searchval.length>0&&searchval!=self.c_.EMPTY_SEARCH){cmjQuery_(self.clearButton_).fadeIn();}else{cmjQuery_(self.clearButton_).fadeOut();}};proto.HideMailView=function(){if(self.getMailTimer_){clearTimeout(self.getMailTimer_);self.getMailTimer_=null;}
if(cmjQuery_(self.previewNode_).is(':visible')==true){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();}};proto.OpenMail=function(mail){if(cmjQuery_(self.previewNode_).is(':visible')==true){var messageid_with_accountid=cmjQuery_(self.previewNode_).attr("message_id_with_account_id");if(messageid_with_accountid==(mail.messageid+"mbpaccid_"+mail.accountid)){self.ShowView(self.c_.M_VIEW);window.setTimeout(function(){self.ResizeResultPane();},10);return true;}}
self.common_.HandleTrackingAndJSChanges();var result=self.plugin_.GetMail(mail.tsrowid.toString(),function(response){var result=JSON.parse(response);self.ShowMail(result);});return true;};proto.OpenDoc=function(doc){if(cmjQuery_(self.previewNode_).is(':visible')==true){var messageid_with_accountid=cmjQuery_(self.previewNode_).attr("message_id_with_account_id");if(messageid_with_accountid==(doc.resourceid+"mbpaccid_"+doc.accountid)){self.ShowView(self.c_.M_VIEW);window.setTimeout(function(){self.ResizeResultPane();},10);return true;}}
self.common_.HandleTrackingAndJSChanges();var result=self.plugin_.GetDoc(doc.rowuid.toString(),function(response){var result=JSON.parse(response);self.ShowDoc(result);});return true;};proto.OpenEvent=function(event){if(cmjQuery_(self.previewNode_).is(':visible')==true){var messageid_with_accountid=cmjQuery_(self.previewNode_).attr("message_id_with_account_id");if(messageid_with_accountid==(event.rowuid.toString()+"mbpaccid_"+event.accountid)){self.ShowView(self.c_.M_VIEW);window.setTimeout(function(){self.ResizeResultPane();},10);return true;}}
self.common_.HandleTrackingAndJSChanges();var result=self.plugin_.GetEvent(event.rowuid.toString(),function(response){var result=JSON.parse(response);self.ShowEvent(result);});return true;};proto.GetShowMailClickHandler=function(mail){var func=function(){if(self.getMailTimer_){clearTimeout(self.getMailTimer_);self.getMailTimer_=null;}
self.getMailTimer_=window.setTimeout(function(){self.OpenMail(mail);},1);};return func;};proto.GetShowDocClickHandler=function(doc){var func=function(){if(self.getDocTimer_){clearTimeout(self.getDocTimer_);self.getDocTimer_=null;}
self.getDocTimer_=window.setTimeout(function(){self.OpenDoc(doc);},1);};return func;};proto.GetShowEventClickHandler=function(event){var func=function(){if(self.getEventTimer_){clearTimeout(self.getEventTimer_);self.getEventTimer_=null;}
self.getEventTimer_=window.setTimeout(function(){self.OpenEvent(event);},1);};return func;};proto.AddLinkToMail=function(mail,node){var a;var debug=false;var mailurl=self.utils_.GetBaseMailUrl(mail.accountemail)+'#search/'+
encodeURIComponent("rfc822msgid:"+mail.messageid);if(debug==true||(self.accountEmail_=="all"||self.utils_.strnicmp(mail.accountemail,self.accountEmail_,mail.accountemail.length)==true)){a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).click(function(e){if(e.shiftKey||e.ctrlKey){cmjQuery_(a).attr("target","_blank");return true;}
window.setTimeout(function(){self.OpenSearchResultRow("rfc822msgid:"+mail.messageid,0);},1);});if(window.location.host=="mail.google.com"){if(CloudMagic.CMBROWSER!="gc"){cmjQuery_(a).attr("target","_content");}else{cmjQuery_(a).attr("target","_top");}}else{cmjQuery_(a).attr("target","_blank");}}else{a=document.createElement("span");cmjQuery_(a).click(function(){alert("Current account ("+
self.accountEmail_+") is not matching with the email source account ("+
mail.accountemail+")");});}
cmjQuery_(a).attr("title","View thread in Gmail(CTRL+<DOT>)");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View thread in Gmail");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.AddLinkToEvent=function(event,node){var a;var debug=false;var mailurl=event.viewurl;if(debug==true||(self.accountEmail_=="all"||self.utils_.strnicmp(event.accountemail,self.accountEmail_,event.accountemail.length)==true)){a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).attr("target","_blank");}else{a=document.createElement("span");cmjQuery_(a).click(function(){alert("Current account ("+
self.accountEmail_+") is not matching with the Calendar source account ("+
event.accountemail+")");});}
cmjQuery_(a).attr("title","View event in Google Calendar (CTRL+<DOT>)");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View event in Google Calendar");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.AddLinkToDoc=function(doc,node){var a;var debug=false;var mailurl=doc.viewurl;if(debug==true||(self.accountEmail_=="all"||self.utils_.strnicmp(doc.accountemail,self.accountEmail_,doc.accountemail.length)==true)){a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).attr("target","_blank");}else{a=document.createElement("span");cmjQuery_(a).click(function(){alert("Current account ("+
self.accountEmail_+") is not matching with the doc source account ("+
doc.accountemail+")");});}
cmjQuery_(a).attr("title","View document in Google Docs (CTRL+<DOT>)");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View document in Google Docs");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.AddLinkToContact=function(contact,node){var a;if(self.accountEmail_!=null&&(self.accountEmail_=="all"||self.utils_.strnicmp(contact.accountemail,self.accountEmail_,contact.accountemail.length)==true)){if(contact.contactbase.length>0){var baseurl=self.utils_.GetBaseMailUrl(contact.accountemail);var url=baseurl+"u/0/?shva=1#contact/"+encodeURIComponent(contact.contactbase);}
a=document.createElement("a");cmjQuery_(a).attr("href",url);cmjQuery_(a).attr("target","_blank");}else{a=document.createElement("span");cmjQuery_(a).click(function(){alert("Current account ("+
self.accountEmail_+") is not matching with the contact source account ("+
contact.accountemail+")");});}
cmjQuery_(a).attr("title","View contact in Google Contacts (CTRL+<DOT>)");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View contact in Google Contacts");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.OpenSearchResultRow=function(messageid,attempts){var ATTEMPTS=5000;var DELAY=10;var content=cmjQuery_("#canvas_frame",top.document).contents();var input=cmjQuery_('td>input[type="text"]',content);if(input.length==0){self.utils_.CMLOG("Failed to find td>input[type='text']");return;}
var current_val=input.val();if(current_val==messageid){var selectedRow=cmjQuery_('table>tbody>tr>td>div>span[email]:visible',content);if(selectedRow.length==0){selectedRow=cmjQuery_('table>tbody>tr>td>div>font[color]:visible',content);}
if(selectedRow.length>0){var mbn=cmjQuery_(selectedRow[selectedRow.length-1]).parent().parent().parent();var evt=document.createEvent("MouseEvents");evt.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);var openmail_link=cmjQuery_(mbn)[0];if(openmail_link){openmail_link.dispatchEvent(evt);}
self.ShowView(self.c_.NO_VIEW);cmjQuery_(self.searchBox_).focus();}else if(cmjQuery_.browser.webkit!=true){attempts=attempts||0;self.utils_.CMLOG("CloudMagic - Search Error["+attempts+"]");if(attempts<ATTEMPTS){var _arg=arguments;setTimeout(function(){_arg.callee.call(self,messageid,++attempts);},DELAY);}else{self.utils_.CMLOG("CloudMagic - Search Open Terminated");return;}}}else{attempts=attempts||0;self.utils_.CMLOG("CloudMagic - Search Error["+attempts+"]");if(attempts<ATTEMPTS){var _arg=arguments;setTimeout(function(){_arg.callee.call(self,messageid,++attempts);},DELAY);}else{self.utils_.CMLOG("CloudMagic - Search Open Terminated");return;}}};proto.HandleSearchResultNewWindow=function(){var content=cmjQuery_("#canvas_frame",top.document).contents();var input=cmjQuery_('td>input[type="text"]',content);if(input.length==0){return;}
var current_val=input.val();if(current_val.length<12){return;}
current_val=current_val.substring(0,12);if(current_val!="rfc822msgid:"){return;}
var selectedRow=cmjQuery_('table>tbody>tr>td>div>span[email]:visible',content);if(selectedRow.length>0){var mbn=cmjQuery_(selectedRow[selectedRow.length-1]).parent().parent().parent();var evt=document.createEvent("MouseEvents");evt.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);var openmail_link=cmjQuery_(mbn)[0];if(openmail_link){openmail_link.dispatchEvent(evt);}
self.ShowView(self.c_.NO_VIEW);cmjQuery_(self.searchBox_).focus();}};proto.AddEventToolbar=function(event,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-cal");cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(event.accountemail);cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-hide-mail-left");cmjQuery_(td).attr("title","Close (Esc)");self.mailCloseButton_=td;cmjQuery_(td).click(function(){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);self.previewToolbarNode_=d;cmjQuery_(div).append(d);};proto.AddContactToolbar=function(contact,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).addClass("mb-contact");cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(contact.accountemail);cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-hide-mail-left");cmjQuery_(td).attr("title","Close (Esc)");self.mailCloseButton_=td;cmjQuery_(td).click(function(){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);self.previewToolbarNode_=d;cmjQuery_(div).append(d);};proto.AddDocToolbar=function(doc,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");var filetype=doc.type.toLowerCase().substring(0,5);switch(filetype){case"image":cmjQuery_(td).addClass("mb-photo");cmjQuery_(td).attr("title","Image");break;case"docum":cmjQuery_(td).addClass("mb-doc");cmjQuery_(td).attr("title","Document");break;case"sprea":cmjQuery_(td).addClass("mb-spread");cmjQuery_(td).attr("title","Spreadsheet");break;case"prese":cmjQuery_(td).addClass("mb-presentation");cmjQuery_(td).attr("title","Presentation");break;case"pdf":cmjQuery_(td).addClass("mb-pdf");cmjQuery_(td).attr("title","pdf");break;default:cmjQuery_(td).addClass("mb-generic");cmjQuery_(td).attr("title",doc.type);}
cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(doc.accountemail);cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-hide-mail-left");cmjQuery_(td).attr("title","Close (Esc)");self.mailCloseButton_=td;cmjQuery_(td).click(function(){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);self.previewToolbarNode_=d;cmjQuery_(div).append(d);};proto.AddEmailToolbar=function(mail,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");if(mail.type==2){cmjQuery_(td).attr("class","mb-sent-mail mb-button");cmjQuery_(td).attr("title","Sent Mail");}else if(mail.type==1){cmjQuery_(td).attr("class","mb-recv-mail mb-button");cmjQuery_(td).attr("title","Received Mail");}else if(mail.type==0){cmjQuery_(td).attr("class","mb-draft mb-button");cmjQuery_(td).attr("title","Draft");}
cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(mail.accountemail);cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-hide-mail-left");cmjQuery_(td).attr("title","Close (Esc)");self.mailCloseButton_=td;cmjQuery_(td).click(function(){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);self.previewToolbarNode_=d;cmjQuery_(div).append(d);};proto.ShowMail=function(mail){if(self.CheckForError(mail,self.c_.MAIL)==true){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-preview-container");self.previewContentNode_=div;cmjQuery_(self.previewContentNode_).mousewheel(self.utils_.MouseWheelHandler());self.common_.EscapeMailMessageId(mail);cmjQuery_(div).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});self.common_.AddMailTopSubject(mail,div);self.common_.AddMailTopHeader(mail,div);var table=document.createElement("table");cmjQuery_(table).attr("class","mb-preview-header-table mb-font-normal");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("from"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-from");if(mail.sendername.length>0){self.common_.AddText(td,mail.sendername+" <"+mail.senderaddress+">");}else{self.common_.AddText(td,mail.senderaddress);}
cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);self.common_.AddEmailHeader(tbody,"to",mail.to);self.common_.AddEmailHeader(tbody,"cc",mail.cc);self.common_.AddEmailHeader(tbody,"bcc",mail.bcc);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("date"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td");var d=self.dateFormat_.formatDateWith(mail.timestamp*1000,"ddd, mmm dd, yyyy")+" at "+
self.dateFormat_.formatDateWith(mail.timestamp*1000,"h:MM TT");self.common_.AddText(td,d);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("subject"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-subject");self.common_.AddText(td,mail.subject);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(div).append(table);var mailcontent=document.createElement("div");cmjQuery_(mailcontent).attr("class","mb-preview mb-preview-search-value mb-preview-search-value-body");var text=mail.body;if(mail.contenttype!=1){text=self.utils_.replaceURLWithHTMLLinksHelper(text);text=self.utils_.HtmlEntities(text,"ENT_NOQUOTES");text=self.utils_.ReplaceSlashNWithBR(text);}else{text=self.utils_.HTMLSanitizer(text);text=self.utils_.addBlankToHTMLLinks(text);text=self.utils_.makeShowQuotedTextVisible(text);}
cmjQuery_(mailcontent).append(text);cmjQuery_(mailcontent).append("<br/>");for(var i=0;i<mail.attachments.length;i++){if(i==0){cmjQuery_(mailcontent).append("<br/>");cmjQuery_(mailcontent).append("<div class='mb-attachment-header'></div>");}
var a=mail.attachments[i];var adiv=document.createElement("div");var aspan=document.createElement("span");cmjQuery_(adiv).attr("class"," mb-preview-attachments mb-single-line mb-preview-search-value-filename");cmjQuery_(aspan).attr("class","mb-link");var filename=a.n;if(filename.length>30){var part1=filename.substring(0,14);var part2=filename.substring(filename.length-14,filename.length);filename=part1+"..."+part2;}
cmjQuery_(aspan).text(filename);cmjQuery_(aspan).attr('title',a.n);var func=self.common_.GetAttachmentHandler(mail,a);cmjQuery_(aspan).click(func);cmjQuery_(adiv).append(aspan);cmjQuery_(mailcontent).append(adiv);}
cmjQuery_(div).append(mailcontent);cmjQuery_(div).append("<br/>");self.ResizeResultPane();cmjQuery_(self.previewNode_).empty();self.AddEmailToolbar(mail,self.previewNode_);cmjQuery_(self.previewNode_).append(div);cmjQuery_(self.previewNode_).attr("message_id_with_account_id",(mail.messageid+"mbpaccid_"+mail.accountid));self.ShowView(self.c_.M_VIEW);self.activePreview_=self.c_.MAIL;self.getMailTimer_=window.setTimeout(function(){self.ResizeResultPane();self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.HighlightMailView();self.utils_.ConvertEmailToHyperlink(self.previewNode_,mail.accountemail);},10);},10);};proto.AddEmailToolbar=function(mail,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");if(mail.type==2){cmjQuery_(td).attr("class","mb-sent-mail mb-button");cmjQuery_(td).attr("title","Sent Mail");}else if(mail.type==1){cmjQuery_(td).attr("class","mb-recv-mail mb-button");cmjQuery_(td).attr("title","Received Mail");}else if(mail.type==0){cmjQuery_(td).attr("class","mb-draft mb-button");cmjQuery_(td).attr("title","Draft");}
cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(mail.accountemail);cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-hide-mail-left");cmjQuery_(td).attr("title","Close (Esc)");self.mailCloseButton_=td;cmjQuery_(td).click(function(){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);self.previewToolbarNode_=d;cmjQuery_(div).append(d);};proto.ShowEvent=function(event){if(self.CheckForError(event,self.c_.EVENT)==true){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-preview-container");self.previewContentNode_=div;var header=document.createElement("div");cmjQuery_(header).attr("id","mbPreviewHeader");cmjQuery_(calendarnamediv).css("padding","3px");cmjQuery_(self.previewContentNode_).mousewheel(self.utils_.MouseWheelHandler());cmjQuery_(div).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});self.common_.AddEventTopTitle(event,header);var calendarname=" ";if(event.calendardetails.name!=undefined){calendarname=event.calendardetails.name;}
var calendarnamediv=document.createElement("div");cmjQuery_(calendarnamediv).attr("class","mb-font-normal mb-single-line");cmjQuery_(calendarnamediv).css("title",calendarname);cmjQuery_(calendarnamediv).css("padding","3px");cmjQuery_(calendarnamediv).html("<b>Calendar:</b>&nbsp;&nbsp;<span class='mb-preview-search-value mb-preview-search-value-calendar'>"+calendarname+"</span>");cmjQuery_(header).append(calendarnamediv);var attendstatustopdiv=document.createElement("div");cmjQuery_(attendstatustopdiv).css("padding","3px");cmjQuery_(header).append(attendstatustopdiv);var index=self.common_.FindOwnerGuestIndexInGuestJson(event.guests,self.accountEmail_);if(index!=-1){gueststatus=event.guests[index].s;if(gueststatus!=""&&gueststatus!="invited"){var imageclass=self.common_.GuestAttendeStatus(event.guests[index].s,false);var attendstatusval=self.common_.GuestAttendeStatus(event.guests[index].s);var attendstatusdiv=document.createElement("div");cmjQuery_(attendstatusdiv).text(attendstatusval);cmjQuery_(attendstatusdiv).attr("class",imageclass);cmjQuery_(attendstatustopdiv).append(attendstatusdiv);}}
var linktocal=document.createElement("div");cmjQuery_(linktocal).attr("class","mb-locate-link");self.AddLinkToEvent(event,linktocal);cmjQuery_(header).append(linktocal);var detailsdiv=document.createElement("div");cmjQuery_(detailsdiv).attr("class","mb-preview");cmjQuery_(header).append(detailsdiv);var table=document.createElement("table");cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).attr("cellspacing",5);cmjQuery_(table).css('width','100%');cmjQuery_(detailsdiv).append(table);var tbody=document.createElement("tbody");cmjQuery_(table).append(tbody);var isallday=event.metadata.isallday;self.common_.AddEventDate(event,tbody,isallday);if(event.title==undefined||event.title!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).text("What:");cmjQuery_(td).attr('valign',"top");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-what");cmjQuery_(td).text(event.title);cmjQuery_(tr).append(td);}
if(event.where==undefined||event.where!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).text("Where:");cmjQuery_(td).attr('valign',"top");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-where");cmjQuery_(td).text(event.where);cmjQuery_(tr).append(td);}
var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Repeat:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");cmjQuery_(td).text((event.metadata.isrepeat==true?"Yes":"No"));cmjQuery_(tr).append(td);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("All day:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");cmjQuery_(td).text((isallday==true?"Yes":"No"));cmjQuery_(tr).append(td);if(event.description==undefined||event.description!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Description:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-description");cmjQuery_(td).text(event.description);cmjQuery_(tr).append(td);}
self.common_.AddEventReminderDetails(event,tbody);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Show me as:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");var availablestr;if(event.metadata.available==undefined||event.metadata.available==1){availablestr="Available";}else{availablestr="Busy";}
cmjQuery_(td).text(availablestr);cmjQuery_(tr).append(td);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Privacy:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");self.common_.AddEventGuests(event,tbody);var visibility=" ";if(event.metadata.visibility!=undefined){visibility=event.metadata.visibility;visibility=visibility.charAt(0).toUpperCase()+visibility.slice(1);}
cmjQuery_(td).text(visibility);cmjQuery_(tr).append(td);cmjQuery_(self.previewContentNode_).append(header);self.common_.AddGuestEventAcessPermissions(event,tbody);cmjQuery_(self.previewNode_).empty();self.AddEventToolbar(event,self.previewNode_);cmjQuery_(self.previewNode_).append(div);self.ResizeResultPane();cmjQuery_(self.previewNode_).attr("message_id_with_account_id",(event.uid+"mbpaccid_"+event.accountid));self.ShowView(self.c_.M_VIEW);self.activePreview_=self.c_.EVENT;self.getMailTimer_=window.setTimeout(function(){self.ResizeResultPane();self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.HighlightMailView();self.utils_.ConvertEmailToHyperlink(self.previewNode_,event.accountemail);},10);},10);};proto.ShowDoc=function(doc){if(self.CheckForError(doc,self.c_.DOC)==true){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-preview-container");self.previewContentNode_=div;var docheader=document.createElement("div");cmjQuery_(docheader).attr("id","mbPreviewHeader");cmjQuery_(self.previewContentNode_).mousewheel(self.utils_.MouseWheelHandler());cmjQuery_(div).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});self.common_.AddDocTopTitle(doc,docheader);self.common_.AddDocTopHeader(doc,docheader);var table=document.createElement("table");cmjQuery_(table).attr("class","mb-preview-header-table mb-font-normal");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("owner"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-from");self.common_.AddText(td,doc.owner);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);self.common_.AddDocSharedMembers(doc,tbody);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("published date"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td");self.common_.AddText(td,self.dateFormat_.formatDate(doc.publishedtime*1000));cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(docheader).append(table);cmjQuery_(div).append(docheader);var doccontent=document.createElement("div");if(doc.content.length>0){cmjQuery_(doccontent).attr("class","mb-preview mb-preview-search-value mb-preview-search-value-content");var ifr=document.createElement("iframe");cmjQuery_(ifr).attr("class","mb-preview-iframe mb-font-normal");ifr.src="";cmjQuery_(ifr).load(function(){try{var previewiframe=cmjQuery_(ifr)[0];self.common_.InitializeIframe(previewiframe);var docContent=self.utils_.addBlankToHTMLLinks(doc.content);cmjQuery_(previewiframe.contentWindow).keydown(function(e){var code=self.utils_.GetKeyCode(e);if(code==27){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.searchBox_).focus();}});window.setTimeout(function(){previewiframe.contentWindow.document.body.innerHTML=docContent;self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_,previewiframe.contentWindow.document);self.utils_.ConvertEmailToHyperlink(self.previewContentNode_,doc.accountemail);},10);},0);}catch(e){alert("Failed to load doc");}});cmjQuery_(doccontent).append(ifr);}else{cmjQuery_(doccontent).attr("class","mb-preview mb-new-preview mb-font-bigger");cmjQuery_(doccontent).append("No preview available<br/>");var d1=document.createElement("span");cmjQuery_(d1).attr("class","mb-font-small");cmjQuery_(d1).append("type:&nbsp;");var d2=document.createElement("span");cmjQuery_(d2).attr("class","mb-preview-search-value mb-preview-search-value-type");cmjQuery_(d2).append(doc.type);cmjQuery_(d1).append(d2);cmjQuery_(doccontent).append(d1);}
cmjQuery_(doccontent).append("<br/>");cmjQuery_(div).append(doccontent);cmjQuery_(self.previewNode_).empty();self.AddDocToolbar(doc,self.previewNode_);self.ResizeResultPane();cmjQuery_(self.previewNode_).append(div);cmjQuery_(self.previewNode_).attr("message_id_with_account_id",(doc.resourceid+"mbpaccid_"+doc.accountid));self.ShowView(self.c_.M_VIEW);self.activePreview_=self.c_.DOC;self.getMailTimer_=window.setTimeout(function(){self.ResizeResultPane();self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.HighlightMailView();self.utils_.ConvertEmailToHyperlink(self.previewNode_,doc.accountemail);},10);},10);};proto.AddText=function(node,value){var div=document.createElement("div");cmjQuery_(div).text(value);cmjQuery_(node).append(div);};proto.SetStatusMessage=function(){var accountCount=0;if(self.statusMsg_&&typeof(self.statusMsg)!=undefined&&self.statusMsg_.accountstatus){accountCount=self.statusMsg_.accountstatus.accountcount;}
if(accountCount==0){cmjQuery_(self.pgBarTextNode_).html("");cmjQuery_(self.pgBarNode_).hide();return;}
if(self.statusMsg_.accountstatus.error==-1){cmjQuery_(self.pgBarTextNode_).html("Connecting...");cmjQuery_(self.pgBarNode_).hide();return;}
if(self.statusMsg_.accountstatus.error==1){var url="http://127.0.0.1:"+self.port_+"/index.html";cmjQuery_(self.pgBarTextNode_).html("<a target='_blank' href='"+
url+"'>Problem with indexing</a>");cmjQuery_(self.pgBarNode_).hide();return;}
if(self.statusMsg_.index.indexstatus==0||self.statusMsg_.docindexstatus==0||self.statusMsg_.calindexstatus==0){cmjQuery_(self.pgBarTextNode_).html("Indexing");cmjQuery_(self.pgBarNode_).hide();}else if(self.statusMsg_.accountstatus.updatedtime!=0){var updateTime=self.statusMsg_.accountstatus.updatedtime;updateTime=self.dateFormat_.formatDate(updateTime*1000,"false");cmjQuery_(self.pgBarTextNode_).html("Last updated: "+updateTime);cmjQuery_(self.pgBarNode_).hide();}else{cmjQuery_(self.pgBarTextNode_).html("Indexing");cmjQuery_(self.pgBarNode_).hide();}};proto.HandleDocumentKeydown=function(e){var code=self.utils_.GetKeyCode(e);if(code==27){if(cmjQuery_("#mbdropdownmenu > li > ul").css('visibility')=="visible"||cmjQuery_("#mbSearchOptionsDialog").css('visibility')=="visible"){self.dDMenu_.Close();}else if(cmjQuery_(self.previewNode_).is(':visible')==true){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();window.setTimeout(function(){cmjQuery_(self.searchBox_).focus();},10);}else{if(self.GetCurrentViewType()==self.c_.NO_VIEW){self.dDMenu_.Close();cmjQuery_(self.searchBox_).blur();}else{self.ShowView(self.c_.NO_VIEW);self.dDMenu_.Close();cmjQuery_(self.searchBox_).focus();}}}else if(code==191||code==111){if(e.ctrlKey==1){self.dDMenu_.Close();cmjQuery_(self.searchBox_).focus();cmjQuery_(self.searchBox_).select();return false;}}else if(code==190||code==110){if(e.ctrlKey==1&&cmjQuery_(self.previewNode_).is(':visible')==true){var a=cmjQuery_("#mbLocateOriginal");var href=cmjQuery_(a).attr("href");if(href&&href.length>0){if(self.activePreview_==self.c_.MAIL&&window.location.host=="mail.google.com"){window.top.location=href;}else{self.plugin_.OpenInTab(href,null);return;}}
cmjQuery_(a).click();}}};proto.HandleWidgetKeydown=function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 38:return self.Navigate('up');break;case 40:return self.Navigate('down');break;case 13:return self.HandleWidgetEnterKey();break;case 27:break;case 37:if(e.altKey!=true){break;}
case 8:if(cmjQuery_('.mb-back-to-search').is(':visible')){cmjQuery_('.mb-back-to-search>a').trigger("click");return false;}}
return true;};proto.HandleWidgetEnterKey=function(){var viewType=self.GetCurrentViewType();if(viewType==self.c_.AC_VIEW){if(self.tabNavigatorInFocus_!=null&&self.tabNavigatorInFocus_!=self.GetActiveTab()){return true;}
var tabtype=self.GetActiveTab();var id=self.GetRowResultId(tabtype);var selectionid=self.GetActiveTabRowSelectionId(tabtype);if(self[selectionid]!=-1){id=id+">td";cmjQuery_(id).eq(self[selectionid]).trigger('click');}
return false;}
return true;};proto.GetCurrentViewType=function(){var viewType=self.c_.NO_VIEW;if(cmjQuery_(self.autocompleteViewNode_).is(':visible')){viewType=self.c_.AC_VIEW;}
return viewType;};proto.GetActiveTab=function(){var tabType=self.c_.MAIL;if(cmjQuery_("#mbDocsTable").is(':visible')){tabType=self.c_.DOC;}else if(cmjQuery_("#mbContactsTable").is(':visible')){tabType=self.c_.CONTACT;}else if(cmjQuery_("#mbEventsTable").is(':visible')){tabType=self.c_.EVENT;}
return tabType;};proto.InitializeACViewKeyboardNavigation=function(tabtype){var id=self.GetRowResultId(tabtype);for(var i=0;i<cmjQuery_(id).size();i++){cmjQuery_(id).eq(i).data("number",i);}
cmjQuery_(id).unbind('click');cmjQuery_(id).click(function(){var selectionid=self.GetActiveTabRowSelectionId(tabtype);self[selectionid]=cmjQuery_(this).data("number");self.SetSelectedRow(self[selectionid]);},function(){cmjQuery_(id).removeClass("mb-search-item-hover");});};proto.GetRowResultId=function(tabtype){var id;switch(tabtype){case self.c_.DOC:id="tr.mb-docs-result-row";break;case self.c_.CONTACT:id="tr.mb-contacts-result-row";break;case self.c_.EVENT:id="tr.mb-event-result-row";break;case self.c_.MAIL:default:id="tr.mb-mails-result-row";}
return id;};proto.GetActiveTabRowSelectionId=function(tabtype){var id;switch(tabtype){case self.c_.DOC:id="currentDocSelectionRowId_";break;case self.c_.CONTACT:id="currentContactSelectionRowId_";break;case self.c_.EVENT:id="currentCalSelectionRowId_";break;case self.c_.MAIL:default:id="currentMailSelectionRowId_";}
return id;};proto.GetActiveTabMoreResultId=function(tabtype){var id;switch(tabtype){case self.c_.DOC:id="mbSearchMoreDocs";break;case self.c_.CONTACT:id="mbSearchMoreContacts";break;case self.c_.EVENT:id="mbSearchMoreEvents";break;case self.c_.MAIL:default:id="mbSearchMoreMails";}
return id;};proto.Navigate=function(direction){self.dDMenu_.Close();var viewType=self.GetCurrentViewType();if(viewType!=self.c_.AC_VIEW){return;}
var tabtype=self.GetActiveTab();var id=self.GetRowResultId(tabtype);var hoverid=id+".mb-search-item-hover";var selectionid=self.GetActiveTabRowSelectionId(tabtype);if(cmjQuery_(hoverid).size()==0){self[selectionid]=-1;}
if(direction=='up'&&self[selectionid]!=-1){if(self[selectionid]!=0){self[selectionid]=self[selectionid]-1;}}else if(direction=='down'){if(self[selectionid]!=cmjQuery_(id).size()-1){self[selectionid]=self[selectionid]+1;}}
self.SetSelectedRow(self[selectionid]);return false;};proto.SetSelectedRow=function(menuitem){var tabtype=self.GetActiveTab();var id=self.GetRowResultId(tabtype);var selectionid=self.GetActiveTabRowSelectionId(tabtype);self[selectionid]=menuitem;cmjQuery_(id).removeClass("mb-search-item-hover");if(self[selectionid]==-1){if(cmjQuery_(id).length>0){self.utils_.ScrollIntoView(cmjQuery_(id).eq(0),self.autocompleteViewNode_);}
return;}
cmjQuery_(id).eq(menuitem).addClass("mb-search-item-hover");self.utils_.ScrollIntoView(cmjQuery_(id).eq(menuitem),self.autocompleteViewNode_);};proto.ResizeResultPane=function(){var resultpane=cmjQuery_('.mb-search-result');var whgt=cmjQuery_(window).height();var pos=cmjQuery_('.mb-search-widget').css("top");var correction=(self.isSidebar_==true)?36:52;var hgt=whgt-parseInt(pos)-cmjQuery_(self.searchContainerNode_).height()-
cmjQuery_(self.footerNode_).height()-
correction;var minhgt=self.c_.WIDGET_MIN_HEIGHT;if(hgt<minhgt){hgt=minhgt;}
cmjQuery_(self.autocompleteViewNode_).height(hgt);cmjQuery_(self.contactViewNode_).height(hgt);var previewcorrection=(self.isSidebar_==true)?55:40;cmjQuery_(self.previewNode_).height(hgt+correction+previewcorrection);cmjQuery_(self.previewContentNode_).height(hgt+correction-
cmjQuery_(self.previewToolbarNode_).height()+36);cmjQuery_(".mb-preview-iframe").height(hgt+correction-cmjQuery_(self.previewToolbarNode_).height()+36-cmjQuery_("#mbPreviewHeader").height()-10);};proto.ShowView=function(viewType){switch(viewType){case self.c_.AC_VIEW:cmjQuery_(self.toolbarNode_).show();cmjQuery_(self.contactViewNode_).hide();self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.footerNode_).show();cmjQuery_(self.autocompleteViewNode_).fadeIn(200,function(){self.SetStatusMessage();self.ResizeResultPane();});cmjQuery_('.mb-category-wrapper').show();cmjQuery_('.mb-back-to-search').hide();cmjQuery_('.mb-search-box-wrapper').show();self.ResizeResultPane();cmjQuery_(self.searchBox_).focus();cmjQuery_(self.autocompleteViewNode_).attr('scrollTop',0);self.utils_.SetPopoutWithSearchUrl(true,self.activeSearchString_,self.GetActiveTab(),self.version_);break;case self.c_.M_VIEW:var left=cmjQuery_(self.widgetNode_).css("left");left=parseInt(left);var wdt=cmjQuery_(self.widgetNode_).width()
wdt=parseInt(wdt);if(left<self.c_.DEF_MAIL_VIEW_WIDTH&&self.isSidebar_==false){self.mailSlideDirection_='left';cmjQuery_(self.previewNode_).removeClass("mb-preview-view-left");cmjQuery_(self.previewNode_).addClass("mb-preview-view-right");cmjQuery_(self.previewNode_).css("left",wdt);cmjQuery_(self.mailCloseButton_).removeClass("mb-hide-mail-left");cmjQuery_(self.mailCloseButton_).addClass("mb-hide-mail-right");cmjQuery_(self.previewNode_).uncorner();cmjQuery_(self.previewNode_).corner("right 6px");}else{self.mailSlideDirection_='right';cmjQuery_(self.previewNode_).removeClass("mb-preview-view-right");cmjQuery_(self.previewNode_).addClass("mb-preview-view-left");cmjQuery_(self.mailCloseButton_).removeClass("mb-hide-mail-right");cmjQuery_(self.mailCloseButton_).addClass("mb-hide-mail-left");cmjQuery_(self.previewNode_).css("left","-302px");cmjQuery_(self.previewNode_).uncorner();cmjQuery_(self.previewNode_).corner("left 6px");}
cmjQuery_(self.previewNode_).show();self.HandlePopupWidth(true);cmjQuery_(self.previewContentNode_).attr('scrollTop',0);cmjQuery_(self.previewContentNode_).attr('scrollLeft',0);cmjQuery_(self.searchBox_).focus();break;case self.c_.NO_VIEW:self.common_.ClearACTimers();cmjQuery_(self.autocompleteViewNode_).attr('scrollTop',0);self.utils_.SetPopoutWithSearchUrl(true,cmjQuery_(self.searchBox_).val(),null,self.version_);cmjQuery_(self.autocompleteViewNode_).fadeOut(10,function(){cmjQuery_(self.footerNode_).hide();});self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(self.contactViewNode_).hide();cmjQuery_('.mb-back-to-search').hide();cmjQuery_('.mb-search-box-wrapper').show();cmjQuery_(self.widgetNode_).height(cmjQuery_('#mbSearchContainer').height());cmjQuery_(self.toolbarNode_).hide();self.ResizeResultPane();self.activeSearchString_="";self.searchString_="";if(self.isSidebar_==true){cmjQuery_.cookie("_mWS",self.searchString_,{expires:365});}
break;default:self.utils_.CMLOG("Invalid viewType : "+viewType);}};proto.HandlePopupWidth=function(isshow){isshow=isshow||false;if(self.isSidebar_==true){var left="5px";var width=275;if(isshow==true){width=width*2+25;left="305px";}
cmjQuery_(self.widgetNode_).css("left",left);cmjQuery_(document.body).width(width);}};proto.HighlightMailView=function(){self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_);};proto.ShowNewVersionMessage=function(data){var cver=self.version_.majorversion+"."+self.version_.minorversion
cver=parseFloat(cver);var nver=parseFloat(data.version);if(cver<nver){if(cmjQuery_(".mb-safari-update").length!=0){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-top-msg-banner mb-safari-update");cmjQuery_(div).append('CloudMagic <span id="cmVersionInfo">'+data.version+'</span> is available. <br />Do you want to download now? <br />');var span=document.createElement("span");cmjQuery_(span).append('<a class="mb-link" href="http://www.cloudmagic.com/install.php">Download</a>&nbsp;&nbsp;');var span2=document.createElement("span");cmjQuery_(span2).attr("class","mb-link");cmjQuery_(span2).html("Close");cmjQuery_(span2).click(function(){cmjQuery_(".mb-safari-update").remove();});cmjQuery_(span).append(span2);cmjQuery_(div).append(span);cmjQuery_(self.widgetNode_).append(div);cmjQuery_(div).show();}};proto.ShowReloadMessage=function(){if(cmjQuery_(".mb-reload-msg").length!=0){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-top-msg-banner mb-reload-msg");cmjQuery_(div).append("CloudMagic successfully updated.<br/> Click <span class='mb-link'>here</span> to reload");cmjQuery_(self.widgetNode_).append(div);cmjQuery_(".mb-reload-msg").width(cmjQuery_(self.widgetNode_).width()-2);cmjQuery_(".mb-reload-msg").slideDown(500);cmjQuery_(".mb-reload-msg").corner("3px");cmjQuery_(".mb-reload-msg>span").click(function(){window.top.location.reload();});};proto.NewFeaturesMsg=function(){if(cmjQuery_(".mb-new-features-msg").length==0){return;}
cmjQuery_(".mb-new-features-msg").width(cmjQuery_(self.widgetNode_).width()-2);cmjQuery_(".mb-new-features-msg-close").css("left",cmjQuery_(".mb-new-features-msg").width()-15);};proto.ShowNewFeaturesMessage=function(){if(CloudMagic.CMSHOWNEWFEATUREMSG!="1"||self.isSidebar_==true){return;}
if(cmjQuery_.browser.webkit==true&&typeof self.pref_.Last_gc_Msg_Version!="undefined"&&self.pref_.Last_gc_Msg_Version==CloudMagic.CMSCRIPTVER){return;}else if(typeof self.pref_.Last_mf_Msg_Version!="undefined"&&self.pref_.Last_mf_Msg_Version==CloudMagic.CMSCRIPTVER){return;}
if(cmjQuery_(".mb-new-features-msg").length!=0){cmjQuery_('.mb-new-features-msg').show();return;}
var bloglink="http://blog.cloudmagic.com/category/releases/";var div=document.createElement("div");cmjQuery_(div).attr("class","mb-top-msg-banner mb-new-features-msg");cmjQuery_(div).append("<a target='_blank' class='mb-link' href='"+bloglink+"'>See what's new!</a>&nbsp;&nbsp;&nbsp;&nbsp;<div title='Hide' class='mb-new-features-msg-close'></div>");cmjQuery_(self.widgetNode_).append(div);cmjQuery_(".mb-new-features-msg").width(cmjQuery_(self.widgetNode_).width()-2);cmjQuery_(".mb-new-features-msg").show();cmjQuery_(".mb-new-features-msg").corner("top 3px");var key;if(cmjQuery_.browser.webkit==true){key="Last_gc_Msg_Version";}else{key="Last_mf_Msg_Version";}
cmjQuery_(".mb-new-features-msg-close").css("left",cmjQuery_(".mb-new-features-msg").width()-15);var top=0-cmjQuery_(".mb-new-features-msg").height();cmjQuery_(".mb-new-features-msg").css("top",top+"px");cmjQuery_(".mb-new-features-msg>a").click(function(){cmjQuery_(".mb-new-features-msg").hide();self.plugin_.SetPreferences(key,CloudMagic.CMSCRIPTVER.toString(),null);});cmjQuery_(".mb-new-features-msg-close").click(function(){cmjQuery_(".mb-new-features-msg").hide();self.plugin_.SetPreferences(key,CloudMagic.CMSCRIPTVER.toString(),null);});};proto.ShowRefreshMessage=function(){if(CloudMagic.cmDebug!="0"){self.utils_.CMLOG("Debug build! Don't check for js update");return;}
if(self.isSidebar_==true){return;}
if(cmjQuery_(".mb-refresh-msg").length!=0){return;}
var div=document.createElement("div");cmjQuery_(div).attr("class","mb-top-msg-banner mb-refresh-msg");var closediv=document.createElement("div");cmjQuery_(closediv).attr("class","mb-refresh-msg-close");cmjQuery_(closediv).click(function(){cmjQuery_(".mb-refresh-msg").slideUp(500,function(){cmjQuery_(".mb-refresh-msg").remove();self.lastTrackingTS_=parseInt(new Date().getTime()/1000);});});cmjQuery_(div).append(closediv);cmjQuery_(div).append("New updates are available.<br/> Click <span class='mb-link'>here</span> to reload");cmjQuery_(self.widgetNode_).append(div);cmjQuery_(".mb-refresh-msg").width(cmjQuery_(self.widgetNode_).width()-2);cmjQuery_(".mb-refresh-msg").slideDown(500);cmjQuery_(".mb-refresh-msg").corner("3px");cmjQuery_(".mb-refresh-msg>span").click(function(){var cmextid="cmExtNode_initapp_js";var cmgui=cmjQuery_("#"+cmextid);if(cmgui&&cmgui.length<=0){cmjQuery_(".mb-refresh-msg").slideUp(500,function(){cmjQuery_(".mb-refresh-msg").remove();self.lastTrackingTS_=parseInt(new Date().getTime()/1000);});return;}
var srcurl=cmjQuery_(cmgui).attr("src");var pos=srcurl.indexOf("&t=");if(pos!=-1){srcurl=srcurl.substring(0,pos);}
srcurl=srcurl+"&t="+Number(new Date());var head=window.document.getElementsByTagName("head")[0];cmjQuery_(cmgui,head).remove();cmjQuery_("#cmExtNode_app_css",head).remove();cmjQuery_("#cmExtNode_print_css",head).remove()
cmjQuery_("#cmExtNode_app_js",head).remove();cmjQuery_(self.widgetNode_).remove();var reloadmsg=document.createElement("div");cmjQuery_(reloadmsg).attr("id","cmExtReloadMsg");cmjQuery_(reloadmsg).text("Reloading CloudMagic...");cmjQuery_(reloadmsg).css("border","1px solid #CCCCCC");cmjQuery_(reloadmsg).css("background-color","#FFFFCC");cmjQuery_(reloadmsg).css("text-align","center");cmjQuery_(reloadmsg).css("cursor","auto");cmjQuery_(reloadmsg).css("font-size","12px");cmjQuery_(reloadmsg).css("position","absolute");cmjQuery_(reloadmsg).css("padding","3px");cmjQuery_(reloadmsg).css("z-index","1001");cmjQuery_(reloadmsg).css("width","100%");cmjQuery_(reloadmsg).css("top","0px");cmjQuery_(reloadmsg).css("left","0px");cmjQuery_(document.body).append(reloadmsg);document.body.removeAttribute("CloudMagic_Loaded");var script=window.document.createElement("script");script.type="text/javascript";script.async=true;script.src=srcurl;script.setAttribute("id",cmextid);head.appendChild(script);});};proto.SetMouseWheelHandlers=function(){cmjQuery_(self.contactViewNode_).mousewheel(self.utils_.MouseWheelHandler());cmjQuery_(self.autocompleteViewNode_).mousewheel(self.utils_.MouseWheelHandler());};proto.ShowContacts=function(contacts,tbody){if(typeof contacts=="undefined"||contacts.length==0){return false;}
var len=contacts.length;cmjQuery_("#mbLoadingContacts").remove();for(var i=0;i<len;i++){var c=contacts[i];var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","mb-contacts-result-row");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-result-column");var image=document.createElement("img");if(c.photo.length>0){cmjQuery_(image).attr("src","data:image/jpeg;base64,"+c.photo);}else{cmjQuery_(image).attr("src","data:image/jpeg;base64,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");}
cmjQuery_(image).attr("class","mb-contact-small-photo");cmjQuery_(td).append(image);var name=document.createElement("div");cmjQuery_(name).attr('class','mb-contact-name');var contactname;contactname=c.name;if(contactname.length==0){contactname="<unknown>";}
cmjQuery_(name).text(contactname);cmjQuery_(td).append(name);var details=document.createElement("div");cmjQuery_(details).attr('class','mb-contact-result-wrapper mb-font-small');if(c.email&&c.email.length!=0){for(var j=0;j<c.email.length;j++){if(j!=0){cmjQuery_(details).append("&nbsp;");}
cmjQuery_(details).append(c.email[j].w);}
cmjQuery_(details).append("&nbsp;");}
if(c.phone&&c.phone.length!=0){var numbers=c.phone.split("\n");for(var j=0;j<numbers.length;j++){if(j!=0){cmjQuery_(details).append("&nbsp;");}
var number=numbers[j].replace(/^[\s|\']*/,"").replace(/[\s|\']*$/,"");cmjQuery_(details).append(number);}
cmjQuery_(details).append("&nbsp;");}
if(c.notes&&c.notes.length>0){var notes=document.createElement("div");cmjQuery_(notes).text(c.notes);cmjQuery_(details).append(notes);}
cmjQuery_(td).append(details);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);var func=self.GetOpenContactHandler(c);cmjQuery_(td).click(func);cmjQuery_(tbody).append(tr);}
return true;};proto.GetOpenContactHandler=function(contact){var func=function(){if(self.getContactTimer_){clearTimeout(self.getContactTimer_);self.getContactTimer_=null;}
self.getContactTimer_=window.setTimeout(function(){self.OpenContact(contact);},1);};return func;};proto.OpenContact=function(contact){var result=self.plugin_.GetContact(contact.id.toString(),function(response){var result=JSON.parse(response);self.ShowContact(result);});return true;};proto.ShowPreviewError=function(viewtype){cmjQuery_(self.previewNode_).empty();var div=document.createElement("div");cmjQuery_(div).attr('class','cm-error-info');var msg;var type;switch(viewtype){case self.c_.MAIL:type="mail";break;case self.c_.DOC:type="document";break;case self.c_.CONTACT:type="contact";break;case self.c_.EVENT:type="calendar";break;}
msg="Failed to get "+type+" details,  try after sometime";cmjQuery_(div).html(msg);cmjQuery_(self.previewNode_).append(div);self.ShowView(self.c_.M_VIEW);return;};proto.CheckForError=function(result,type){if(result.hasOwnProperty("error")&&result.error.length>1){self.ShowPreviewError(type);return true;}
return false;};proto.ShowContact=function(contact){if(self.CheckForError(contact,self.c_.CONTACT)==true){return;}
var previewnode=document.createElement("div");cmjQuery_(previewnode).attr('class','mb-preview-container');self.previewContentNode_=previewnode;cmjQuery_(previewnode).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});var contactcontainer=document.createElement("div");cmjQuery_(contactcontainer).attr('class','cm-preview-container');var contactinfo=document.createElement("div");cmjQuery_(contactinfo).attr('class','cm-contact-info');var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).attr("class","mb-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var tr=document.createElement("tr");cmjQuery_(tr).attr('class',"mb-contact-result-row");var td=document.createElement("td");cmjQuery_(td).width("100%");cmjQuery_(td).attr("valign","top");cmjQuery_(td).css("border-bottom","1px solid #EAEAEA");var innertable=document.createElement("table");cmjQuery_(innertable).attr({cellspacing:0,cellpadding:0});cmjQuery_(innertable).css('table-layout','fixed');cmjQuery_(innertable).attr("class","mb-font-normal");cmjQuery_(innertable).css('width','100%');var innertbody=document.createElement("tbody");var innertr=document.createElement("tr");var innertd=document.createElement("td");var photo=document.createElement("img");if(contact.photo.length==0){cmjQuery_(photo).attr("src","data:image/jpeg;base64,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");}else{cmjQuery_(photo).attr("src","data:image/jpeg;base64,"+contact.photo);}
cmjQuery_(photo).width(64);cmjQuery_(photo).height(64);cmjQuery_(innertd).css('width','25%');cmjQuery_(innertd).attr("valign","top");cmjQuery_(innertd).append(photo);cmjQuery_(innertr).append(innertd);cmjQuery_(innertbody).append(innertr);cmjQuery_(innertable).append(innertbody);cmjQuery_(td).append(innertable);cmjQuery_(tr).append(td);var innertd=document.createElement("td");cmjQuery_(innertd).attr("class","mb-contact-info-value-padding");cmjQuery_(innertd).attr("valign","top");var name=document.createElement("div");cmjQuery_(name).attr('class','mb-contact-info-name cm-font-bigger mb-single-line mb-preview-search-value');cmjQuery_(name).text(contact.name);cmjQuery_(innertd).append(name);if(contact.fullname.length>0){var fullname=document.createElement("div");var fullname1=contact.fullname[0].f;var nickname=contact.fullname[0].n;if(fullname1!=contact.name&&fullname1!=nickname){cmjQuery_(innertd).append("<br/>");}else{cmjQuery_(innertd).append(fullname);}
if(nickname&&nickname!=contact.name&&nickname!=fullname1){cmjQuery_(fullname).append("\""+nickname+"\"");}else{cmjQuery_(innertd).append("<br/>");}
cmjQuery_(fullname).addClass('mb-preview-search-value');}else{cmjQuery_(innertd).append("<br/>");cmjQuery_(innertd).append("<br/>");}
cmjQuery_(innertd).append(fullname);var orgdetails=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey mb-preview-search-value");cmjQuery_(orgdetails).append(titlespan);if(contact.org.length>0){var designation=contact.org[0].t;var companyname=contact.org[0].n;var contactorg;contactorg=designation;if(designation!=undefined&&designation.length>0&&companyname!=undefined&&companyname.length>0){contactorg=contactorg+", ";}
cmjQuery_(orgdetails).append(contactorg+companyname);cmjQuery_(orgdetails).attr("class","mb-preview-search-value");cmjQuery_(innertd).append(orgdetails);}else{cmjQuery_(innertd).append("<br/>");}
var gotolink=document.createElement("div");self.AddLinkToContact(contact,gotolink);cmjQuery_(innertd).append(gotolink);cmjQuery_(innertr).append(innertd);cmjQuery_(contacttbody).append(tr);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(contactinfo).append(contacttable);var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).attr("id","mbContactDisc");cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).attr("class","cm-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var tr=document.createElement("tr");cmjQuery_(tr).attr('class',"mb-contact-result-row");var td=document.createElement("td");cmjQuery_(td).width("100%");cmjQuery_(td).attr("class","mb-preview-search-value-body");if(contact.email.length>0){var emaildiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(emaildiv).append(titlespan);var param="emails_";self.common_.CreateContactTableView(emaildiv,contact.email,param,false,contact.accountemail);cmjQuery_(td).append(emaildiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.phonelist.length>0){var phonediv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(phonediv).append(titlespan);var param="phonelist_";self.common_.CreateContactTableView(phonediv,contact.phonelist,param,false,contact.accountemail);cmjQuery_(td).append(phonediv);cmjQuery_(td).append("<br/><br/>");}
if(contact.address.length>0){var addressdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(addressdiv).append(titlespan);var param="address_";self.common_.CreateContactTableView(addressdiv,contact.address,param,false,contact.accountemail);cmjQuery_(td).append(addressdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.events.length>0){var eventdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(eventdiv).append(titlespan);self.common_.CreateContactTableView(eventdiv,contact.events,false,false,contact.accountemail);cmjQuery_(td).append(eventdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.websites.length>0){var websitediv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(websitediv).append(titlespan);var param="websites_";self.common_.CreateContactTableView(websitediv,contact.websites,param,false,contact.accountemail);cmjQuery_(td).append(websitediv);cmjQuery_(td).append("<br/><br/>");}
if(contact.relations.length>0){var relationdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(relationdiv).append(titlespan);self.common_.CreateContactTableView(relationdiv,contact.relations,false,false,contact.accountemail);cmjQuery_(td).append(relationdiv);cmjQuery_(td).append("<br/>");}
if(contact.imessanger.length>0){var messangerdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(messangerdiv).append(titlespan);var param="imsg_";self.common_.CreateContactTableView(messangerdiv,contact.imessanger,param,false,contact.accountemail);cmjQuery_(td).append(messangerdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.notes.length>0){var notes=document.createElement("div");cmjQuery_(notes).attr('class','mb-note-caption mb-grey');cmjQuery_(notes).html("Notes");cmjQuery_(td).append(notes);var notes=document.createElement("div");cmjQuery_(notes).attr('class','mb-contact-notes');cmjQuery_(notes).text(contact.notes);cmjQuery_(td).append(notes);}
cmjQuery_(tr).append(td);cmjQuery_(contacttbody).append(tr);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(contactinfo).append(contacttable);cmjQuery_(contactcontainer).append(contactinfo);cmjQuery_(previewnode).append(contactcontainer);cmjQuery_(self.previewNode_).empty();self.AddContactToolbar(contact,self.previewNode_);cmjQuery_(self.previewNode_).append(previewnode);self.ShowView(self.c_.M_VIEW);self.activePreview_=self.c_.CONTACT;self.getContactTimer_=window.setTimeout(function(){self.ResizeResultPane();self.getContactTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.HighlightMailView();self.utils_.ConvertEmailToHyperlink(self.previewNode_,contact.accountemail);},10);},10);};proto.ShowMails=function(mails,tbody,viewtype){if(typeof mails=="undefined"||mails.length==0){return false;}
var len=mails.length;cmjQuery_("#mbLoadingMails").remove();cmjQuery_("#mbLoadingMailList").remove();if(self.searchMailResultCount_==0){self.mailRecTsRowId_=mails[0].tsrowid;}
for(var i=0;i<len;i++){var m=mails[i];var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","mb-mails-result-row");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-result-column mb-mail-result");self.utils_.AppendDate(td,m.ts,m.type,true);self.utils_.AppendAttachmentIcon(td,m.has_attachments,m.attachments);self.AppendSearchResultSubject(m,td);self.AppendSearchResultName(m,td);self.AppendSearchResultBody(m,td);self.mailRecIndex_=m.recindex;cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);var func=self.GetShowMailClickHandler(m);cmjQuery_(td).click(func);cmjQuery_(tbody).append(tr);}
return true;};proto.AppendSearchResultBody=function(mail,node){var d=document.createElement("div");cmjQuery_(d).attr("class","mb-result-mail-body");cmjQuery_(d).text(mail.body);cmjQuery_(node).append(d);};proto.AppendSearchResultName=function(mail,node){var d=document.createElement("div");var isdraft=false;cmjQuery_(d).attr('class','mb-single-line mb-preview-list-from-to-details mb-font-big');var fromtodetails="";if(mail.type==2||mail.type==0){if(mail.to.length>0){if(mail.to[0].n.length>0){fromtodetails=mail.to[0].n;}else{fromtodetails=mail.to[0].e;}}
if(fromtodetails.length==0&&mail.cc.length>0){if(mail.cc[0].n.length>0){fromtodetails=mail.cc[0].n;}else{fromtodetails=mail.cc[0].e;}}
if(fromtodetails.length==0&&mail.bcc.length>0){if(mail.bcc[0].n.length>0){fromtodetails=mail.bcc[0].n;}else{fromtodetails=mail.bcc[0].e;}}
if(fromtodetails.length==0){if(mail.type==0){fromtodetails="<span class='cm-draft-caption'>Draft<span>";isdraft=true;}else{fromtodetails="<unknown>";}}}else{if(mail.sname.length>0){fromtodetails=mail.sname;}else if(mail.from.length>0){fromtodetails=mail.from;}else{fromtodetails="<unknown>";}}
if(isdraft!=true){cmjQuery_(d).text(fromtodetails);}else{cmjQuery_(d).html(fromtodetails);}
cmjQuery_(node).append(d);};proto.AppendSearchResultSubject=function(mail,node){var d=document.createElement("div");cmjQuery_(d).attr('class','mb-single-line mb-preview-list-subject mb-font-bold  mb-font-big');cmjQuery_(d).text(mail.subject);cmjQuery_(node).append(d);};proto.ShowEvents=function(events,tbody,viewtype){if(typeof events=="undefined"||events.length==0){self.utils_.CMLOG("ShowEvents Failed");return false;}
var len=events.length;cmjQuery_("#mbLoadingEvents").remove();cmjQuery_("#mbLoadingEventList").remove();self.common_.AddShowPastEventURL(tbody);if(self.searchEventResultCount_==0){self.eventRecTsRowId_=events[0].tsrowid;}
var i;var todaydatets=self.common_.getEventDateTimeStampValue();var tr;var td;for(i=0;i<len;i++){var event=events[i];self.eventRecIndex_=event.recindex;var eventdatets=self.common_.getEventDateTimeStampValue(event.starttime*1000);var shownewdateheader=false;var istoday=false;if((eventdatets>=todaydatets)&&(eventdatets<(todaydatets+86400000))){istoday=true;}
var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","mb-event-result-row");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-result-column mb-mail-result");var div=document.createElement("div");cmjQuery_(div).addClass("mb-single-line mb-preview-list-from-to-details mb-font-normal mb-font-bold");cmjQuery_(div).text(event.what);cmjQuery_(td).append(div);var eventdate=self.common_.GetFormattedEventDate(event,eventdatets,todaydatets,istoday);div=document.createElement("div");cmjQuery_(div).addClass("mb-single-line mb-event-date-row");cmjQuery_(div).html(eventdate);cmjQuery_(td).append(div);div=document.createElement("div");cmjQuery_(div).addClass("mb-single-line mb-preview-list-from-to-details mb-font-normal mb-result-event-body");var details;details=event.description;if(event.where.length>0){if(details.length>0){details+=" | ";}
details+=event.where;}
cmjQuery_(div).text(details);cmjQuery_(td).append(div);var func=self.GetShowEventClickHandler(event);cmjQuery_(td).click(func);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);}
return true;};proto.ShowDocs=function(docs,tbody,viewtype){if(typeof docs=="undefined"||docs.length==0){return false;}
var len=docs.length;cmjQuery_("#mbLoadingDocs").remove();cmjQuery_("#mbLoadingDocList").remove();if(self.searchDocResultCount_==0){self.docRecTsRowId_=docs[0].tsrowid;}
for(var i=0;i<len;i++){var d=docs[i];var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","mb-docs-result-row");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-result-column mb-mail-result");self.docRecIndex_=d.recindex;self.utils_.AppendDate(td,d.updatedtime,d.type,false);self.AppendDocTitle(d,td);self.AppendDocOwner(d,td);self.AppendDocContent(d,td);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);var func=self.GetShowDocClickHandler(d);cmjQuery_(td).click(func);cmjQuery_(tbody).append(tr);}
return true;};proto.AppendDocOwner=function(doc,node){var d=document.createElement("div");cmjQuery_(d).attr('class','mb-single-line mb-preview-list-from-to-details mb-font-normal');cmjQuery_(d).text(doc.owner);cmjQuery_(node).append(d);};proto.AppendDocTitle=function(doc,node){var d=document.createElement("div");cmjQuery_(d).attr('class','mb-single-line mb-preview-list-subject mb-font-bold mb-font-big');cmjQuery_(d).text(doc.title);self.common_.AddDocFolderInfo(doc,d);cmjQuery_(node).append(d);};proto.AppendDocContent=function(doc,node){var d=document.createElement("div");cmjQuery_(d).attr("class","mb-result-mail-body");filetype=doc.type.toLowerCase();if(filetype=="document"||filetype=="spreadsheet"||filetype=="presentation"){var docContent=self.utils_.addBlankToHTMLLinks(doc.content);cmjQuery_(d).text(docContent);}else{cmjQuery_(d).append("No preview available, ");cmjQuery_(d).append("type: "+doc.type+", ");}
cmjQuery_(node).append(d);};proto.ShowACResult=function(result){try{if(self.common_.CheckForVersionConflict()==true){self.utils_.CMLOG("VersionConflict");return;}
if(result.hasOwnProperty("isthreadavailable")&&result.isthreadavailable==0){self.common_.ReExecuteAutoComplete();return;}
if(result.hasOwnProperty("issqliteerror")&&result.issqliteerror==1){self.common_.ShowUnableToReadDataFileMsg(result.logpath);return;}
if(result.accountcount==0){self.common_.ShowNoAccountMsg(result.unregisteredaccount);return;}
cmjQuery_(self.autocompleteViewNode_).empty();var mailtable=document.createElement("table");cmjQuery_(mailtable).attr({cellspacing:0,cellpadding:0});cmjQuery_(mailtable).attr("id","mbMailsTable");cmjQuery_(mailtable).css('table-layout','fixed');cmjQuery_(mailtable).css('display','none');cmjQuery_(mailtable).attr("class","mb-font-normal");cmjQuery_(mailtable).css('width','100%');var mailtbody=document.createElement("tbody");var mailstatus=self.ShowMails(result.mails,mailtbody,self.c_.AC_VIEW);cmjQuery_(mailtable).append(mailtbody);cmjQuery_(self.autocompleteViewNode_).append(mailtable);self.mailsTbody_=mailtbody;var doctable=document.createElement("table");cmjQuery_(doctable).attr({cellspacing:0,cellpadding:0});cmjQuery_(doctable).attr("id","mbDocsTable");cmjQuery_(doctable).css('table-layout','fixed');cmjQuery_(doctable).css('display','none');cmjQuery_(doctable).attr("class","mb-font-normal");cmjQuery_(doctable).css('width','100%');var doctbody=document.createElement("tbody");var docstatus=self.ShowDocs(result.docs,doctbody,self.c_.AC_VIEW);cmjQuery_(doctable).append(doctbody);cmjQuery_(self.autocompleteViewNode_).append(doctable);self.docsTbody_=doctbody;var eventtable=document.createElement("table");cmjQuery_(eventtable).attr({cellspacing:0,cellpadding:0});cmjQuery_(eventtable).attr("id","mbEventsTable");cmjQuery_(eventtable).css('table-layout','fixed');cmjQuery_(eventtable).css('display','none');cmjQuery_(eventtable).attr("class","mb-font-normal");cmjQuery_(eventtable).css('width','100%');var eventtbody=document.createElement("tbody");var eventstatus=self.ShowEvents(result.events,eventtbody,self.c_.AC_VIEW);cmjQuery_(eventtable).append(eventtbody);cmjQuery_(self.autocompleteViewNode_).append(eventtable);self.eventsTbody_=eventtbody;var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).attr("id","mbContactsTable");cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).css('display','none');cmjQuery_(contacttable).attr("class","mb-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var contactstatus=self.ShowContacts(result.contacts,contacttbody);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(self.autocompleteViewNode_).append(contacttable);self.contactsTbody_=contacttbody;switch(parseInt(self.pref_.SelectedWidgetTab)){case self.c_.DOC:cmjQuery_("#mbDocsTable").show();break;case self.c_.CONTACT:cmjQuery_("#mbContactsTable").show();break;case self.c_.EVENT:cmjQuery_("#mbEventsTable").show();break;case self.c_.MAIL:default:cmjQuery_("#mbMailsTable").show();break;}
if(self.GetCurrentViewType()!=self.AC_VIEW){self.ShowView(self.c_.AC_VIEW);}
self.InitializeACViewKeyboardNavigation(self.c_.MAIL);self.InitializeACViewKeyboardNavigation(self.c_.DOC);self.InitializeACViewKeyboardNavigation(self.c_.CONTACT);self.InitializeACViewKeyboardNavigation(self.c_.EVENT);self.SetSelectedRow(-1);}catch(e){self.utils_.CMLOG(e);}};proto.AddCategoryHeader=function(tbody,caption){var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-search-category");cmjQuery_(td).html(caption);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);};proto.SetNewUrl=function(){};proto.AddCategoryMenu=function(anchorNode){var div=document.createElement("div");cmjQuery_(div).attr("class","mb-category-wrapper");var mails=document.createElement("a");var docs=document.createElement("a");var contacts=document.createElement("a");var calendars=document.createElement("a");cmjQuery_(mails).text("Mails");cmjQuery_(mails).attr("class","mb-category-menu");cmjQuery_(mails).attr("href","#");cmjQuery_(mails).click(function(){self.HandleTabSelection(this,self.c_.MAIL);});cmjQuery_(docs).text("Docs");cmjQuery_(docs).attr("class","mb-link mb-category-menu");cmjQuery_(docs).attr("href","#");cmjQuery_(docs).click(function(){self.HandleTabSelection(this,self.c_.DOC);});cmjQuery_(contacts).text("Contacts");cmjQuery_(contacts).attr("class","mb-link mb-category-menu");cmjQuery_(contacts).attr("href","#");cmjQuery_(contacts).click(function(){self.HandleTabSelection(this,self.c_.CONTACT);});cmjQuery_(calendars).text("Calendar");cmjQuery_(calendars).attr("class","mb-link mb-category-menu");cmjQuery_(calendars).attr("href","#");cmjQuery_(calendars).click(function(){self.HandleTabSelection(this,self.c_.EVENT);});cmjQuery_(div).append(mails);cmjQuery_(div).append(calendars);cmjQuery_(div).append(docs);cmjQuery_(div).append(contacts);cmjQuery_(mails).focus(function(){self.tabNavigatorInFocus_=self.c_.MAIL;});cmjQuery_(mails).blur(function(){self.tabNavigatorInFocus_=null;});cmjQuery_(calendars).focus(function(){self.tabNavigatorInFocus_=self.c_.EVENT;});cmjQuery_(calendars).blur(function(){self.tabNavigatorInFocus_=null;});cmjQuery_(docs).focus(function(){self.tabNavigatorInFocus_=self.c_.DOC;});cmjQuery_(docs).blur(function(){self.tabNavigatorInFocus_=null;});cmjQuery_(contacts).focus(function(){self.tabNavigatorInFocus_=self.c_.CONTACT;});cmjQuery_(contacts).blur(function(){self.tabNavigatorInFocus_=null;});switch(parseInt(self.pref_.SelectedWidgetTab)){case self.c_.DOC:cmjQuery_(docs).removeClass("mb-link");cmjQuery_(docs).addClass("mb-category-menu-selected");break;case self.c_.EVENT:cmjQuery_(contacts).removeClass("mb-link");cmjQuery_(calendars).addClass("mb-category-menu-selected");break;case self.c_.CONTACT:cmjQuery_(contacts).removeClass("mb-link");cmjQuery_(contacts).addClass("mb-category-menu-selected");break;case self.c_.MAIL:default:cmjQuery_(mails).removeClass("mb-link");cmjQuery_(mails).addClass("mb-category-menu-selected");break;}
cmjQuery_(anchorNode).append(div);};proto.SaveTabSelected=function(type){var key=self.c_.DEFAULT_TAB_SELECTED;if(self.domain_==self.c_.MAIL){key=key+"_Gmail";}else if(self.domain_==self.c_.DOC){key=key+"_Gdoc";}else if(self.domain_==self.c_.EVENT){key=key+"_Gcal";}
self.plugin_.SetPreferences(key,type.toString(),null);};proto.HandleTabSelection=function(node,tabtype){self.HandlePopupWidth();cmjQuery_(self.previewNode_).hide();cmjQuery_(".mb-category-menu").removeClass("mb-category-menu-selected");cmjQuery_(".mb-category-menu").addClass("mb-link");cmjQuery_(node).removeClass("mb-link");cmjQuery_(node).addClass("mb-category-menu-selected");switch(tabtype){case self.c_.DOC:cmjQuery_("#mbMailsTable").hide();cmjQuery_("#mbContactsTable").hide();cmjQuery_("#mbEventsTable").hide();cmjQuery_("#mbDocsTable").show();self.SetSelectedRow(self.currentDocSelectionRowId_);break;case self.c_.EVENT:cmjQuery_("#mbMailsTable").hide();cmjQuery_("#mbDocsTable").hide();cmjQuery_("#mbContactsTable").hide();cmjQuery_("#mbEventsTable").show();self.SetSelectedRow(self.currentCalSelectionRowId_);break;case self.c_.CONTACT:cmjQuery_("#mbMailsTable").hide();cmjQuery_("#mbDocsTable").hide();cmjQuery_("#mbEventsTable").hide();cmjQuery_("#mbContactsTable").show();self.SetSelectedRow(self.currentContactSelectionRowId_);break;case self.c_.MAIL:default:cmjQuery_("#mbDocsTable").hide();cmjQuery_("#mbContactsTable").hide();cmjQuery_("#mbEventsTable").hide();cmjQuery_("#mbMailsTable").show();self.SetSelectedRow(self.currentMailSelectionRowId_);break;}
self.pref_.SelectedWidgetTab=tabtype;window.setTimeout(function(){self.SaveTabSelected(tabtype);},1);self.utils_.SetPopoutWithSearchUrl(true,self.activeSearchString_,self.GetActiveTab(),self.version_);cmjQuery_(node).focus();};};