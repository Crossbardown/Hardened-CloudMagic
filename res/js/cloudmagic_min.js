if("undefined"==typeof(CloudMagic)){var CloudMagic={};};$.fn.hasAttr=function(name){return this.attr(name)!==undefined;};CloudMagic.Interface=function(){var self=this;var proto=CloudMagic.Interface.prototype;self.utils_=new CloudMagic.WidgetUtilities();self.highlight_=new CloudMagic.WidgetHighlightWrapper();self.dateFormat_=new CloudMagic.DateUtilities();self.c_=new CloudMagic.Constants();self.common_=new CloudMagic.Common(self,false);self.pref_={};self.uuid_=null;self.version_=null;self.port_=null;self.statusMsg_=null;self.attachmentDownloadStatus_=null;self.searchBox_=cmjQuery_("#cmSearchBox");self.clearButton_=cmjQuery_("#cmClearButton");self.statusMsgNode_=cmjQuery_(".cm-status-msg");self.selectAccount_=cmjQuery_(".cm-select-account");self.acTimeout_=null;self.acMoreContactsTimeout=null;self.acMoreMailsTimeout=null
self.acMoreDocsTimeout=null;self.searchMailResultCount_=0;self.searchMailListResultCount_=0;self.searchContactResultCount_=0;self.searchDocResultCount_=0;self.searchDocListResultCount_=0;self.searchMailResultCountPrev_=0;self.searchContactResultCountPrev_=0;self.searchDocResultCountPrev_=0;self.searchMailListResultCountPrev_=0;self.searchDocListResultCountPrev_=0;self.mailRecIndex_=0;self.mailRecTsRowId_=0;self.docRecIndex_=0;self.docRecTsRowId_=0;self.eventRecIndex_=0;self.eventRecTsRowId_=0;self.restartMoreMailsRequest_=false;self.restartMoreDocsRequest_=false;self.restartMoreContactsRequest_=false;self.activeSearchString_="";self.searchString_="";self.prevSearchableItems=null;self.SearchableItems=self.c_.DEFAULT_SEARCHABLE_ITEMS;self.maxSearchResultCount_=self.c_.MAX_SEARCH_RESULT_COUNT;self.maxContactSearchResultCount_=self.c_.MAX_SEARCH_RESULT_COUNT;self.autocompleteViewNode_=cmjQuery_(".cm-search-result-wrapper");self.category_="";self.usageCount_=0;self.lastTrackingTS_=0;self.accountInfo="";self.currentURL_="";self.accountEmail_="all";self.isSidebar_=false;CloudMagic.CMBROWSER=(cmjQuery_.browser.webkit==true)?"gc":"mf";proto.Create=function(){cmjQuery_(self.searchBox_).attr('value',self.c_.EMPTY_SEARCH);self.plugin_=self.utils_.InsertPlugin();self.common_.CalculateSearchResultCount();self.plugin_.SetUIType(1,function(){});self.plugin_.GetPreferences(self.GetPreferencesHandler());};proto.GetPreferencesHandler=function(){var func=function(response){self.HandlePreferences(response);self.GetAppInfo();self.SetEventHandlers();self.GetAccountInfo();if(CloudMagic.CMSHOWNEWFEATUREMSG=="1"){cmjQuery_("#cmSeeNewFeaturesWrapper").show();}};return func;};proto.GetAccountInfo=function(){self.plugin_.GetIndexStatus(self.GetAccountInfoHandler());cmjQuery_("#cmSelectAccount, #cmActiveAccount").click(function(){self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideDown(400);return false;});};proto.GetAccountInfoHandler=function(){var func=function(response){var result=JSON.parse(response);if(result&&typeof(result)!=undefined&&result.isValidResponse==0){self.utils_.Sleep(1000);self.plugin_.GetIndexStatus(self.GetAccountInfoHandler());return;}
self.statusMsg_=result;self.SetStatusMessage();var info=JSON.stringify(result.accounts);if(result.accounts!=null&&info!=self.accountInfo){self.ShowAccounts(result.accounts);self.accountInfo=info;}
self.HandleDefaultParam(false);cmjQuery_(self.searchBox_).focus();window.setTimeout(function(){self.common_.UpdateStatus();},1000);};return func;};proto.ShowAccounts=function(accounts){self.accountLength_=accounts.length;if(self.accountLength_==0){return;}
cmjQuery_(self.selectAccount_).empty();var div=document.createElement("div");cmjQuery_(div).attr("class","cm-select-account-item");cmjQuery_(div).text("all");cmjQuery_(div).click(self.SetActiveAccountHandler("all"));cmjQuery_(self.selectAccount_).append(div);for(var i=0;i<self.accountLength_;i++){var div=document.createElement("div");cmjQuery_(div).attr("class","cm-select-account-item");cmjQuery_(div).append(accounts[i].email);cmjQuery_(self.selectAccount_).append(div);cmjQuery_(div).click(self.SetActiveAccountHandler(accounts[i].email));}};proto.SetActiveAccountHandler=function(email){var func=function(){if(email=="undefined"){email="all";}
if(cmjQuery_("#cmActiveAccount").text()==email){return;}
cmjQuery_("#cmActiveAccount").text(email);self.accountEmail_=email;if(self.accountLength_==1){return;}
self.prevSearchableItems=0;self.utils_.TriggerKeypress(self.searchBox_);return;};return func;};proto.SelectCategoryMenu=function(){cmjQuery_(".cm-search-option").removeClass("cm-search-option-item-selected");cmjQuery_(".cm-search-option").removeClass("cm-search-option-item-unselected");cmjQuery_(".cm-search-option").addClass("cm-search-option-item-unselected");cmjQuery_(".cm-search-menu").removeClass("cm-top-bar-item-selected");cmjQuery_(".cm-search-menu").removeClass("cm-link");cmjQuery_(".cm-search-menu").addClass("cm-link");cmjQuery_(".cm-search-option-"+self.category_).removeClass("cm-search-option-item-unselected");cmjQuery_(".cm-search-option-"+self.category_).addClass("cm-search-option-item-selected");cmjQuery_(".cm-search-menu-"+self.category_).removeClass("cm-link");cmjQuery_(".cm-search-menu-"+self.category_).addClass("cm-top-bar-item-selected");switch(self.category_){case"all":self.SearchableItems=self.c_.DEFAULT_SEARCHABLE_ITEMS;break;case"mail":self.SearchableItems=self.c_.MAIL;break;case"doc":self.SearchableItems=self.c_.DOC;break;case"contact":self.SearchableItems=self.c_.CONTACT;break;case"event":self.SearchableItems=self.c_.EVENT;break;}};proto.HandleDefaultParam=function(resethash){var category=self.utils_.GetURLParameters("category");if(category==null||category.length==0){category="all";}
self.category_=category;var search=self.utils_.GetURLParameters("query");if(search==null||search.length==0){search=cmjQuery_.cookie("_mWS");if(search==null){search="";}}
self.accountEmail_=self.utils_.GetURLParameters("account");if(self.accountEmail_==null||self.accountEmail_.length==0||self.accountEmail_=="undefined"){self.accountEmail_="all";}
cmjQuery_("#cmActiveAccount").text(self.accountEmail_);self.SelectCategoryMenu();if(search.length>0||self.activeSearchString_.length>0){document.title=search+" - CloudMagic Search";cmjQuery_(self.searchBox_).val(search);cmjQuery_(self.searchBox_).focus();self.HandleClearButton();self.common_.HandleAutoComplete(0,resethash);}};proto.GetAppUUIDHandler=function(){var func=function(response){self.uuid_=response;};return func;};proto.GetAppVersionHandler=function(){var func=function(response){self.version_=JSON.parse(response);var cver_=self.version_.majorversion+"_"+
self.version_.minorversion+"_"+
self.version_.betastring;if(CloudMagic.cmDebug=="0"&&CloudMagic.CMSCRIPTVER!=cver_){window.location="upgrade.html";}else{var cver=self.version_.majorversion+"."+self.version_.minorversion+" "+self.version_.betastring;cmjQuery_("#cmVersion").text(cver);}};return func;};proto.GetAppInfo=function(){self.plugin_.GetAppUUID(self.GetAppUUIDHandler());self.plugin_.GetAppVersion(self.GetAppVersionHandler());self.plugin_.GetAppPort(self.GetAppPortHandler());};proto.HandlePreferences=function(response){self.pref_=JSON.parse(response);if(typeof self.pref_.SafariUpdateCheckTime=="undefined"||isNaN(self.pref_.SafariUpdateCheckTime)){self.pref_.SafariUpdateCheckTime=0;}};proto.InitApplicationLinks=function(response){self.port_=response;var directpage="cloudmagic.html";var baseurl="http://127.0.0.1:"+self.port_+"/";cmjQuery_("#cmManageAccounts").attr("href",baseurl+"index.html");cmjQuery_("#cmPreferecnes").attr("href",baseurl+"preferences.html?p=1");cmjQuery_("#cmHelp").attr("href",baseurl+"help.html");cmjQuery_(".cm-search-option-all,.cm-search-menu-all").click(function(){self.HandleCategoryChange(this,"all");});cmjQuery_(".cm-search-option-mail, .cm-search-menu-mail").click(function(){self.HandleCategoryChange(this,"mail");});cmjQuery_(".cm-search-option-doc, .cm-search-menu-doc").click(function(){self.HandleCategoryChange(this,"doc");});cmjQuery_(".cm-search-option-contact, .cm-search-menu-contact").click(function(){self.HandleCategoryChange(this,"contact");});cmjQuery_(".cm-search-option-event, .cm-search-menu-event").click(function(){self.HandleCategoryChange(this,"event");});};proto.SetNewUrl=function(){var url=window.location.protocol+"//"+
window.location.host+
window.location.pathname+"?ts="+CloudMagic.CMSCRIPTTS+"#search?category="+self.category_+"&query="+encodeURIComponent(self.searchString_)+"&account="+encodeURIComponent(self.accountEmail_);self.currentURL_=url;window.location=url;document.title=self.searchString_+" - CloudMagic Search";};proto.HandleCategoryChange=function(elem,category){if(cmjQuery_(elem).hasClass("cm-top-bar-item-selected")==true||cmjQuery_(elem).hasClass("cm-search-option-item-selected")==true){return;}
self.category_=category;self.SetNewUrl();self.HandleDefaultParam(false);};proto.GetAppPortHandler=function(){var func=function(response){self.InitApplicationLinks(response);};return func;};proto.SetEventHandlers=function(){cmjQuery_(document).click(function(e){var btn=self.utils_.GetButton(e);if(btn==3){return;}
if(cmjQuery_(e.target).parent().hasClass("mb-locate-link")!=true&&cmjQuery_(e.target).attr("tagName")!="A"){self.common_.ClosePreview();}
cmjQuery_(self.selectAccount_).slideUp(300);});cmjQuery_(document).keydown(function(e){var code=self.utils_.GetKeyCode(e);if(code==27){self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideUp(300);}});cmjQuery_(self.searchBox_).focus(function(){if(cmjQuery_(this).val()===self.c_.EMPTY_SEARCH){cmjQuery_(self.searchBox_).val("");}
cmjQuery_(this).removeClass("cm-search-empty");}).blur(function(){if(cmjQuery_(this).val()===''||cmjQuery_(this).val()===self.c_.EMPTY_SEARCH){cmjQuery_(this).addClass("cm-search-empty");cmjQuery_(this).val(self.c_.EMPTY_SEARCH);}});cmjQuery_(self.clearButton_).click(function(e){cmjQuery_(self.searchBox_).val("");self.HandleClearButton();self.utils_.TriggerKeypress(self.searchBox_);cmjQuery_(self.searchBox_).focus();});if(cmjQuery_.browser.webkit==true){cmjQuery_(self.searchBox_).keyup(function(e){self.common_.SearchBoxKeypressHandler(e,self,false);});}else{cmjQuery_(self.searchBox_).keypress(function(e){self.common_.SearchBoxKeypressHandler(e,self,false);});}
cmjQuery_(document).keydown(function(e){self.HandleDocumentKeydown(e);});cmjQuery_.address.externalChange(function(e){if(window.location.href!=self.currentURL_){self.HandleDefaultParam(false);}});cmjQuery_(".cm-search-button").click(function(){self.utils_.TriggerKeypress(self.searchBox_);});self.HandleClearButton();cmjQuery_(window).resize(function(){self.SetPanelSize();});cmjQuery_(".cm-back-to-top").click(function(){cmjQuery_(window).scrollTop(0);cmjQuery_(this).hide();});cmjQuery_(window).scroll(function(e){var id;if(cmjQuery_(window).scrollTop()>0){cmjQuery_(".cm-back-to-top").show();}else{cmjQuery_(".cm-back-to-top").hide();}
if((self.SearchableItems&self.c_.MAIL)>0){id="#mbSearchMoreMails";if(cmjQuery_(id).length!=0&&self.utils_.IsScrolledIntoView(id)==true){id=id+">td";cmjQuery_(id).trigger("click");}}
if((self.SearchableItems&self.c_.DOC)>0){id="#mbSearchMoreDocs";if(cmjQuery_(id).length!=0&&self.utils_.IsScrolledIntoView(id)==true){id=id+">td";cmjQuery_(id).trigger("click");}}
if((self.SearchableItems&self.c_.CONTACT)>0){id="#mbSearchMoreContacts";if(cmjQuery_(id).length!=0&&self.utils_.IsScrolledIntoView(id)==true){id=id+">td";cmjQuery_(id).trigger("click");}}
if((self.SearchableItems&self.c_.EVENT)>0){id="#mbSearchMoreEvents";if(cmjQuery_(id).length!=0&&self.utils_.IsScrolledIntoView(id)==true){id=id+">td";cmjQuery_(id).trigger("click");}}});cmjQuery_("#cmHideUpdateMsg").click(function(){cmjQuery_(".cm-safari-update").hide();});cmjQuery_("#cmReload").click(function(){if(window.location.protocol=="http:"||window.location.protocol=="https:"){window.location="upgrade.html";}else{window.location.reload();}});cmjQuery_(self.searchBox_).bind('paste',function(e){self.common_.HandleMouseEvents();});cmjQuery_(self.searchBox_).bind('cut',function(e){self.common_.HandleMouseEvents();});cmjQuery_(self.searchBox_).bind('undo',function(e){self.common_.HandleMouseEvents();});var sharelinks=cmjQuery_(".cm-sharelinks");self.utils_.AddShareLinks(sharelinks,self.accountEmail_,false);if(cmjQuery_.os.name=="mac"){cmjQuery_(".cm-bookmark").text("Press CMD+D to bookmark this page");}};proto.HandleDocumentKeydown=function(e){var code=self.utils_.GetKeyCode(e);if(code==27){return;}else if(code==191||code==111){if(e.ctrlKey==1){self.common_.ClosePreview();cmjQuery_(self.searchBox_).focus();cmjQuery_(self.searchBox_).select();return false;}}else if(code==190||code==110){if(e.ctrlKey==1){if(cmjQuery_(".cm-preview-content").length>0){try{var url=cmjQuery_("#mbLocateOriginal").attr("href");self.plugin_.OpenInTab(url,"");}catch(e){self.utils_.CMLOG(e);}}}}};proto.HandleClearButton=function(){var searchval=cmjQuery_(self.searchBox_).val();if(searchval.length>0&&searchval!=self.c_.EMPTY_SEARCH){cmjQuery_(self.clearButton_).fadeIn();}else{cmjQuery_(self.clearButton_).fadeOut();}};proto.ShowView=function(viewType,resetPos){resetPos=resetPos||false;switch(viewType){case self.c_.AC_VIEW:self.common_.ClosePreview();if(self.searchString_.length==0||self.searchString_==self.c_.EMPTY_SEARCH){cmjQuery_(".cm-search-option-wrapper").hide();}else{cmjQuery_(".cm-search-option-wrapper").show();}
break;case self.c_.NO_VIEW:self.common_.ClosePreview();cmjQuery_(self.autocompleteViewNode_).empty();cmjQuery_(".cm-search-option-wrapper").hide();break;}
return;};proto.GetCurrentViewType=function(){return self.c_.AC_VIEW;};proto.ResizeResultPane=function(){return;};proto.InitializeACViewKeyboardNavigation=function(){return;};proto.InitializeMLViewKeyboardNavigation=function(){return;};proto.SetSelectedRow=function(){return;};proto.ShowACResult=function(result){if(self.common_.CheckForVersionConflict()==true){self.utils_.CMLOG("VersionConflict");return;}
if(typeof(result.isthreadavailable)!=undefined&&result.isthreadavailable==0){self.common_.ReExecuteAutoComplete();return;}
if(typeof(result.issqliteerror)!=undefined&&result.issqliteerror==1){self.common_.ShowUnableToReadDataFileMsg(result.logpath);return;}
if(result.accountcount==0){self.common_.ShowNoAccountMsg();return;}
cmjQuery_(self.autocompleteViewNode_).empty();if((self.SearchableItems&self.c_.MAIL)>0){var div=document.createElement("div");cmjQuery_(div).attr("class","cm-search-result cm-search-result-mails");var mailtable=document.createElement("table");cmjQuery_(mailtable).attr({cellspacing:0,cellpadding:0});cmjQuery_(mailtable).css('table-layout','fixed');cmjQuery_(mailtable).attr("class","cm-font-normal");cmjQuery_(mailtable).css('width','100%');var mailtbody=document.createElement("tbody");var mailstatus=self.ShowMails(result.mails,mailtbody,self.c_.AC_VIEW);cmjQuery_(mailtable).append(mailtbody);cmjQuery_(div).append(mailtable);cmjQuery_(self.autocompleteViewNode_).append(div);self.mailsTbody_=mailtbody;}
if((self.SearchableItems&self.c_.EVENT)>0){var div=document.createElement("div");cmjQuery_(div).attr("class","cm-search-result cm-search-result-events");var eventtable=document.createElement("table");cmjQuery_(eventtable).attr({cellspacing:0,cellpadding:0});cmjQuery_(eventtable).css('table-layout','fixed');cmjQuery_(eventtable).attr("class","cm-font-normal");cmjQuery_(eventtable).css('width','100%');var eventtbody=document.createElement("tbody");var eventstatus=self.ShowEvents(result.events,eventtbody);cmjQuery_(eventtable).append(eventtbody);cmjQuery_(div).append(eventtable);cmjQuery_(self.autocompleteViewNode_).append(div);self.eventsTbody_=eventtbody;}
if((self.SearchableItems&self.c_.DOC)>0){var div=document.createElement("div");cmjQuery_(div).attr("class","cm-search-result cm-search-result-docs");var doctable=document.createElement("table");cmjQuery_(doctable).attr({cellspacing:0,cellpadding:0});cmjQuery_(doctable).css('table-layout','fixed');cmjQuery_(doctable).attr("class","cm-font-normal");cmjQuery_(doctable).css('width','100%');var doctbody=document.createElement("tbody");var docstatus=self.ShowDocs(result.docs,doctbody,self.c_.AC_VIEW);cmjQuery_(doctable).append(doctbody);cmjQuery_(div).append(doctable);cmjQuery_(self.autocompleteViewNode_).append(div);self.docsTbody_=doctbody;}
if((self.SearchableItems&self.c_.CONTACT)>0){var div=document.createElement("div");cmjQuery_(div).attr("class","cm-search-result cm-search-result-contacts");var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).attr("class","cm-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var contactstatus=self.ShowContacts(result.contacts,contacttbody);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(div).append(contacttable);cmjQuery_(self.autocompleteViewNode_).append(div);self.contactsTbody_=contacttbody;}
self.SetPanelSize();};proto.SetPanelSize=function(){var fixedleftpanelwidth=166;var windowwidth=cmjQuery_(window).width();var windowheight=cmjQuery_(window).height();var left=fixedleftpanelwidth+12;if((self.SearchableItems&self.c_.CONTACT)>0&&(self.SearchableItems&self.c_.MAIL)>0&&(self.SearchableItems&self.c_.DOC)>0&&(self.SearchableItems&self.c_.EVENT)>0)
{var panelwidth=(windowwidth-fixedleftpanelwidth-65)/4;cmjQuery_(".cm-search-result").width(panelwidth);cmjQuery_(".cm-search-result-mails").css("left",left+"px");left=left+panelwidth+10;cmjQuery_(".cm-search-result-events").css("left",left+"px");left=left+panelwidth+10;cmjQuery_(".cm-search-result-docs").css("left",left+"px");left=left+panelwidth+10;cmjQuery_(".cm-search-result-contacts").css("left",left+"px");}else{var panelwidth=(windowwidth-fixedleftpanelwidth-45);cmjQuery_(".cm-search-result").width(panelwidth);cmjQuery_(".cm-search-result").css("left",left+"px");}};proto.AddCategoryHeader=function(tbody,caption,category){var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","cm-search-category-wrapper");var spanwrapper=document.createElement("span");cmjQuery_(spanwrapper).attr("class","cm-link");var span=document.createElement("span");cmjQuery_(span).attr("class","cm-search-category cm-font-big");cmjQuery_(span).addClass("cm-search-category-"+category);cmjQuery_(span).html(caption+" for <span class='cm-search-query'>"+self.searchString_+"</span>");cmjQuery_(span).click(function(){cmjQuery_(".cm-search-option-"+category).trigger("click");});cmjQuery_(spanwrapper).append(span);cmjQuery_(td).append(spanwrapper);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);};proto.ShowContacts=function(contacts,tbody){if(typeof contacts=="undefined"||contacts.length==0){return false;}
var len=contacts.length;cmjQuery_("#mbLoadingContacts").remove();if(self.category_=="all"&&cmjQuery_(".cm-contact-search-result").length==0){self.AddCategoryHeader(tbody,"Contacts","contact");}
for(var i=0;i<len;i++){var c=contacts[i];var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","cm-contact-search-result");var td=document.createElement("td");cmjQuery_(td).attr("class","cm-result-column");var image=document.createElement("img");if(c.photo.length>0){cmjQuery_(image).attr("src","data:image/jpeg;base64,"+c.photo);}else{cmjQuery_(image).attr("src","data:image/jpeg;base64,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");}
cmjQuery_(image).attr("class","cm-contact-small-photo");cmjQuery_(td).append(image);var s=document.createElement("span");cmjQuery_(s).attr('class','cm-link');var name=document.createElement("a");cmjQuery_(name).attr('class','cm-contact-name');cmjQuery_(name).attr('href','#');contactname=c.name;if(contactname.length==0){contactname="<unknown>";}
cmjQuery_(name).text(contactname);cmjQuery_(s).append(name);cmjQuery_(name).click(self.GetOpenContactHandler(c));cmjQuery_(td).append(s);var details=document.createElement("div");cmjQuery_(details).attr('class','mb-contact-result-wrapper cm-font-small');if(c.email&&c.email.length!=0){for(var j=0;j<c.email.length;j++){if(j!=0){cmjQuery_(details).append("&nbsp;");}
cmjQuery_(details).append(c.email[j].w);}
cmjQuery_(details).append("&nbsp;");}
if(c.phone&&c.phone.length!=0){var numbers=c.phone.split("\n");for(var j=0;j<numbers.length;j++){if(j!=0){cmjQuery_(details).append("&nbsp;");}
var number=numbers[j].replace(/^[\s|\']*/,"").replace(/[\s|\']*$/,"");cmjQuery_(details).append(number);}
cmjQuery_(details).append("&nbsp;");}
if(c.notes&&c.notes.length>0){var notes=document.createElement("div");cmjQuery_(notes).text(c.notes);cmjQuery_(details).append(notes);}
cmjQuery_(td).append(details);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);}
self.ShowView(self.c_.AC_VIEW);};proto.ShowEvents=function(events,tbody){if(typeof events=="undefined"||events.length==0){return false;}
var len=events.length;cmjQuery_("#mbLoadingEvents").remove();if(self.category_=="all"&&cmjQuery_(".cm-event-search-result").length==0){self.AddCategoryHeader(tbody,"Events","event");}
self.common_.AddShowPastEventURL(tbody);if(self.searchEventResultCount_==0){self.eventRecTsRowId_=events[0].tsrowid;}
var i;var todaydatets=self.common_.getEventDateTimeStampValue();var tr;var td;for(var i=0;i<len;i++){var event=events[i];self.eventRecIndex_=event.recindex;var eventdatets=self.common_.getEventDateTimeStampValue(event.starttime*1000);var shownewdateheader=false;var istoday=false;if((eventdatets>=todaydatets)&&(eventdatets<(todaydatets+86400000))){istoday=true;}
var eventtitle="";var tr=document.createElement("tr");cmjQuery_(tr).attr("class","cm-event-search-result");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr("class","cm-result-column");cmjQuery_(td).css("width","100%");cmjQuery_(tr).append(td);div=document.createElement("div");cmjQuery_(td).append(div);span=document.createElement("span");cmjQuery_(span).attr("class","cm-link");cmjQuery_(div).append(span);var atag=document.createElement("a");cmjQuery_(atag).attr('class','cm-subject mb-single-line');cmjQuery_(atag).attr('href','#');cmjQuery_(atag).text(event.what);cmjQuery_(span).append(atag);var eventdate=self.common_.GetFormattedEventDate(event,eventdatets,todaydatets,istoday);div=document.createElement("div");cmjQuery_(div).addClass("mb-single-line cm-date cm-font-normal");cmjQuery_(div).html(eventdate);cmjQuery_(td).append(div);var div=document.createElement("div");cmjQuery_(div).addClass("cm-content");var details;details=event.description;if(event.where.length>0){if(details.length>0){details+=" | ";}
details+=event.where;}
cmjQuery_(div).text(details);cmjQuery_(td).append(div);self.AppendCalendarViewThreadLink(event.viewurl,td);cmjQuery_(atag).click(self.GetOpenEventHandler(event));}
self.ShowView(self.c_.AC_VIEW);};proto.GetOpenContactHandler=function(contact){var func=function(e){if(self.IsPreviewOpen(self.c_.CONTACT,contact)==true){return false;}
self.previewInvokeNode_=e.target;self.previewInvokeEvent_=e;self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideUp(400);self.SetSelectedResult(this);self.OpenContact(contact);return false;};return func;};proto.GetOpenMailHandler=function(mail){var func=function(e){if(self.IsPreviewOpen(self.c_.MAIL,mail)==true){return false;}
self.previewInvokeNode_=e.target;self.previewInvokeEvent_=e;self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideUp(400);self.SetSelectedResult(this);self.OpenMail(mail);return false;};return func;};proto.GetOpenEventHandler=function(event){var func=function(e){if(self.IsPreviewOpen(self.c_.EVENT,event)==true){return false;}
self.previewInvokeNode_=e.target;self.previewInvokeEvent_=e;self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideUp(400);self.SetSelectedResult(this);self.OpenEvent(event);return false;};return func;};proto.SetSelectedResult=function(node){cmjQuery_(".cm-selected-result").removeClass("cm-selected-result");cmjQuery_(node).parent().parent().parent().addClass("cm-selected-result");};proto.GetOpenDocHandler=function(doc){var func=function(e){if(self.IsPreviewOpen(self.c_.DOC,doc)==true){return false;}
self.previewInvokeNode_=e.target;self.previewInvokeEvent_=e;self.common_.ClosePreview();cmjQuery_(self.selectAccount_).slideUp(400);self.SetSelectedResult(this);self.OpenDoc(doc);return false;};return func;};proto.ShowMails=function(mails,tbody,viewtype){if(typeof mails=="undefined"||mails.length==0){return false;}
var len=mails.length;cmjQuery_("#mbLoadingMails").remove();if(self.category_=="all"&&cmjQuery_(".cm-mail-search-result").length==0){self.AddCategoryHeader(tbody,"Mails","mail");}
if(self.searchMailResultCount_==0){self.mailRecTsRowId_=mails[0].tsrowid;}
for(var i=0;i<len;i++){var m=mails[i];self.common_.EscapeMailMessageId(m);var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","cm-mail-search-result");var td=document.createElement("td");cmjQuery_(td).attr("class","cm-result-column");self.AppendSearchResultSubject(m,td);self.AppendSearchResultName(m,td);self.AppendSearchResultBody(m,td);self.AppendViewThreadLink(m,td);self.mailRecIndex_=m.recindex;cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);}
self.ShowView(self.c_.AC_VIEW);return true;};proto.AppendSearchResultBody=function(mail,node){var d=document.createElement("div");cmjQuery_(d).attr("class","cm-content");cmjQuery_(d).text(mail.body);cmjQuery_(node).append(d);if(mail.body.length>=self.c_.MAX_SNIPPET_CHAR_SIZE){cmjQuery_(d).append(self.c_.ELLIPSIS);}};proto.AppendViewThreadLink=function(mail,node){var d=document.createElement("div");var mailurl=self.utils_.GetBaseMailUrl(mail.accountemail)+'#search/'+
encodeURIComponent("rfc822msgid:"+mail.messageid);var a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View thread in Gmail");cmjQuery_(a).text("View thread in Gmail");cmjQuery_(a).attr("class","cm-direct-link cm-link");cmjQuery_(node).append(a);cmjQuery_(node).append(d);};proto.AppendCalendarViewThreadLink=function(url,node){var d=document.createElement("div");var a=document.createElement("a");cmjQuery_(a).attr("href",url);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View event in Google Calendar");cmjQuery_(a).text("View event in Google Calendar");cmjQuery_(a).attr("class","cm-direct-link cm-link");cmjQuery_(node).append(a);cmjQuery_(node).append(d);};proto.AppendSearchResultName=function(mail,node){var d=document.createElement("div");var isdraft=false;cmjQuery_(d).attr('class','cm-from-to-details');var fromtodetails="";if(mail.type==2||mail.type==0){if(mail.to.length>0){if(mail.to[0].n.length>0){fromtodetails=mail.to[0].n;}else{fromtodetails=mail.to[0].e;}}
if(fromtodetails.length==0&&mail.cc.length>0){if(mail.cc[0].n.length>0){fromtodetails=mail.cc[0].n;}else{fromtodetails=mail.cc[0].e;}}
if(fromtodetails.length==0&&mail.bcc.length>0){if(mail.bcc[0].n.length>0){fromtodetails=mail.bcc[0].n;}else{fromtodetails=mail.bcc[0].e;}}
if(fromtodetails.length==0){if(mail.type==0){fromtodetails="<span class='cm-draft-caption'>Draft<span>";isdraft=true;}else{fromtodetails="<unknown>";}}}else{if(mail.sname.length>0){fromtodetails=mail.sname;}else if(mail.from.length>0){fromtodetails=mail.from;}else{fromtodetails="<unknown>";}}
if(isdraft!=true){cmjQuery_(d).text(fromtodetails);}else{cmjQuery_(d).html(fromtodetails);}
var datestring=self.dateFormat_.formatDate(mail.ts*1000,true,true);var da=document.createElement("span");cmjQuery_(da).attr('class','cm-date cm-font-normal');cmjQuery_(da).html(", "+datestring);cmjQuery_(d).append(da);cmjQuery_(node).append(d);};proto.AppendSearchResultSubject=function(mail,node){var d=document.createElement("div");var spanwrapper=document.createElement("span");cmjQuery_(spanwrapper).attr('class','cm-link');var span=document.createElement("a");cmjQuery_(span).attr('class','cm-subject');cmjQuery_(span).attr('href','#');var mailtype=document.createElement("div");cmjQuery_(mailtype).attr("class","cm-float-icon");if(mail.type==2){cmjQuery_(mailtype).addClass("mb-sent-mail");cmjQuery_(mailtype).attr("title","Sent Mail");}else if(mail.type==1){cmjQuery_(mailtype).addClass("mb-recv-mail");cmjQuery_(mailtype).attr("title","Received Mail");}else if(mail.type==0){cmjQuery_(mailtype).addClass("mb-draft");cmjQuery_(mailtype).attr("title","Draft");}
cmjQuery_(d).append(mailtype);if(mail.has_attachments==1){var attachment=document.createElement("div");cmjQuery_(attachment).attr('class','cm-float-icon mb-attachment');var title="";for(var i=0;i<mail.attachments.length;i++){title=title+mail.attachments[i].n+" ";}
cmjQuery_(attachment).attr("title",title);cmjQuery_(d).append(attachment);}
cmjQuery_(span).text(mail.subject);cmjQuery_(spanwrapper).append(span);cmjQuery_(d).append(spanwrapper);cmjQuery_(node).append(d);cmjQuery_(span).click(self.GetOpenMailHandler(mail));};proto.OpenMail=function(mail){var result=self.plugin_.GetMail(mail.tsrowid.toString(),function(response){var result=JSON.parse(response);self.ShowMail(result,mail.tsrowid.toString());});return true;};proto.OpenEvent=function(event){var result=self.plugin_.GetEvent(event.rowuid.toString(),function(response){var result=JSON.parse(response);self.ShowEvent(result,event.rowuid.toString());});return true;};proto.OpenContact=function(contact){var result=self.plugin_.GetContact(contact.id.toString(),function(response){var result=JSON.parse(response);self.ShowContact(result,contact.id.toString());});return true;};proto.ShowPreviewError=function(viewtype,id){cmjQuery_(self.previewNode_).empty();var div=document.createElement("div");cmjQuery_(div).attr('class','cm-error-info');var msg;var type;switch(viewtype){case self.c_.MAIL:type="mail";break;case self.c_.DOC:type="document";break;case self.c_.CONTACT:type="contact";break;case self.c_.EVENT:type="calendar";break;}
msg="Failed to get "+type+" details,  try after sometime";cmjQuery_(div).html(msg);self.common_.ShowPreviewWindow(cmjQuery_(div),viewtype,id);return;};proto.CheckForError=function(result,type,id){if(result.hasOwnProperty("error")&&result.error.length>1){self.ShowPreviewError(type,id);return true;}
return false;};proto.ShowEvent=function(event,id){if(self.CheckForError(event,self.c_.EVENT,id)==true){return;}
var previewnode=document.createElement("div");cmjQuery_(previewnode).attr('class','cm-preview-window');var div=document.createElement("div");cmjQuery_(div).attr('class','mb-preview-toolbar');var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","cm-font-small");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-cal");cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(event.accountemail);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(div).append(table);cmjQuery_(previewnode).append(div);var contactcontainer=document.createElement("div");cmjQuery_(contactcontainer).attr('class','cm-preview-container');var contactinfo=document.createElement("div");cmjQuery_(contactinfo).attr('class','cm-contact-info');self.common_.AddEventTopTitle(event,contactinfo);var calendarname=" ";if(event.calendardetails.name!=undefined){calendarname=event.calendardetails.name;}
var calendarnamediv=document.createElement("div");cmjQuery_(calendarnamediv).attr("class","mb-font-normal mb-single-line");cmjQuery_(calendarnamediv).css("title",calendarname);cmjQuery_(calendarnamediv).css("padding","3px");cmjQuery_(calendarnamediv).html("<b>Calendar:</b>&nbsp;&nbsp;<span class='mb-preview-search-value mb-preview-search-value-calendar'>"+calendarname+"</span>");cmjQuery_(contactinfo).append(calendarnamediv);var attendstatustopdiv=document.createElement("div");cmjQuery_(attendstatustopdiv).css("padding","3px");cmjQuery_(contactinfo).append(attendstatustopdiv);var index=self.common_.FindOwnerGuestIndexInGuestJson(event.guests,event.accountemail);if(index!=-1){gueststatus=event.guests[index].s;if(gueststatus!=""&&gueststatus!="invited"){var imageclass=self.common_.GuestAttendeStatus(gueststatus,false);var attendstatusval=self.common_.GuestAttendeStatus(gueststatus);var attendstatusdiv=document.createElement("div");cmjQuery_(attendstatusdiv).text(attendstatusval);cmjQuery_(attendstatusdiv).attr("class",imageclass);cmjQuery_(attendstatustopdiv).append(attendstatusdiv);}}
var linktocal=document.createElement("div");cmjQuery_(linktocal).attr("class","mb-locate-link mb-font-normal");self.AddLinkToEvent(event.viewurl,linktocal);cmjQuery_(contactinfo).append(linktocal);var detailsdiv=document.createElement("div");cmjQuery_(detailsdiv).attr("class","mb-preview");cmjQuery_(contactinfo).append(detailsdiv);var table=document.createElement("table");cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).attr("cellspacing",5);cmjQuery_(table).css('width','100%');cmjQuery_(detailsdiv).append(table);var tbody=document.createElement("tbody");cmjQuery_(table).append(tbody);var isallday=event.metadata.isallday;self.common_.AddEventDate(event,tbody,isallday);if(event.title==undefined||event.title!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).text("What:");cmjQuery_(td).attr('valign',"top");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-what");cmjQuery_(td).text(event.title);cmjQuery_(tr).append(td);}
if(event.where==undefined||event.where!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).text("Where:");cmjQuery_(td).attr('valign',"top");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-where");cmjQuery_(td).text(event.where);cmjQuery_(tr).append(td);}
var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Repeat:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");cmjQuery_(td).text((event.metadata.isrepeat==true?"Yes":"No"));cmjQuery_(tr).append(td);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("All day:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");cmjQuery_(td).text((isallday==true?"Yes":"No"));cmjQuery_(tr).append(td);if(event.description==undefined||event.description!=""){var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Description:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal mb-preview-search-value mb-preview-search-value-description");cmjQuery_(td).text(event.description);cmjQuery_(tr).append(td);}
self.common_.AddEventReminderDetails(event,tbody,true);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Show me as:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");var availablestr;if(event.metadata.available==undefined||event.metadata.available==1){availablestr="Available";}else{availablestr="Busy";}
cmjQuery_(td).text(availablestr);cmjQuery_(tr).append(td);var tr=document.createElement("tr");cmjQuery_(tbody).append(tr);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-single-line mb-event-name");cmjQuery_(td).attr('valign',"top");cmjQuery_(td).text("Privacy:");cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr('class',"mb-font-normal");self.common_.AddEventGuests(event,tbody,true);var visibility=" ";if(event.metadata.visibility!=undefined){visibility=event.metadata.visibility;visibility=visibility.charAt(0).toUpperCase()+visibility.slice(1);}
visibility=visibility.charAt(0).toUpperCase()+visibility.slice(1);cmjQuery_(td).text(visibility);cmjQuery_(tr).append(td);self.common_.AddGuestEventAcessPermissions(event,tbody,true);cmjQuery_(contactcontainer).append(contactinfo);cmjQuery_(previewnode).append(contactcontainer);self.common_.ShowPreviewWindow(cmjQuery_(previewnode),self.c_.EVENT,id);self.common_.MakeHyperlink();self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_);};proto.ShowContact=function(contact,id){if(self.CheckForError(contact,self.c_.CONTACT,id)==true){return;}
var previewnode=document.createElement("div");cmjQuery_(previewnode).attr('class','cm-preview-window');var div=document.createElement("div");cmjQuery_(div).attr('class','mb-preview-toolbar');var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","cm-font-small");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-button mb-contact");cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(contact.accountemail);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(div).append(table);cmjQuery_(previewnode).append(div);var contactcontainer=document.createElement("div");cmjQuery_(contactcontainer).attr('class','cm-preview-container');var contactinfo=document.createElement("div");cmjQuery_(contactinfo).attr('class','cm-contact-info');var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).attr("class","mb-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var tr=document.createElement("tr");cmjQuery_(tr).attr('class',"mb-mail-result-row");var td=document.createElement("td");cmjQuery_(td).width("100%");cmjQuery_(td).attr("class","mb-result-column");cmjQuery_(td).attr("valign","top");cmjQuery_(td).css("border-bottom","1px solid #EAEAEA");var innertable=document.createElement("table");cmjQuery_(innertable).attr({cellspacing:0,cellpadding:0});cmjQuery_(innertable).css('table-layout','fixed');cmjQuery_(innertable).attr("class","cm-font-normal");cmjQuery_(innertable).css('width','100%');var innertbody=document.createElement("tbody");var innertr=document.createElement("tr");var innertd=document.createElement("td");var photo=document.createElement("img");if(contact.photo.length==0){cmjQuery_(photo).attr("src","data:image/jpeg;base64,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");}else{cmjQuery_(photo).attr("src","data:image/jpeg;base64,"+contact.photo);}
cmjQuery_(innertd).css("padding-left","5px");cmjQuery_(photo).width(96);cmjQuery_(photo).height(96);cmjQuery_(innertd).css('width','15%');cmjQuery_(innertd).attr("valign","top");cmjQuery_(innertd).append(photo);cmjQuery_(innertr).append(innertd);cmjQuery_(innertbody).append(innertr);cmjQuery_(innertable).append(innertbody);cmjQuery_(td).append(innertable);cmjQuery_(tr).append(td);var innertd=document.createElement("td");cmjQuery_(innertd).attr("class","mb-contact-info-value-padding");cmjQuery_(innertd).attr("valign","top");var name=document.createElement("div");cmjQuery_(name).attr('class','mb-contact-info-name cm-font-bigger mb-single-line mb-preview-search-value');cmjQuery_(name).text(contact.name);cmjQuery_(innertd).append(name);if(contact.fullname.length>0){var fullname=document.createElement("div");cmjQuery_(fullname).attr('class','mb-preview-search-value');var fullname1=contact.fullname[0].f;var nickname=contact.fullname[0].n;if(fullname1!=contact.name&&fullname1!=nickname){cmjQuery_(innertd).append("<br/>");}else{cmjQuery_(innertd).append(fullname);cmjQuery_(fullname).addClass('mb-preview-search-value');}
if(nickname&&nickname!=contact.name&&nickname!=fullname1){cmjQuery_(fullname).append("\""+nickname+"\"");}else{cmjQuery_(innertd).append("<br/>");}}else{cmjQuery_(innertd).append("<br/>");cmjQuery_(innertd).append("<br/>");}
if(contact.org.length>0){var orgdetails=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey mb-preview-search-value");cmjQuery_(orgdetails).append(titlespan);var designation=contact.org[0].t;var companyname=contact.org[0].n;var contactorg;contactorg=designation;if(designation!=undefined&&designation.length>0&&companyname!=undefined&&companyname.length>0){contactorg=contactorg+", ";}
cmjQuery_(orgdetails).append(contactorg+companyname);cmjQuery_(orgdetails).addClass('mb-preview-search-value');cmjQuery_(innertd).append(orgdetails);}else{cmjQuery_(innertd).append("<br/>");}
var gotolink=document.createElement("div");cmjQuery_(gotolink).attr("class","mb-locate-contact-link mb-font-normal");self.AddLinkToContact(contact,gotolink);cmjQuery_(innertd).append(gotolink);cmjQuery_(innertr).append(innertd);cmjQuery_(contacttbody).append(tr);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(contactinfo).append(contacttable);var contacttable=document.createElement("table");cmjQuery_(contacttable).attr({cellspacing:0,cellpadding:0});cmjQuery_(contacttable).attr("id","mbContactNotes");cmjQuery_(contacttable).css('table-layout','fixed');cmjQuery_(contacttable).attr("class","mb-font-normal");cmjQuery_(contacttable).css('width','100%');var contacttbody=document.createElement("tbody");var tr=document.createElement("tr");cmjQuery_(tr).attr('class',"mb-mail-result-row");var td=document.createElement("td");cmjQuery_(td).width("100%");cmjQuery_(td).attr("class","mb-result-column mb-preview-search-value-body");if(contact.email.length>0){var emaildiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(emaildiv).append(titlespan);var param="emails_";self.common_.CreateContactTableView(emaildiv,contact.email,param,true,contact.accountemail);cmjQuery_(td).append(emaildiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.phonelist.length>0){var phonediv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(phonediv).append(titlespan);var param="phonelist_";self.common_.CreateContactTableView(phonediv,contact.phonelist,param,true);cmjQuery_(td).append(phonediv);cmjQuery_(td).append("<br/><br/>");}
if(contact.address.length>0){var addressdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(addressdiv).append(titlespan);var param="address_";self.common_.CreateContactTableView(addressdiv,contact.address,param,true);cmjQuery_(td).append(addressdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.events.length>0){var eventdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(eventdiv).append(titlespan);self.common_.CreateContactTableView(eventdiv,contact.events,null,true);cmjQuery_(td).append(eventdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.websites.length>0){var websitediv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(websitediv).append(titlespan);var param="websites_";self.common_.CreateContactTableView(websitediv,contact.websites,param,true);cmjQuery_(td).append(websitediv);cmjQuery_(td).append("<br/><br/>");}
if(contact.relations.length>0){var relationdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(relationdiv).append(titlespan);self.common_.CreateContactTableView(relationdiv,contact.relations,null,true);cmjQuery_(td).append(relationdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.imessanger.length>0){var messangerdiv=document.createElement("div");var titlespan=document.createElement("span");cmjQuery_(titlespan).attr("class","mb-grey");cmjQuery_(messangerdiv).append(titlespan);var param="imsg_";self.common_.CreateContactTableView(messangerdiv,contact.imessanger,param,true);cmjQuery_(td).append(messangerdiv);cmjQuery_(td).append("<br/><br/>");}
if(contact.notes.length>0){var notes=document.createElement("div");cmjQuery_(notes).attr('class','mb-note-caption mb-grey');cmjQuery_(notes).text("Notes");cmjQuery_(td).append(notes);var notes=document.createElement("div");cmjQuery_(notes).attr('class','mb-contact-notes mb-preview-search-value');cmjQuery_(notes).text(contact.notes);cmjQuery_(td).append(notes);}
cmjQuery_(tr).append(td);cmjQuery_(contacttbody).append(tr);cmjQuery_(contacttable).append(contacttbody);cmjQuery_(contactinfo).append(contacttable);cmjQuery_(contactcontainer).append(contactinfo);cmjQuery_(previewnode).append(contactcontainer);self.common_.ShowPreviewWindow(cmjQuery_(previewnode),self.c_.CONTACT,id);self.common_.MakeHyperlink();self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_);self.utils_.ConvertEmailToHyperlink(previewnode,contact.accountemail);};proto.ShowMail=function(mail,id){if(self.CheckForError(mail,self.c_.MAIL,id)==true){return;}
var previewnode=document.createElement("div");cmjQuery_(previewnode).attr("class","cm-preview-window");var mailcontainer=document.createElement("div");cmjQuery_(mailcontainer).attr("class","cm-preview-container");self.common_.EscapeMailMessageId(mail);cmjQuery_(previewnode).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});self.AddEmailToolbar(mail,previewnode);self.common_.AddMailTopSubject(mail,mailcontainer);self.common_.AddMailTopHeader(mail,mailcontainer);var table=document.createElement("table");cmjQuery_(table).attr("class","mb-preview-header-table cm-font-small");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("from"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-from");if(mail.sendername.length>0){self.common_.AddText(td,mail.sendername+" <"+mail.senderaddress+">");}else{self.common_.AddText(td,mail.senderaddress);}
cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);self.common_.AddEmailHeader(tbody,"to",mail.to);self.common_.AddEmailHeader(tbody,"cc",mail.cc);self.common_.AddEmailHeader(tbody,"bcc",mail.bcc);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("date"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td");var d=self.dateFormat_.formatDateWith(mail.timestamp*1000,"ddd, mmm dd, yyyy")+" at "+
self.dateFormat_.formatDateWith(mail.timestamp*1000,"h:MM TT");self.common_.AddText(td,d);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("subject"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-subject");self.common_.AddText(td,mail.subject);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(mailcontainer).append(table);var mailcontent=document.createElement("div");cmjQuery_(mailcontent).attr("class","mb-preview mb-preview-search-value mb-preview-search-value-body");var text=mail.body;if(mail.contenttype!=1){text=self.utils_.replaceURLWithHTMLLinksHelper(text);text=self.utils_.HtmlEntities(text,"ENT_NOQUOTES");text=self.utils_.ReplaceSlashNWithBR(text);}else{text=self.utils_.HTMLSanitizer(text);text=self.utils_.addBlankToHTMLLinks(text);text=self.utils_.makeShowQuotedTextVisible(text);}
cmjQuery_(mailcontent).append(text);cmjQuery_(mailcontent).append("<br/>");for(var i=0;i<mail.attachments.length;i++){if(i==0){cmjQuery_(mailcontent).append("<br/>");cmjQuery_(mailcontent).append("<div class='mb-attachment-header'></div>");}
var a=mail.attachments[i];var adiv=document.createElement("div");var aspan=document.createElement("span");cmjQuery_(adiv).attr("class"," mb-preview-attachments mb-single-line mb-preview-search-value-filename");cmjQuery_(aspan).attr("class","mb-link");var filename=a.n;if(filename.length>30){var part1=filename.substring(0,14);var part2=filename.substring(filename.length-14,filename.length);filename=part1+"..."+part2;}
cmjQuery_(aspan).text(filename);cmjQuery_(aspan).attr('title',a.n);var func=self.common_.GetAttachmentHandler(mail,a);cmjQuery_(aspan).click(func);cmjQuery_(adiv).append(aspan);cmjQuery_(mailcontent).append(adiv);}
cmjQuery_(mailcontainer).append(mailcontent);cmjQuery_(previewnode).append(mailcontainer);self.ShowView(self.c_.M_VIEW,true);self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_);self.utils_.ConvertEmailToHyperlink(previewnode,mail.accountemail);},10);self.common_.ShowPreviewWindow(cmjQuery_(previewnode),self.c_.MAIL,id);};proto.ShowDocs=function(docs,tbody,viewtype){if(typeof docs=="undefined"||docs.length==0){return false;}
var len=docs.length;cmjQuery_("#mbLoadingContacts").remove();if(self.category_=="all"&&cmjQuery_(".cm-doc-search-result").length==0){self.AddCategoryHeader(tbody,"Docs","doc");}
if(self.searchDocResultCount_==0){self.docRecTsRowId_=docs[0].tsrowid;}
for(var i=0;i<len;i++){var d=docs[i];var tr=document.createElement("tr");cmjQuery_(tr).attr("Class","cm-doc-search-result");var td=document.createElement("td");cmjQuery_(td).attr("class","cm-result-column");self.docRecIndex_=d.recindex;self.AppendDocTitle(d,td);self.AppendDocOwner(d,td);self.AppendDocContent(d,td);self.AppendOpenDocLink(d,td);cmjQuery_(td).width("100%");cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);}
self.ShowView(self.c_.AC_VIEW);return true;};proto.AppendDocOwner=function(doc,node){var d=document.createElement("div");cmjQuery_(d).attr('class','cm-from-to-details cm-font-big');cmjQuery_(d).text(doc.owner);var datestring=self.dateFormat_.formatDate(doc.updatedtime*1000,true,true);var da=document.createElement("span");cmjQuery_(da).attr('class','cm-date cm-font-normal');updateduserinfo=", updated "+datestring+" by ";if(doc.lastmodifiedusername.length>0){updateduserinfo=updateduserinfo+doc.lastmodifiedusername;}else{updateduserinfo=updateduserinfo+doc.lastmodifieduseremail;}
cmjQuery_(da).html(updateduserinfo);cmjQuery_(d).append(da);cmjQuery_(node).append(d);};proto.AppendOpenDocLink=function(doc,node){var d=document.createElement("div");var a=document.createElement("a");cmjQuery_(a).attr("class","cm-direct-link cm-link");cmjQuery_(a).text("View document in Google Docs");cmjQuery_(a).attr("href",doc.viewurl);cmjQuery_(a).attr("target","_blank");cmjQuery_(d).append(a);cmjQuery_(node).append(d);};proto.AppendDocTitle=function(doc,node){var d=document.createElement("div");var spanwrapper=document.createElement("span");cmjQuery_(spanwrapper).attr('class','cm-link');var div=document.createElement("div");cmjQuery_(div).attr("class","cm-float-icon");var filetype=doc.type.toLowerCase().substring(0,5);switch(filetype){case"image":cmjQuery_(div).addClass("mb-photo");cmjQuery_(div).attr("title","Image");break;case"docum":cmjQuery_(div).addClass("mb-doc");cmjQuery_(div).attr("title","Document");break;case"sprea":cmjQuery_(div).addClass("mb-spread");cmjQuery_(div).attr("title","Spreadsheet");break;case"prese":cmjQuery_(div).addClass("mb-presentation");cmjQuery_(div).attr("title","Presentation");break;case"pdf":cmjQuery_(div).addClass("mb-pdf");cmjQuery_(div).attr("title","pdf");break;default:cmjQuery_(div).addClass("mb-generic");cmjQuery_(div).attr("title","Unknown");}
cmjQuery_(d).append(div);var span=document.createElement("a");cmjQuery_(span).attr('class','cm-subject');cmjQuery_(span).attr('href','#');cmjQuery_(span).text(doc.title);cmjQuery_(spanwrapper).append(span);cmjQuery_(d).append(spanwrapper);self.common_.AddDocFolderInfo(doc,d);cmjQuery_(span).click(self.GetOpenDocHandler(doc));cmjQuery_(node).append(d);};proto.AppendDocContent=function(doc,node){var d=document.createElement("div");cmjQuery_(d).attr("class","cm-content");filetype=doc.type.toLowerCase();if(filetype=="document"||filetype=="spreadsheet"||filetype=="presentation"){var docContent=self.utils_.addBlankToHTMLLinks(doc.content);cmjQuery_(d).text(docContent);}else{cmjQuery_(d).append("No preview available, ");cmjQuery_(d).append("type: "+doc.type);}
cmjQuery_(node).append(d);if(doc.content.length>=self.c_.MAX_SNIPPET_CHAR_SIZE){cmjQuery_(d).append(self.c_.ELLIPSIS);}};proto.AddLinkToMail=function(mail,node){var mailurl=self.utils_.GetBaseMailUrl(mail.accountemail)+'#search/'+
encodeURIComponent("rfc822msgid:"+mail.messageid);var a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View thread in Gmail");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View thread in Gmail");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.AddEmailToolbar=function(mail,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","cm-font-small");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");if(mail.type==2){cmjQuery_(td).attr("class","mb-sent-mail mb-button");cmjQuery_(td).attr("title","Sent Mail");}else if(mail.type==1){cmjQuery_(td).attr("class","mb-recv-mail mb-button");cmjQuery_(td).attr("title","Received Mail");}else if(mail.type==0){cmjQuery_(td).attr("class","mb-draft mb-button");cmjQuery_(td).attr("title","Draft");}
cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(mail.accountemail);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);cmjQuery_(div).append(d);};proto.OpenDoc=function(doc){var result=self.plugin_.GetDoc(doc.rowuid.toString(),function(response){var result=JSON.parse(response);self.ShowDoc(result,doc.rowuid.toString());});return true;};proto.ShowDoc=function(doc,id){if(self.CheckForError(doc,self.c_.DOC,id)==true){return;}
var previewnode=document.createElement("div");cmjQuery_(previewnode).attr("class","cm-preview-window");var doccontainer=document.createElement("div");cmjQuery_(doccontainer).attr("class","cm-preview-container");var docheader=document.createElement("div");cmjQuery_(docheader).attr("id","mbPreviewHeader");cmjQuery_(previewnode).keydown(function(e){var code=self.utils_.GetKeyCode(e);switch(code){case 27:case 32:break;default:e.stopPropagation();}});self.AddDocToolbar(doc,previewnode);self.common_.AddDocTopTitle(doc,docheader);self.common_.AddDocTopHeader(doc,docheader);var table=document.createElement("table");cmjQuery_(table).attr("class","mb-preview-header-table mb-font-small");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("owner"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td mb-preview-search-value mb-preview-search-value-from");self.common_.AddText(td,doc.owner);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);self.common_.AddDocSharedMembers(doc,tbody);var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header mb-preview-header-td");cmjQuery_(td).append(self.utils_.SetCaption("published date"));cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-preview-header-td");self.common_.AddText(td,self.dateFormat_.formatDate(doc.publishedtime*1000));cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);cmjQuery_(docheader).append(table);cmjQuery_(doccontainer).append(docheader);var doccontent=document.createElement("div");if(doc.content.length>0){cmjQuery_(doccontent).attr("class","mb-preview mb-preview-search-value mb-preview-search-value-content");var ifr=document.createElement("iframe");cmjQuery_(ifr).attr("class","mb-preview-iframe mb-font-normal");cmjQuery_(ifr).attr("id","mbPreviewIframe");ifr.src="";cmjQuery_(ifr).load(function(){try{var previewiframe=cmjQuery_(ifr)[0];self.common_.InitializeIframe(previewiframe);cmjQuery_(previewiframe.contentWindow).keydown(function(e){var code=self.utils_.GetKeyCode(e);if(code==27){self.common_.ClosePreview();}});var docContent=self.utils_.addBlankToHTMLLinks(doc.content);window.setTimeout(function(){previewiframe.contentWindow.document.body.innerHTML="<style>.highlight{background-color: #FFDBB7;}</style>"+docContent;previewiframe.style.height=(previewnode.offsetHeight-140)+"px";previewiframe.style.width=(previewnode.offsetWidth-10)+"px";self.getMailTimer_=window.setTimeout(function(){self.common_.MakeHyperlink();self.highlight_.HighlightSearchDirectPreview(self.activeSearchString_,previewiframe.contentWindow.document.body);self.utils_.ConvertEmailToHyperlink(previewnode,doc.accountemail);},10);},100);}catch(e){alert("Failed to load doc");}});cmjQuery_(doccontent).append(ifr);}else{cmjQuery_(doccontent).attr("class","mb-preview mb-new-preview mb-font-bigger");cmjQuery_(doccontent).append("No preview available<br/>");var d1=document.createElement("span");cmjQuery_(d1).attr("class","mb-font-small");cmjQuery_(d1).append("type:&nbsp;");var d2=document.createElement("span");cmjQuery_(d2).attr("class","mb-preview-search-value mb-preview-search-value-type");cmjQuery_(d2).append(doc.type);cmjQuery_(d1).append(d2);cmjQuery_(doccontent).append(d1);}
cmjQuery_(doccontent).append("<br/>");cmjQuery_(doccontainer).append(doccontent);cmjQuery_(previewnode).append(doccontainer);self.ShowView(self.c_.M_VIEW,true);self.common_.ShowPreviewWindow(cmjQuery_(previewnode),self.c_.DOC,id);};proto.AddDocToolbar=function(doc,div){var table=document.createElement("table");cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","cm-font-small");cmjQuery_(table).width("100%");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");var filetype=doc.type.toLowerCase().substring(0,5);switch(filetype){case"image":cmjQuery_(td).addClass("mb-photo");cmjQuery_(td).attr("title","Image");break;case"docum":cmjQuery_(td).addClass("mb-doc");cmjQuery_(td).attr("title","Document");break;case"sprea":cmjQuery_(td).addClass("mb-spread");cmjQuery_(td).attr("title","Spreadsheet");break;case"prese":cmjQuery_(td).addClass("mb-presentation");cmjQuery_(td).attr("title","Presentation");break;case"pdf":cmjQuery_(td).addClass("mb-pdf");cmjQuery_(td).attr("title","pdf");break;default:cmjQuery_(td).addClass("mb-generic");cmjQuery_(td).attr("title",doc.type);}
cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-button");cmjQuery_(td).attr("title","Source account");cmjQuery_(td).attr("class","mb-source-account");cmjQuery_(td).html(doc.accountemail);cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).append(tbody);var d=document.createElement("div");cmjQuery_(d).attr("class","mb-preview-toolbar");cmjQuery_(d).append(table);cmjQuery_(div).append(d);};proto.AddLinkToDoc=function(doc,node){var mailurl=doc.viewurl;var a=document.createElement("a");cmjQuery_(a).attr("href",mailurl);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View document in Google Docs");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View document in Google Docs");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.AddLinkToEvent=function(url,node){var a=document.createElement("a");cmjQuery_(a).attr("href",url);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View event in Google Calendar");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View event in Google Calendar");cmjQuery_(a).addClass("mb-link ");cmjQuery_(node).append(a);};proto.AddLinkToContact=function(contact,node){var url;if(contact.contactbase.length>0){var baseurl=self.utils_.GetBaseMailUrl(contact.accountemail);url=baseurl+"u/0/?shva=1#contact/"+encodeURIComponent(contact.contactbase);}
var a=document.createElement("a");cmjQuery_(a).attr("href",url);cmjQuery_(a).attr("target","_blank");cmjQuery_(a).attr("title","View contact in Google Contacts");cmjQuery_(a).attr("id","mbLocateOriginal");cmjQuery_(a).text("View contact in Google Contacts");cmjQuery_(a).addClass("mb-link");cmjQuery_(node).append(a);};proto.SetStatusMessage=function(){var accountCount=0;if(self.statusMsg_&&typeof(self.statusMsg)!=undefined&&self.statusMsg_.accountstatus){accountCount=self.statusMsg_.accountstatus.accountcount;}
if(accountCount==0){cmjQuery_(self.statusMsgNode_).html("");return;}
if(self.statusMsg_.accountstatus.error==-1){cmjQuery_(self.statusMsgNode_).html("Connecting...");return;}
if(self.statusMsg_.accountstatus.error==1){var url="http://127.0.0.1:"+self.port_+"/index.html";cmjQuery_(self.statusMsgNode_).html("<a target='_blank' href='"+
url+"'>Problem with indexing</a>");return;}
if(self.statusMsg_.index.indexstatus==0||self.statusMsg_.docindexstatus==0||self.statusMsg_.calindexstatus==0){cmjQuery_(self.statusMsgNode_).html("Indexing&#8230;");}else if(self.statusMsg_.accountstatus.updatedtime!=0){var updateTime=self.statusMsg_.accountstatus.updatedtime;updateTime=self.dateFormat_.formatDate(updateTime*1000,"false");cmjQuery_(self.statusMsgNode_).html("Last updated: "+updateTime);}else{cmjQuery_(self.statusMsgNode_).html("Indexing&#8230;");}};proto.ShowRefreshMessage=function(){return;};proto.ShowReloadMessage=function(){cmjQuery_(".cm-reload-msg").show();};proto.ShowNewVersionMessage=function(data){var cver=self.version_.majorversion+"."+self.version_.minorversion
cver=parseFloat(cver);var nver=parseFloat(data.version);if(cver<nver){cmjQuery_("#cmVersionInfo").html(data.version);cmjQuery_(".cm-safari-update").show();}};proto.IsPreviewOpen=function(type,data){if(cmjQuery_(".cm-preview-content").length==0){return false;}
var previewid="";switch(type){case self.c_.MAIL:previewid=data.tsrowid;break;case self.c_.DOC:previewid=data.rowuid;break;case self.c_.CONTACT:previewid=data.id;break;case self.c_.EVENT:previewid=data.id;break;}
if(cmjQuery_(".cm-preview-content").attr("preview_id")==previewid){return true;}
return false;};};if("undefined"==typeof(CloudMagic)){var CloudMagic={};};CloudMagic.WidgetUtilities=function(){var self=this;var proto=CloudMagic.WidgetUtilities.prototype;self.dateFormat_=new CloudMagic.DateUtilities();self.c_=new CloudMagic.Constants();proto.GetBaseMailUrl=function(email){var protocol=window.location.protocol;var url="mail.google.com/mail/";var index=email.indexOf("@");if(index!=-1){var domain=email.substring(index+1,email.length);if(domain!="gmail.com"&&domain!="googlemail.com"){url="mail.google.com/a/"+domain+"/";}else{var winhref=window.location.href;var macurl="mail.google.com/mail/u/";index=winhref.indexOf(macurl);if(index!=-1){var start=index+macurl.length;index=winhref.indexOf("/",start);if(index!=-1){var macindex=winhref.substring(start,index);url=macurl+macindex+"/";}}}}
if(protocol!="http:"&&protocol!="https:"){protocol="https:";}
url=protocol+"//"+url;return url;};proto.HtmlEntities=function(string,quotestyle){var hashmap={};var symbol='';var tmpstr='';var entity='';tmpstr=string.toString();if(false===(hashmap=self.GetHtmlTranslationTable('HTML_ENTITIES',quotestyle))){return false;}
hashmap["'"]='&#039;';for(symbol in hashmap){entity=hashmap[symbol];tmpstr=tmpstr.split(symbol).join(entity);}
return tmpstr;};proto.GetHtmlTranslationTable=function(table,quotestyle){var entities={};var hashmap={};var dec=0;var symbol='';var constMappingTable={};var constMappingQuoteStyle={};var useTable={};var useQuoteStyle={};constMappingTable[0]='HTML_SPECIALCHARS';constMappingTable[1]='HTML_ENTITIES';constMappingQuoteStyle[0]='ENT_NOQUOTES';constMappingQuoteStyle[2]='ENT_COMPAT';constMappingQuoteStyle[3]='ENT_QUOTES';useTable=!isNaN(table)?constMappingTable[table]:table?table.toUpperCase():'HTML_SPECIALCHARS';useQuoteStyle=!isNaN(quotestyle)?constMappingQuoteStyle[quotestyle]:quotestyle?quotestyle.toUpperCase():'ENT_COMPAT';if(useTable!=='HTML_SPECIALCHARS'&&useTable!=='HTML_ENTITIES'){throw new Error("Table: "+useTable+' not supported');}
entities['38']='&amp;';if(useTable==='HTML_ENTITIES'){entities['160']='&nbsp;';entities['161']='&iexcl;';entities['162']='&cent;';entities['163']='&pound;';entities['164']='&curren;';entities['165']='&yen;';entities['166']='&brvbar;';entities['167']='&sect;';entities['168']='&uml;';entities['169']='&copy;';entities['170']='&ordf;';entities['171']='&laquo;';entities['172']='&not;';entities['173']='&shy;';entities['174']='&reg;';entities['175']='&macr;';entities['176']='&deg;';entities['177']='&plusmn;';entities['178']='&sup2;';entities['179']='&sup3;';entities['180']='&acute;';entities['181']='&micro;';entities['182']='&para;';entities['183']='&middot;';entities['184']='&cedil;';entities['185']='&sup1;';entities['186']='&ordm;';entities['187']='&raquo;';entities['188']='&frac14;';entities['189']='&frac12;';entities['190']='&frac34;';entities['191']='&iquest;';entities['192']='&Agrave;';entities['193']='&Aacute;';entities['194']='&Acirc;';entities['195']='&Atilde;';entities['196']='&Auml;';entities['197']='&Aring;';entities['198']='&AElig;';entities['199']='&Ccedil;';entities['200']='&Egrave;';entities['201']='&Eacute;';entities['202']='&Ecirc;';entities['203']='&Euml;';entities['204']='&Igrave;';entities['205']='&Iacute;';entities['206']='&Icirc;';entities['207']='&Iuml;';entities['208']='&ETH;';entities['209']='&Ntilde;';entities['210']='&Ograve;';entities['211']='&Oacute;';entities['212']='&Ocirc;';entities['213']='&Otilde;';entities['214']='&Ouml;';entities['215']='&times;';entities['216']='&Oslash;';entities['217']='&Ugrave;';entities['218']='&Uacute;';entities['219']='&Ucirc;';entities['220']='&Uuml;';entities['221']='&Yacute;';entities['222']='&THORN;';entities['223']='&szlig;';entities['224']='&agrave;';entities['225']='&aacute;';entities['226']='&acirc;';entities['227']='&atilde;';entities['228']='&auml;';entities['229']='&aring;';entities['230']='&aelig;';entities['231']='&ccedil;';entities['232']='&egrave;';entities['233']='&eacute;';entities['234']='&ecirc;';entities['235']='&euml;';entities['236']='&igrave;';entities['237']='&iacute;';entities['238']='&icirc;';entities['239']='&iuml;';entities['240']='&eth;';entities['241']='&ntilde;';entities['242']='&ograve;';entities['243']='&oacute;';entities['244']='&ocirc;';entities['245']='&otilde;';entities['246']='&ouml;';entities['247']='&divide;';entities['248']='&oslash;';entities['249']='&ugrave;';entities['250']='&uacute;';entities['251']='&ucirc;';entities['252']='&uuml;';entities['253']='&yacute;';entities['254']='&thorn;';entities['255']='&yuml;';}
if(useQuoteStyle!=='ENT_NOQUOTES'){entities['34']='&quot;';}
if(useQuoteStyle==='ENT_QUOTES'){entities['39']='&#39;';}
entities['60']='&lt;';entities['62']='&gt;';for(dec in entities){symbol=String.fromCharCode(dec);hashmap[symbol]=entities[dec];}
return hashmap;};proto.GetKeyCode=function(e){var code=0;if(!e){e=window.event}
if(e.keyCode){code=e.keyCode;}else if(e.which){code=e.which;}
return code;};proto.GetButton=function(e){var code=0;if(!e){e=window.event}
if(e.which){code=e.which;}else if(e.button){code=e.button;}
return code;};proto.replaceURLWithHTMLLinksHelper=function(text){var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;return text.replace(exp,"$1 ");};proto.addBlankToHTMLLinks=function(text){var exp=/<(a)([^>]+)>/ig;return text.replace(exp,"<$1 target='_blank' $2>");};proto.makeShowQuotedTextVisible=function(text){var exp=/<div\s*class=\s*(\"|')h5(\"|')\s*>/ig;text=text.replace(exp,'<div class="h5" style="display:block" ');return text;};proto.ReplaceSlashNWithBR=function(str){return str.replace(/\n/g,'<br />\n');};proto.ScrollIntoView=function(node,anchorNode){var sctop=cmjQuery_(anchorNode).attr('scrollTop');var hgt=cmjQuery_(anchorNode).height();var nodeoffset=cmjQuery_(node).attr('offsetTop');var nodehgt=cmjQuery_(node).height();var n=cmjQuery_(node).parent();var tagname="";try{while(tagname!="table"){tagname=cmjQuery_(n).get(0).tagName.toLowerCase();var temp=cmjQuery_(n).attr('offsetTop')
nodeoffset+=temp;n=cmjQuery_(n).parent();}}catch(e){self.CMLOG(e);}
var s=sctop+hgt;var n=nodeoffset+nodehgt;if(s<n){var r=n-hgt;cmjQuery_(anchorNode).attr('scrollTop',r);}else if(nodeoffset-55<sctop){var r=nodeoffset-85;cmjQuery_(anchorNode).attr('scrollTop',r);}};proto.InsertPlugin=function(){try{var p=new CloudMagic.InterfacePlugin();p.Init();}catch(e){alert(e);}
return p;};proto.SetCaption=function(caption){return"<span class='mb-attribute-caption'>"+caption+"</span>";};proto.AppendBusy=function(node){var div=document.createElement("div");cmjQuery_(div).attr('class','mb-busy-node');cmjQuery_(div).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(node).append(div);};proto.RemoveBusy=function(node){cmjQuery_('.mb-busy-node').remove();};proto.AppendDate=function(node,ts,type,ismail){var div=document.createElement("div");cmjQuery_(div).attr("class","mb-search-mail-date");var title="";if(ismail==true){if(type==2){cmjQuery_(div).addClass("mb-sent-mail");title="Sent Mail";}else if(type==1){cmjQuery_(div).addClass("mb-recv-mail");title="Received Mail";}else if(type==0){cmjQuery_(div).addClass("mb-draft");title="Draft";}}else{var filetype=type.toLowerCase().substring(0,5);switch(filetype){case"image":cmjQuery_(div).addClass("mb-photo");title="Image";break;case"docum":cmjQuery_(div).addClass("mb-doc");title="Document";break;case"sprea":cmjQuery_(div).addClass("mb-spread");title="Spreadsheet";break;case"prese":cmjQuery_(div).addClass("mb-presentation");title="Presentation";break;case"pdf":cmjQuery_(div).addClass("mb-pdf");title="pdf";break;default:cmjQuery_(div).addClass("mb-generic");title="Unknown";}}
cmjQuery_(div).html(self.dateFormat_.formatDate(ts*1000));var fulldate=self.dateFormat_.formatDateWith(ts*1000,"ddd, mmm d, yyyy")+" at "+
self.dateFormat_.formatDateWith(ts*1000,"h:MM TT")
if(title.length>0){title=title+" - ";}
title=title+fulldate;cmjQuery_(div).attr("title",title);cmjQuery_(node).append(div);};proto.AppendAttachmentIcon=function(node,hasattachments,attachments){if(hasattachments==1){var div=document.createElement("div");cmjQuery_(div).attr("class","mb-preview-with-attachment");var title="";for(var i=0;i<attachments.length;i++){title=title+attachments[i].n+" ";}
cmjQuery_(div).attr("title",title);cmjQuery_(node).append(div);}};proto.ConvertEmailToHyperlink=function(node,email){cmjQuery_("a[href^=mailto]",node).click(function(){var url=self.GetBaseMailUrl(email)+"?view=cm&fs=1&tf=1&to="+
encodeURIComponent(cmjQuery_(this).text());window.open(url,'','width=700, height=780');return false;});};proto.GetMouseWheelDelta=function(e){var delta=0;if(e.detail){delta=(-1*e.detail/3);}else if(e.wheelDelta){delta=e.wheelDelta/120;}
return delta;};proto.MouseWheelHandler=function(e){var func=function(e){var delta=self.GetMouseWheelDelta(e);var scrolltop=cmjQuery_(this).attr("scrollTop");if(delta>0&&scrolltop==0){return false;}
var scrolllheight=cmjQuery_(this).attr("scrollHeight");var offsetheight=cmjQuery_(this).attr("offsetHeight");if(delta<0&&(scrolltop>=(scrolllheight-offsetheight))){e.preventDefault();return false;}};return func;};proto.AddShareLinks=function(anchorNode,email,iswidget){var table=document.createElement("table");var tbody=document.createElement("tbody");var tr=document.createElement("tr");if(iswidget==true){var td=document.createElement("td");cmjQuery_(td).width("100%");cmjQuery_(td).attr("class","mb-share mb-grey");cmjQuery_(td).html("Like CloudMagic? ");cmjQuery_(tr).append(td);cmjQuery_(table).css('width','260px');}else{var div=document.createElement("div");cmjQuery_(div).attr("class","mb-share");cmjQuery_(div).html("Like CloudMagic? ");cmjQuery_(anchorNode).append(div);cmjQuery_(table).css('width','140px');}
var td=document.createElement("td");cmjQuery_(td).attr("class","mb-share-on-fb");cmjQuery_(td).attr("title","Share on Facebook");cmjQuery_(td).width(64);cmjQuery_(td).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(td).click(function(){var fbURL="http://www.facebook.com/sharer.php?u="+encodeURIComponent("http://www.cloudmagic.com")+"&t="+encodeURIComponent("Instant search for your online data");self.OpenWindow(fbURL,"");});cmjQuery_(tr).append(td);var td=document.createElement("td");cmjQuery_(td).attr("class","mb-share-on-tweet");cmjQuery_(td).attr("title","Share on Twitter");cmjQuery_(td).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(td).width(60);cmjQuery_(td).click(function(){var tweetURL="http://twitter.com/share?text=Instant%20search%20for%20your%20online%20data&url=http://www.cloudmagic.com&via=cldmgc";self.OpenWindow(tweetURL,"");});cmjQuery_(tr).append(td);td=document.createElement("td");cmjQuery_(td).attr("class","mb-share-on-email");cmjQuery_(td).attr("title","Share via Email");cmjQuery_(td).html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");cmjQuery_(td).width(22);cmjQuery_(td).click(function(){if(email==null){email="m@gmail.com";}
var composeURL=self.GetBaseMailUrl(email)+"?view=cm&fs=1&tf=1&to=&su="+
encodeURIComponent("CloudMagic - Instant search for your online data")+"&body="+encodeURIComponent("Hi, I found this cool tool - http://cloudmagic.com and thought you may find it useful too. Instant search for Gmail, Google Docs and Contacts.");self.OpenWindow(composeURL,"");});cmjQuery_(tr).append(td);cmjQuery_(tbody).append(tr);cmjQuery_(table).attr({cellspacing:0,cellpadding:0});cmjQuery_(table).css('table-layout','fixed');cmjQuery_(table).attr("class","mb-font-normal");cmjQuery_(table).css('height','24px');cmjQuery_(table).append(tbody);cmjQuery_(anchorNode).append(table);};proto.OpenWindow=function(url,caption){var CM_POPUP_WINDOW="fullscreen=no,titlebar=no,menubar=no,"+"location=no,toolbar=yes,resizable=yes,"+"scrollbars=yes,status=no,top=100,left=50"+",height=600,width=900";window.open(url,caption,CM_POPUP_WINDOW);};proto.CMLOG=function(msg){try{if(window.top.console){window.top.console.log(msg);}}catch(e){}};proto.CMLTS=function(name){};proto.CMLTE=function(name){};proto.MBCLS=function(){};proto.strnicmp=function(a,b,length){a=a.substring(0,length);b=b.substring(0,length);return a.toLowerCase()==b.toLowerCase();};proto.strncmp=function(a,b,length){a=a.substring(0,length);b=b.substring(0,length);return a==b;};proto.TriggerKeypress=function(node){var e;if(cmjQuery_.browser.webkit==true){e=cmjQuery_.Event("keyup");e.keyCode=13;}else{e=cmjQuery_.Event("keypress");e.which=13;}
cmjQuery_(node).trigger(e);};proto.GetLoggedEmailId=function(){var email=null;var node=cmjQuery_('div>span.gbps2');if(node.length!=0){email=node.text();return email;}
var node=cmjQuery_('#gbmpc>div');if(node.length!=0){email=node.text();}else{node=cmjQuery_('#guser>nobr>b>a>u');if(node.length!=0){email=node.text();}else{node=cmjQuery_('#guser>nobr>b');if(node.length!=0){email=node.text();}else{node=cmjQuery_('#guser>nobr>span>span>a>u>b');if(node.length!=0){email=node.text();}}}}
return email;};proto.GetDomainInfo=function(){var domaininfo=null;if(window.location.host.indexOf("mail.")!=-1){domaininfo=self.c_.MAIL;}else if(window.location.host.indexOf("docs.")!=-1||window.location.host.indexOf("spreadsheets.")!=-1){domaininfo=self.c_.DOC;}else if(window.location.host.indexOf("www.google.com/calendar/")!=-1){domaininfo=self.c_.EVENT;}
return domaininfo;};proto.GetURLParameters=function(name){name=name.replace(/[\[]/,"/\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null)
return"";return decodeURIComponent(results[1]);};proto.GetDirectSearchUrl=function(version){var direct_ui_url;if(window.location.protocol=="chrome-extension:"){direct_ui_url="res/cloudmagic.html?ts="+CloudMagic.CMSCRIPTTS+"#search";}else if(window.location.protocol=="chrome:"){direct_ui_url="chrome://cloudmagic/content/res/cloudmagic.html?ts="+CloudMagic.CMSCRIPTTS+"#search";}else if(window.location.protocol=="file:"){direct_ui_url="cloudmagic.html?ts="+CloudMagic.CMSCRIPTTS+"#search";}else{if(CloudMagic.CMBROWSER=="gc"){direct_ui_url="chrome-extension://"+document.body.getAttribute("CloudMagic_Ext_UUID")+"/res/cloudmagic.html";}else{direct_ui_url="chrome://cloudmagic/content/res/cloudmagic.html";}}
return direct_ui_url;};proto.SetPopoutWithSearchUrl=function(validquery,query,tabtype,version){var direct_ui_url=self.GetDirectSearchUrl(version);if(validquery==true){var category="";switch(tabtype)
{case self.c_.MAIL:category="mail";break;case self.c_.DOC:category="doc";break;case self.c_.CONTACT:category="contact";break;}
direct_ui_url=direct_ui_url+"?category="+encodeURIComponent(category);direct_ui_url=direct_ui_url+"&query="+encodeURIComponent(query);}
cmjQuery_("#mbNewWindowWithThisSearch").attr("href",direct_ui_url);};proto.IsScrolledIntoView=function(elem){var docViewTop=cmjQuery_(window).scrollTop(),docViewBottom=docViewTop+cmjQuery_(window).height(),elemTop=cmjQuery_(elem).offset().top,elemBottom=elemTop+cmjQuery_(elem).height();return((elemTop+((elemBottom-elemTop)/2))>=docViewTop&&((elemTop+((elemBottom-elemTop)/2))<=docViewBottom));};proto.Sleep=function(interval){var ctime=new Date().getTime();while(1){var time=new Date().getTime();if(time-ctime>=interval){break;}}};proto.HTMLSanitizer=function(emailcontent){emailcontent=CloudMagic.HTMLSanitizer.sanitize(emailcontent,function(ahref){var patt1=/(^(https?|ftp):\/\/|^www\d{0,3}[.])(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\//i;var patt2=/^mailto:[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/i;var patt3=/^callto:/i;if(patt1.test(ahref)!=true&&patt2.test(ahref)!=true&&patt3.test(ahref)!=true){ahref=" ";}
return ahref;});return emailcontent;}};